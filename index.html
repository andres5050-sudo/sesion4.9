<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0">
    <title>Unidad Did√°ctica Gamificada - Matem√°ticas 8¬∞</title>
    <style>

/* Estilo para item bloqueado en learning-list */
.learning-list-item.locked-item {
    opacity: 0.5;
    cursor: not-allowed;
    background: linear-gradient(135deg, #bdc3c7, #95a5a6) !important;
}
        /* ================================================= */
        /* === ESTILOS BASE DEL PROYECTO ORIGINAL === */
        /* ================================================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        /* Animaci√≥n de fondo degradado */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* REGLA 1: ESTRELLAS Y PART√çCULAS FIJAS EN TODAS LAS PANTALLAS (z-index: 0) */
        .stars-container, .particles {
            position: fixed; /* Asegura que se vean en todas las pantallas */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
        }

        .star {
            position: absolute;
            font-size: 20px;
            animation: fall linear infinite;
            opacity: 0;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8); /* Efecto ne√≥n suave */
        }

        @keyframes fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Part√≠culas brillantes flotantes */
        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0));
            border-radius: 50%;
            animation: float 20s infinite;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8); /* Brillo ne√≥n */
        }

        @keyframes float {
            0%, 100% { 
                transform: translateY(0) translateX(0) scale(1); 
                opacity: 0; 
            }
            10% { opacity: 1; }
            50% { 
                transform: translateY(-50vh) translateX(50px) scale(1.5); 
                opacity: 1; 
            }
            90% { opacity: 1; }
            100% { 
                transform: translateY(-100vh) translateX(100px) scale(0.5); 
                opacity: 0; 
            }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Pantallas */
        .screen {
            display: none;
            animation: fadeInScale 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeInScale {
            from { 
                opacity: 0; 
                transform: scale(0.95) translateY(30px);
            }
            to { 
                opacity: 1; 
                transform: scale(1) translateY(0);
            }
        }

        /* PANTALLA DE INICIO */
        .home-screen {
            text-align: center;
            padding: 60px 20px;
        }

        .logo-container {
            margin-bottom: 50px;
            animation: bounceIn 1.2s ease-out;
            position: relative;
        }

        @keyframes bounceIn {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .logo {
            /* ICONO DEL GAMEPAD RESTAURADO */
            font-size: 7em;
            margin-bottom: 20px;
            animation: rotate3d 4s infinite, glow 2s infinite alternate;
            display: inline-block;
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.8));
        }

        @keyframes rotate3d {
            0%, 100% { transform: rotateY(0deg) rotateZ(0deg); }
            25% { transform: rotateY(180deg) rotateZ(5deg); }
            50% { transform: rotateY(360deg) rotateZ(0deg); }
            75% { transform: rotateY(180deg) rotateZ(-5deg); }
        }

        @keyframes glow {
            0% { filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5)) drop-shadow(0 0 5px #f093fb); } /* Brillo ne√≥n a√±adido */
            100% { filter: drop-shadow(0 0 30px rgba(255, 255, 255, 1)) drop-shadow(0 0 15px #667eea); }
        }

        /* REGLA 2: S√çMBOLOS MATEM√ÅTICOS FLOTANTES */
        @keyframes floatMath {
          0% { transform: translate(0, 0) rotate(0deg); opacity: 0.5; }
          25% { transform: translate(-10px, -20px) rotate(10deg); opacity: 0.8; }
          50% { transform: translate(0, -40px) rotate(0deg); opacity: 0.6; }
          75% { transform: translate(10px, -20px) rotate(-10deg); opacity: 0.9; }
          100% { transform: translate(0, 0) rotate(0deg); opacity: 0.5; }
        }

        .math-symbol-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .math-symbol {
            position: absolute;
            font-size: 2.5em;
            font-weight: 900;
            color: white;
            text-shadow: 0 0 10px #f093fb, 0 0 5px #667eea;
            animation: floatMath 8s ease-in-out infinite alternate;
            pointer-events: none;
            display: inline-block;
        }

        h1 {
            color: white;
            font-size: 4em;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(0, 0, 0, 0.6), 
                         0 0 15px rgba(255, 255, 255, 0.5), /* M√°s brillo */
                         0 4px 20px rgba(0, 0, 0, 0.3);
            font-weight: 900;
            letter-spacing: -1px;
            animation: titlePulse 3s infinite;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.95);
            font-size: 1.8em;
            margin-bottom: 50px;
            font-weight: 300;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            animation: subtitleFloat 3s infinite;
        }

        @keyframes subtitleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /* TARJETAS DEL MEN√ö PRINCIPAL (Mejora visual) */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 40px;
            max-width: 1100px;
            margin: 0 auto;
        }

        .menu-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.88)); /* M√°s opacidad */
            border-radius: 30px;
            padding: 50px 40px;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4), /* Sombra m√°s difusa */
                        0 0 0 2px rgba(255, 255, 255, 0.5) inset; /* Borde interno sutil */
            position: relative;
            overflow: hidden;
            border: 3px solid transparent;
            touch-action: manipulation;
            backdrop-filter: blur(5px); /* Toque futurista */
        }

        .menu-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent, 
                rgba(255, 215, 0, 0.4), 
                rgba(255, 255, 255, 0.5), 
                rgba(255, 215, 0, 0.4), 
                transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0.8;
        }

        .menu-card:hover::before,
        .menu-card:active::before {
            left: 100%;
        }

        .menu-card:hover,
        .menu-card:active {
            transform: translateY(-20px) scale(1.08) rotate(2deg);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5), /* Sombra m√°s intensa */
                        0 0 30px rgba(102, 126, 234, 0.8); /* Brillo ne√≥n de hover */
            border-color: rgba(255, 215, 0, 0.8);
        }

        .menu-card::after {
            content: '‚ú®';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2em;
            opacity: 0;
            transition: all 0.4s;
            animation: sparkle 1s infinite;
            text-shadow: 0 0 10px #FFD700;
        }

        .menu-card:hover::after,
        .menu-card:active::after {
            opacity: 1;
        }

        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.3) rotate(180deg); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .card-icon {
            font-size: 5em;
            margin-bottom: 25px;
            display: block;
            animation: iconBounce 2s infinite;
            filter: drop-shadow(0 8px 20px rgba(0, 0, 0, 0.3));
        }

        @keyframes iconBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
        }

        .menu-card:hover .card-icon,
        .menu-card:active .card-icon {
            animation: iconSpin 0.6s ease-in-out;
        }

        @keyframes iconSpin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }

/* === ESTILO PARA EL POSTEST BLOQUEADO === */
        .menu-card.postest-locked {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            cursor: not-allowed;
            opacity: 0.6;
            position: relative;
        }

        .menu-card.postest-locked::before {
            content: 'üîí';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5em;
            opacity: 0.3;
            animation: lockShake 2s infinite;
        }

        .menu-card.postest-locked:hover,
        .menu-card.postest-locked:active {
            transform: none;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            border-color: transparent;
        }

        .card-title {
            font-size: 2em;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
            margin-bottom: 20px;
            animation: titleShimmer 3s infinite;
        }

        @keyframes titleShimmer {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .card-description {
            color: #333; /* Color m√°s oscuro para mejor contraste */
            font-size: 1.15em;
            line-height: 1.8;
            font-weight: 500;
        }

        /* PANTALLAS DE CONTENIDO (Mejora visual) */
        .content-screen {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.99), rgba(255, 255, 255, 0.95)); /* M√°s opacidad */
            border-radius: 40px; /* Bordes m√°s suaves */
            padding: 60px;
            max-width: 950px;
            margin: 40px auto;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.4), /* Sombra m√°s profunda */
                        0 0 0 3px rgba(255, 255, 255, 0.5) inset;
            animation: slideUpFade 0.7s ease-out;
            border: 4px solid rgba(102, 126, 234, 0.5); /* Borde m√°s visible */
            backdrop-filter: blur(8px);
            position: relative; /* Necesario para el aura flotante */
            overflow: visible; /* Necesario para que el aura se extienda */
        }

        @keyframes slideUpFade {
            from { transform: translateY(80px) scale(0.95); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        /* BOT√ìN DE REGRESO MEJORADO (M√°s luminoso) */
        .back-button {
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            background-size: 200% 200%;
            animation: gradientMove 3s ease infinite;
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 50px;
            font-size: 1.15em;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 35px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.7), /* M√°s brillo de sombra */
                        0 0 20px rgba(255, 255, 255, 0.5) inset,
                        0 0 15px #f093fb; /* Efecto ne√≥n en bot√≥n */
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .back-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5); /* M√°s brillo al click/hover */
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .back-button:hover::before,
        .back-button:active::before {
            width: 300px;
            height: 300px;
        }

        .back-button:hover,
        .back-button:active {
            transform: translateY(-7px) scale(1.05);
            box-shadow: 0 20px 50px rgba(102, 126, 234, 0.9),
                        0 0 30px rgba(255, 255, 255, 0.7) inset,
                        0 0 20px #4facfe; /* Ne√≥n m√°s fuerte */
        }

        .back-button:active {
            transform: translateY(-3px) scale(1.02);
        }

        /* REGLA 3: ANIMACI√ìN PARA ENCABEZADOS DE SESI√ìN 1 */
        @keyframes bounceGlow {
            0%, 100% { transform: translateY(0) scale(1); filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
            50% { transform: translateY(-5px) scale(1.05); filter: drop-shadow(0 0 10px #FFD700); }
        }

        @keyframes spinGlow {
            0% { transform: rotate(0deg) scale(1); filter: drop-shadow(0 0 5px #764ba2); }
            50% { transform: rotate(180deg) scale(1.1); filter: drop-shadow(0 0 15px #f093fb); }
            100% { transform: rotate(360deg) scale(1); filter: drop-shadow(0 0 5px #764ba2); }
        }

        .content-screen h2 {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 3em;
            margin-bottom: 35px;
            font-weight: 900;
            text-shadow: 0 5px 20px rgba(102, 126, 234, 0.3); /* Sombra de texto suave */
        }

        .content-screen h3 {
            color: #764ba2;
            font-size: 2em;
            margin-top: 35px;
            margin-bottom: 20px;
            font-weight: 700;
            position: relative;
            padding-left: 45px;
        }

        .content-screen h3::before {
            content: '‚≠ê';
            position: absolute;
            left: 0;
            /* ANIMACI√ìN COMBINADA PARA BRILLO Y MOVIMIENTO */
            animation: starTwinkle 2s infinite, spinGlow 8s linear infinite;
            text-shadow: 0 0 8px #FFD700;
            display: inline-block; /* Permitir transformaciones */
        }

        @keyframes starTwinkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.15); }
        }

        .content-screen p {
            color: #333;
            font-size: 1.25em;
            line-height: 2;
            margin-bottom: 25px;
            font-weight: 400;
        }

        .content-screen ul {
            margin-left: 40px;
            margin-bottom: 25px;
        }

        .content-screen li {
            color: #444;
            font-size: 1.2em;
            line-height: 2;
            margin-bottom: 15px;
            position: relative;
            padding-left: 10px;
        }

        .content-screen li::before {
            content: 'üí´';
            position: absolute;
            left: -30px;
            text-shadow: 0 0 5px #f093fb;
        }

        /* SECCIONES CON EFECTO MEJORADO */
        .sections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .section-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            animation: sectionGradient 5s ease infinite;
            border-radius: 25px;
            padding: 40px;
            color: white;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5),
                        0 0 10px rgba(255, 255, 255, 0.5) inset; /* Borde interno brillante */
            border: 3px solid rgba(255, 255, 255, 0.5);
            touch-action: manipulation;
            backdrop-filter: blur(3px);
        }

        @keyframes sectionGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .section-card::before {
            content: '‚ú®';
            position: absolute;
            font-size: 4em;
            opacity: 0.2;
            top: 10px;
            left: 10px;
            animation: starFloat 3s infinite;
            text-shadow: 0 0 10px white;
        }

        @keyframes starFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(180deg); }
        }

        .section-card.locked {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            cursor: not-allowed;
            opacity: 0.6; /* Un poco m√°s de opacidad en bloqueado */
        }

        .section-card:not(.locked):hover,
        .section-card:not(.locked):active {
            transform: translateY(-15px) scale(1.05) rotate(-1deg);
            box-shadow: 0 30px 70px rgba(102, 126, 234, 0.8), /* Sombra hover m√°s fuerte */
                        0 0 40px rgba(255, 255, 255, 0.6);
            border-color: rgba(255, 215, 0, 0.9);
        }

        .section-card:not(.locked):active {
            transform: translateY(-10px) scale(1.02);
        }

        .section-number {
            font-size: 4em;
            font-weight: 900;
            margin-bottom: 15px;
            opacity: 0.3;
            position: absolute;
            top: 15px;
            right: 20px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .section-title {
            font-size: 1.8em;
            font-weight: 800;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            text-shadow: 0 3px 10px rgba(0, 0, 0, 0.5);
        }

        .section-status {
            font-size: 1em;
            opacity: 0.95;
            margin-top: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .lock-icon {
            font-size: 3em;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.5;
            z-index: 0;
            animation: lockShake 2s infinite;
        }

        @keyframes lockShake {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            25% { transform: translate(-50%, -50%) rotate(-5deg); }
            75% { transform: translate(-50%, -50%) rotate(5deg); }
        }

        /* Animaci√≥n de desbloqueo */
        @keyframes unlock {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            50% { transform: scale(1.2) rotate(5deg); }
            75% { transform: scale(1.1) rotate(-2deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .section-card.unlocked {
            animation: unlock 0.8s ease-out;
        }

        /* BADGE DE PROGRESO */
        .progress-badge {
            position: fixed;
            top: 25px;
            right: 25px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0.98));
            padding: 20px 30px;
            border-radius: 50px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4),
                        0 0 0 3px rgba(102, 126, 234, 0.5);
            font-weight: 700;
            color: #667eea;
            z-index: 100;
            animation: badgeSlideIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid rgba(102, 126, 234, 0.3);
        }

        @keyframes badgeSlideIn {
            from { transform: translateX(200px) rotate(180deg); opacity: 0; }
            to { transform: translateX(0) rotate(0deg); opacity: 1; }
        }

        .progress-bar {
            width: 100%;
            height: 12px; /* Un poco m√°s grueso */
            background: rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            margin-top: 12px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2) inset;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
            background-size: 200% 100%;
            animation: progressShine 2s linear infinite;
            border-radius: 12px;
            transition: width 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.8);
        }

        @keyframes progressShine {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        /* FOOTER */
        .footer {
            text-align: center;
            padding: 50px 20px;
            color: white;
            font-size: 1em;
            margin-top: 80px;
        }

        .footer-info {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 30px;
            max-width: 750px;
            margin: 0 auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3),
                        0 0 0 2px rgba(255, 255, 255, 0.3) inset;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* EFECTOS DE CONFETI */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f0f;
            position: absolute;
            animation: confettiFall 3s linear;
            pointer-events: none;
        }

        @keyframes confettiFall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }


        /* ================================================= */
        /* === ESTILOS NUEVOS Y MODIFICADOS PARA SESI√ìN 1 === */
        /* ================================================= */
        
        #session1Screen .content-screen {
            max-width: 1000px;
            padding: 50px 30px;
        }

        #session1Screen .back-button {
            position: absolute; 
            top: 20px; 
            left: 20px;
            margin-bottom: 0; /* Anula el margen del back-button general */
        }
        
        /* REGLA 3: Icono principal de Sesi√≥n 1 con glow */
        .session-header-icon {
            font-size: 5em; 
            color: #764ba2; 
            animation: pulse 2s infinite alternate, bounceGlow 6s ease-in-out infinite; /* Combinaci√≥n de animaciones */
            display: inline-block;
        }
        
        .session-title-gradient {
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text; 
            font-size: 3.5em; 
            margin-top: 10px; 
            font-weight: 900; 
            line-height: 1.2; 
            margin-bottom: 10px;
        }
        
        .content-grid-session1 {
            display: grid; 
            grid-template-columns: 1fr 1.5fr; 
            gap: 30px; 
            margin-top: 30px;
        }

        .card-session {
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2); /* Sombra m√°s fuerte */
            border: 2px solid #ddd;
            height: fit-content;
        }

        .objective-card {
            background: linear-gradient(135deg, #e6e9f0, #eef1f5);
            border-left: 8px solid #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.3); /* Brillo azul */
        }

        .learning-card {
            background: linear-gradient(135deg, #f093fb30, #fff); /* Degradado m√°s transparente */
            border-right: 8px solid #f093fb;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(240, 147, 251, 0.3); /* Brillo rosa */
        }

        .card-session h3 {
            display: flex;
            align-items: center;
            font-size: 1.8em;
            color: #667eea;
            font-weight: 800;
            margin-bottom: 20px;
            padding-left: 0; /* Anular el padding del h3 general */
            text-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }
        
        .card-session h3::before {
            content: none; /* Anular el icono de estrella del h3 general */
        }

        .card-session p {
            color: #444;
            font-size: 1.1em;
            line-height: 1.7;
        }
        
        .learning-list {
            list-style: none;
            padding: 0;
        }

        .learning-list-item {
            background: rgba(255, 255, 255, 0.85); /* M√°s opacidad */
            padding: 15px 20px;
            margin-bottom: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            font-size: 1.15em;
            color: #555;
            font-weight: 600;
            display: flex;
            align-items: flex-start;
            transition: transform 0.3s, box-shadow 0.3s;
            border-left: 5px solid #764ba2;
        }
        
        .learning-list-item span {
            font-size: 1.2em;
            margin-right: 15px;
            color: #FFD700; 
            filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.8)); /* Brillo de estrella */
            animation: starJiggle 1s infinite alternate;
        }

        /* Estilos de Botones de Navegaci√≥n de Sesi√≥n 1 */
        .session1-nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 50px;
        }

        .session-nav-card {
            background: linear-gradient(135deg, #fff, #f0f3ff);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
            border: 2px solid #ddd;
        }

        .session-nav-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25),
                        0 0 10px #667eea; /* Ne√≥n sutil */
            border-color: #667eea;
        }

        .session-nav-card-icon {
            font-size: 3em;
            color: #764ba2;
            margin-bottom: 10px;
        }

        .session-nav-card h4 {
            font-size: 1.4em;
            font-weight: 800;
            color: #667eea;
        }


        /* Animaciones Espec√≠ficas de Sesi√≥n 1 */
        @keyframes pulse {
            0% { transform: scale(1); text-shadow: 0 0 10px rgba(118, 75, 162, 0.5); }
            100% { transform: scale(1.05); text-shadow: 0 0 20px rgba(118, 75, 162, 0.8); }
        }

        @keyframes starJiggle {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(15deg); }
        }

        /* ================================================= */
        /* === NUEVOS ESTILOS PARA DRAG & DROP Y QUIZ === */
        /* ================================================= */
        
        /* Estilos para el juego Drag & Drop (Sesi√≥n 1) */ 
        .drag-pool { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px; 
            padding: 20px; 
            background: #f0f3ff; 
            border-radius: 20px; 
            min-height: 150px; 
            align-items: center; 
            justify-content: center; 
            margin-bottom: 40px; 
            border: 3px dashed #667eea; /* Borde m√°s grueso */ 
        } 
        
       .drag-zones { 
    display: grid; 
    grid-template-columns: 1fr 1fr 1fr; /* <--- CAMBIAR A TRES COLUMNAS */
    gap: 30px; 
}
        
        .token { 
            background: linear-gradient(135deg, #FFD700, #FFC700); 
            color: #444; 
            padding: 15px 25px; 
            border-radius: 12px; 
            font-size: 1.5em; 
            font-weight: 800; 
            cursor: grab; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3), 0 0 8px rgba(255, 215, 0, 0.8); /* Brillo dorado */ 
            transition: transform 0.3s, opacity 0.3s, box-shadow 0.3s; 
            touch-action: none; /* Mejorar el arrastre en m√≥vil */ 
        } 
        
        .token:hover { 
            transform: scale(1.1) rotate(2deg); 
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4); 
        } 
        
        .token.dragging { 
            opacity: 0.8; 
            transform: scale(1.15) rotate(5deg); 
        } 
        
        .token.correct { 
            cursor: default; 
            background: linear-gradient(135deg, #2ecc71, #27ae60); 
            color: white; 
            box-shadow: 0 0 15px rgba(46, 204, 113, 1); /* Brillo verde fuerte */ 
            transform: none !important; 
        } 
        
        .dropzone { 
            background: #e6e9f0; 
            border: 3px dashed #764ba2; 
            border-radius: 20px; 
            padding: 25px; 
            text-align: center; 
            min-height: 250px; 
            transition: all 0.3s;
        } 
        
        .dropzone:hover {
            background: #f0f3ff;
        }
        
        .dropzone.drag-over { 
            background: #dcdfe6; 
            border-color: #667eea; 
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.5); 
        } 
        
        .dropzone.correct-zone {
            background: linear-gradient(135deg, #d4edda, #e2ffe8);
            border-color: #2ecc71;
        }
        
        .drag-pool-title {
            font-size: 1.8em; 
            font-weight: 800; 
            color: #764ba2; 
            margin-bottom: 20px; 
            text-align: center;
        }

        .completion-message {
            margin-top: 30px; 
            padding: 20px; 
            border-radius: 15px; 
            background: linear-gradient(90deg, #f093fb, #4facfe); 
            color: white; 
            font-size: 1.5em; 
            font-weight: 700; 
            text-align: center; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: none;
        }

        /* Estilos para el Quiz */
        .quiz-container {
            margin-top: 30px;
            padding: 40px;
            border-radius: 30px;
            background: linear-gradient(135deg, #f0f3ff, #e9edff);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        }

        .quiz-item {
            padding: 20px 25px;
            margin-bottom: 20px;
            border-radius: 15px;
            background: #ffffff;
            border-left: 5px solid #667eea;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .quiz-item:hover {
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
            border-color: #764ba2;
        }

        .quiz-item label {
            font-size: 1.25em;
            font-weight: 600;
            color: #2c3e50;
        }

        .quiz-input {
            padding: 12px 18px;
            border-radius: 10px;
            border: 2px solid #ccc;
            font-size: 1.15em;
            width: 180px; 
            text-align: right;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .quiz-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
            outline: none;
        }

        .submit-quiz-button {
            margin-top: 30px; 
            width: 100%; 
            background: linear-gradient(45deg, #00f2fe, #4facfe); 
            color: #333; 
            border: none; 
            font-size: 1.3em; 
            font-weight: 800; 
            cursor: pointer; 
            transition: all 0.4s; 
            box-shadow: 0 10px 30px rgba(0, 242, 254, 0.6), 0 0 15px #ffffff inset; 
        } 
        
        .submit-quiz-button:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 15px 40px rgba(0, 242, 254, 0.8), 0 0 20px #ffffff inset; 
        } 
        
        .quiz-results { 
            margin-top: 30px; 
            padding: 25px; 
            border-radius: 15px; 
            background: linear-gradient(135deg, #fff0f7, #ffffff); /* Fondo rosa claro */
            border: 4px solid #f093fb; /* Borde rosa ne√≥n */
            display: none; 
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.4); 
            text-align: left;
        } 
        
        .correct-text { 
            color: #2ecc71; 
            font-weight: 700; 
        } 
        
        .incorrect-text { 
            color: #e74c3c; 
            font-weight: 700; 
        } 
        
        .result-list { 
            list-style: none; 
            padding: 0; 
            margin: 20px 0 0 0; 
            text-align: left; 
        } 
        
        @media (max-width: 768px) { 
            .drag-zones { 
                grid-template-columns: 1fr; 
            } 
        } 

        /* ================================================= */
        /* === MEJORAS VISUALES ADICIONALES (SOLICITADAS) === */
        /* ================================================= */

        /* 1. MEJORA GENERAL DE LECTURA DE CONTENIDO (P, LI) */
        .content-screen p {
            color: #2c3e50; /* Color de texto m√°s profundo para mayor legibilidad */
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.7); /* Sombra de texto suave */
        }

        /* 2. TEOR√çA: Bloques de Conceptos (Enteros Positivos, Cero, Negativos) */
        #session1TheoryScreen ul li {
            margin-bottom: 25px; 
            padding: 25px; 
            border-radius: 25px; 
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15); 
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 2px solid transparent;
            list-style: none;
            font-weight: 500;
        }

        #session1TheoryScreen ul li:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            border-color: #f093fb; /* Borde de enfoque */
        }

        /* Enteros Positivos (Verde Did√°ctico) */
        #session1TheoryScreen ul li:nth-child(1) {
            background: linear-gradient(135deg, #d4edda, #f3fff5); 
            border-left: 10px solid #2ecc71;
        }
        #session1TheoryScreen ul li:nth-child(1) strong {
            color: #27ae60;
        }
        /* REGLA 3: Animaci√≥n para el icono de li */
        #session1TheoryScreen ul li:nth-child(1)::before {
            content: '‚úÖ';
            left: -35px;
            text-shadow: 0 0 5px #2ecc71;
            display: inline-block;
            animation: bounceGlow 4s ease-in-out infinite alternate;
        }

        /* El Cero (Gris/Blanco Neutro) */
        #session1TheoryScreen ul li:nth-child(2) {
            background: linear-gradient(135deg, #f0f4f7, #ffffff);
            border-left: 10px solid #95a5a6;
        }
        #session1TheoryScreen ul li:nth-child(2) strong {
            color: #7f8c8d;
        }
        /* REGLA 3: Animaci√≥n para el icono de li */
        #session1TheoryScreen ul li:nth-child(2)::before {
            content: '‚ö™';
            left: -35px;
            text-shadow: 0 0 5px #95a5a6;
            display: inline-block;
            animation: bounceGlow 4.5s ease-in-out infinite alternate;
        }

        /* Enteros Negativos (Rojo Alerta) */
        #session1TheoryScreen ul li:nth-child(3) {
            background: linear-gradient(135deg, #f8d7da, #fff7f7); 
            border-left: 10px solid #e74c3c;
        }
        #session1TheoryScreen ul li:nth-child(3) strong {
            color: #c0392b;
        }
        /* REGLA 3: Animaci√≥n para el icono de li */
        #session1TheoryScreen ul li:nth-child(3)::before {
            content: '‚ùå';
            left: -35px;
            text-shadow: 0 0 5px #e74c3c;
            display: inline-block;
            animation: bounceGlow 5s ease-in-out infinite alternate;
        }

        /* 3. Bloque de Datos Curiosos */
        #session1TheoryScreen .content-screen p:nth-of-type(4) {
            margin-top: 40px;
            padding: 30px;
            border-radius: 20px;
            background: linear-gradient(135deg, #fceabb, #f8b500); /* Degradado Dorado */
            border: 5px solid #ffcc00;
            box-shadow: 0 15px 40px rgba(255, 198, 0, 0.5);
            font-size: 1.15em;
            line-height: 1.8;
            color: #6d4c41; /* Marr√≥n oscuro para contraste */
            position: relative;
            overflow: hidden;
            font-weight: 600;
            animation: knowledgeGlow 3s infinite alternate;
        }

        #session1TheoryScreen .content-screen p:nth-of-type(4)::after {
            content: 'üìú'; /* √çcono de pergamino/historia */
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 4em;
            opacity: 0.5;
            text-shadow: 0 0 10px #FFD700;
        }

        @keyframes knowledgeGlow {
            0% { transform: scale(1); box-shadow: 0 15px 40px rgba(255, 198, 0, 0.4); }
            100% { transform: scale(1.01); box-shadow: 0 15px 40px rgba(255, 198, 0, 0.7); }
        }

        /* 4. DRAG & DROP: Mejora de Zonas de Soltar */
        #session1DragScreen .dropzone {
            border: 4px dashed; /* Borde m√°s llamativo */
            border-color: #764ba2;
            background: linear-gradient(145deg, #f8faff, #ebedf7); /* Fondo m√°s claro */
            transition: background 0.3s, border-color 0.3s;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        #session1DragScreen .dropzone h3 {
            background: none;
            color: #764ba2;
        }
        
        #session1DragScreen .dropzone p {
            font-size: 1.05em;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        #session1DragScreen .dropzone.drag-over {
            border-color: #f093fb;
            background: linear-gradient(145deg, #f0f3ff, #f3e9f5);
            transform: scale(1.02);
            box-shadow: 0 15px 30px rgba(240, 147, 251, 0.3);
        }

        /* 5. DRAG & DROP: Token de Arrastre */
        .token {
            background: linear-gradient(135deg, #FFD700, #ffc400); /* Dorado m√°s intenso */
            color: #333;
            font-size: 1.6em; /* Un poco m√°s grande */
            border: 2px solid #a88d00;
        }

        .token:hover {
            transform: scale(1.1) rotate(0deg); /* Menos rotaci√≥n en hover para mejor UX */
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4), 0 0 15px #FFD700;
        }

        .token.correct {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border: 2px solid #1e8449;
            animation: correctPulse 0.5s;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* 6. OPERACIONES: Reglas de la Suma/Resta */
        #session1OperationsScreen .content-screen ul {
            list-style: none;
            padding: 0;
        }

        #session1OperationsScreen .content-screen li {
            background: linear-gradient(135deg, #e6f7ff, #f0f8ff); /* Fondo azul beb√© suave */
            color: #0d47a1;
            border-left: 8px solid #42a5f5;
            margin-bottom: 20px;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            line-height: 1.7;
        }

        #session1OperationsScreen .content-screen li:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* Regla 1: Signos Iguales */
        #session1OperationsScreen .content-screen ul:nth-of-type(1) li {
            border-left-color: #ff9800; /* Naranja */
            background: linear-gradient(135deg, #fff3e0, #fff9f0);
            color: #e65100;
        }

        /* Regla 2: Signos Diferentes */
        #session1OperationsScreen .content-screen ul:nth-of-type(2) li {
            border-left-color: #66bb6a; /* Verde lima */
            background: linear-gradient(135deg, #e8f5e9, #f5fff6);
            color: #2e7d32;
        }

        /* Resta como suma del opuesto */
        #session1OperationsScreen .content-screen ul:nth-of-type(3) li {
            border-left-color: #f06292; /* Rosa */
            background: linear-gradient(135deg, #fce4ec, #fff0f5);
            color: #ad1457;
        }

        /* REGLA 3: Animaci√≥n para el icono de li en Operaciones */
        #session1OperationsScreen .content-screen li::before {
            content: '‚û°Ô∏è'; /* Icono de flecha en vez de estrella */
            text-shadow: 0 0 5px #f093fb;
            display: inline-block;
            animation: bounceGlow 4s ease-in-out infinite alternate;
        }

        /* 7. QUIZ: Mejora de Items y Campos de Texto */
        #session1QuizScreen .quiz-container {
            padding: 30px;
            border-radius: 30px;
            background: linear-gradient(135deg, #ffffff, #f7f9ff);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        }

        #session1QuizScreen .quiz-item {
            background: #fdfdff;
            padding: 20px 25px;
            margin-bottom: 15px;
            border-radius: 15px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s;
            display: flex; /* Para alinear label e input */
            align-items: center;
            justify-content: space-between;
        }

        #session1QuizScreen .quiz-item:hover {
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.15);
            border-color: #667eea;
        }

        #session1QuizScreen .quiz-item label {
            font-size: 1.2em;
            font-weight: 600;
            color: #444;
        }

        #session1QuizScreen .quiz-input {
            padding: 12px 18px;
            border-radius: 10px;
            border: 2px solid #ccc;
            font-size: 1.1em;
            width: 180px; /* Ancho fijo para inputs */
            text-align: right;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        #session1QuizScreen .quiz-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
            outline: none;
        }
        
        /* 8. FONDOS ESPEC√çFICOS PARA CADA PANTALLA DE SESI√ìN 1 (Solicitado) */

        /* REGLA 4: Aura flotante base para todos los content-screen de la sesi√≥n 1 */
        .content-screen::before {
            content: '';
            position: absolute;
            top: -5%;
            left: -5%;
            width: 110%;
            height: 110%;
            border-radius: 40px; 
            z-index: -1;
            animation: subtleFloat 15s ease-in-out infinite alternate;
            pointer-events: none;
            filter: blur(40px); /* Soft glow effect */
            opacity: 0.5;
        }

        @keyframes subtleFloat {
            0% { transform: translateY(0) scale(1); opacity: 0.5; }
            100% { transform: translateY(15px) scale(1.02); opacity: 0.8; }
        }

        /* √çndice de Sesi√≥n 1 (Azul suave) */
        #session1Screen .content-screen {
            background: linear-gradient(135deg, #f0f4ff, #e9edff); 
            border: 4px solid rgba(102, 126, 234, 0.5); 
        }
        #session1Screen .content-screen::before {
            background: #667eea; 
        }

        /* Teor√≠a: El Mundo de los N√∫meros Enteros (Rosa/Lila suave) */
        #session1TheoryScreen .content-screen {
            background: linear-gradient(135deg, #fff0f5, #fcf5ff); 
            border: 4px solid rgba(240, 147, 251, 0.5);
        }
        #session1TheoryScreen .content-screen::before {
            background: #f093fb;
            animation-duration: 16s;
        }

        /* Drag & Drop: Clasificaci√≥n (Amarillo/Oro suave) */
        #session1DragScreen .content-screen {
            background: linear-gradient(135deg, #fffcf0, #fffddf); 
            border: 4px solid rgba(255, 215, 0, 0.5);
        }
        #session1DragScreen .content-screen::before {
            background: #FFD700;
            animation-duration: 14s;
        }

        /* Valor Absoluto: Desaf√≠o (Aqua/Menta suave) */
        #session1ChallengeScreen .content-screen {
            background: linear-gradient(135deg, #e6fff4, #f0fff8); 
            border: 4px solid rgba(0, 242, 254, 0.5);
        }
        #session1ChallengeScreen .content-screen::before {
            background: #00f2fe;
            animation-duration: 17s;
        }

        /* Operaciones: Suma y Resta (Naranja/Melocot√≥n suave) */
        #session1OperationsScreen .content-screen {
            background: linear-gradient(135deg, #fff5e6, #fffbf0); 
            border: 4px solid rgba(255, 165, 0, 0.5);
        }
        #session1OperationsScreen .content-screen::before {
            background: #ffa500;
            animation-duration: 18s;
        }

        /* Quiz Final (Blanco puro/Gris claro) */
        #session1QuizScreen .content-screen {
            background: linear-gradient(135deg, #f7f7f7, #ffffff); 
            border: 4px solid rgba(127, 140, 141, 0.5);
        }
        #session1QuizScreen .content-screen::before {
            background: #95a5a6;
            animation-duration: 13s;
        }
/* FONDOS DE COLOR PARA SESI√ìN 2 */

/* Teor√≠a: Multiplicaci√≥n y Divisi√≥n (Verde menta) */
#session2TheoryScreen .content-screen {
    background: linear-gradient(135deg, #e8f5e9, #f1f8f4); 
    border: 4px solid rgba(76, 175, 80, 0.5);
}
#session2TheoryScreen .content-screen::before {
    background: #4caf50;
    animation-duration: 16s;
}

/* Juego en Clase: Batalla de Signos (Naranja) */
#session2GameClassScreen .content-screen {
    background: linear-gradient(135deg, #fff3e0, #fffaf0); 
    border: 4px solid rgba(255, 152, 0, 0.5);
}
#session2GameClassScreen .content-screen::before {
    background: #ff9800;
    animation-duration: 14s;
}

/* Juego Arcade (Morado oscuro) */
#session2ArcadeScreen .content-screen {
    background: linear-gradient(135deg, #f3e5f5, #faf0fc); 
    border: 4px solid rgba(156, 39, 176, 0.5);
}
#session2ArcadeScreen .content-screen::before {
    background: #9c27b0;
    animation-duration: 17s;
}

/* Jerarqu√≠a de Operaciones (Azul √≠ndigo) */
#session2HierarchyScreen .content-screen {
    background: linear-gradient(135deg, #e8eaf6, #f0f1ff); 
    border: 4px solid rgba(63, 81, 181, 0.5);
}
#session2HierarchyScreen .content-screen::before {
    background: #3f51b5;
    animation-duration: 18s;
}

/* Reto 5: Pr√°ctica con Jerarqu√≠a (Naranja/Salm√≥n) */
#session2PracticeScreen .content-screen {
    background: linear-gradient(135deg, #fff3e6, #fffaf5); 
    border: 4px solid rgba(255, 128, 0, 0.5);
}
#session2PracticeScreen .content-screen::before {
    background: #ff8000;
    animation-duration: 15s;
}

/* ========== ESTILOS DEL JUEGO CULEBRITA FRACCIONARIA ========== */

/* Animaci√≥n de rebote para la serpiente */
@keyframes snakeBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-15px); }
}

/* Animaci√≥n de pulso para el bot√≥n de jugar */
@keyframes pulseSnakeBtn {
    0%, 100% { transform: scale(1); box-shadow: 0 8px 25px rgba(156, 39, 176, 0.4); }
    50% { transform: scale(1.05); box-shadow: 0 12px 35px rgba(156, 39, 176, 0.6); }
}

/* Animaci√≥n de temblor para game over */
@keyframes snakeShake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    75% { transform: translateX(10px); }
}

/* Estilo para botones t√°ctiles al presionar */
.snakeControlBtn:active {
    transform: scale(0.9);
    box-shadow: 0 2px 10px rgba(156, 39, 176, 0.4);
}

/* Corazones de vidas */
.snakeHeart {
    font-size: 1.3em;
    transition: all 0.3s;
}

/* Coraz√≥n perdido (gris) */
.snakeHeart.lost {
    filter: grayscale(100%);
    opacity: 0.3;
}

/* Responsive para m√≥viles */
@media (max-width: 600px) {
    #snakeHUD {
        flex-direction: column;
        gap: 8px;
    }
    
    #snakeQuestion p {
        font-size: 1.2em !important;
    }
    
    .snakeControlBtn {
        width: 60px !important;
        height: 60px !important;
        font-size: 1.6em !important;
    }
}

    </style>
</head>
<body>
<div class="stars-container" id="stars-container"></div>
<div class="particles" id="particles"></div>
<div class="progress-badge" id="progressBadge" style="display: none;">
    Progreso Total: <span id="progressText">0%</span>
    <div class="progress-bar">
        <div class="progress-fill" id="progressBarFill" style="width: 0%;"></div>
    </div>
</div>
<div class="container">
    
    <div class="screen active" id="homeScreen">
        <div class="home-screen">
            <div class="logo-container">
                <div class="logo">üéÆ</div>
                <div class="math-symbol-wrapper" id="mathSymbolsWrapper">
                    </div>
            </div>
            <h1>Unidad Did√°ctica Gamificada</h1>
            <p class="subtitle">Matem√°ticas | Grado 8¬∞</p>

            <div class="menu-grid">
                <div class="menu-card" onclick="showScreen('introScreen')">
                    <span class="card-icon">üí°</span>
                    <h2 class="card-title">Misi√≥n Z: Introducci√≥n</h2>
                    <p class="card-description">Descubre el prop√≥sito de esta unidad y la metodolog√≠a de aprendizaje gamificado.</p>
                </div>
                <div class="menu-card" onclick="showScreen('objectivesScreen')">
                    <span class="card-icon">üéØ</span>
                    <h2 class="card-title">Objetivos</h2>
                    <p class="card-description">Conoce las metas espec√≠ficas que alcanzar√°s y c√≥mo ser√° evaluado tu progreso.</p>
                </div>
<div class="menu-card" onclick="window.open('https://andres5050-sudo.github.io/Pretest-Octavo2/', '_blank')">
        <span class="card-icon">üìù</span>
        <h2 class="card-title">Pretest</h2>
        <p class="card-description">Realiza la evaluaci√≥n diagn√≥stica inicial para medir tu nivel antes de comenzar.</p>
    </div>

                <div class="menu-card" onclick="showScreen('sectionsScreen')">
                    <span class="card-icon">üöÄ</span>
                    <h2 class="card-title">Comenzar Aventura</h2>
                    <p class="card-description">Accede a las 6 sesiones de aprendizaje. ¬°Cada sesi√≥n desbloquea la siguiente!</p>
                </div>

<div class="menu-card" id="postestCard" onclick="openPostest()">
        <span class="card-icon">üèÜ</span>
        <h2 class="card-title">Postest</h2>
        <p class="card-description">Evaluaci√≥n final para medir tu progreso despu√©s de completar todas las sesiones.</p>
    </div>
            </div>
        </div>
    </div>

    <div class="screen" id="introScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('homeScreen')">‚Üê Volver al inicio</button>
            <h2>üí° Misi√≥n Z: Introducci√≥n a la Unidad</h2>

            <h3>¬øQu√© aprender√°s?</h3>
            <p>Esta unidad did√°ctica se enfoca en afianzar tus conocimientos sobre los conjuntos num√©ricos fundamentales, espec√≠ficamente:</p>
            <ul>
                <li><strong>N√∫meros Enteros (‚Ñ§):</strong> Valor absoluto, representaci√≥n y operaciones b√°sicas (suma, resta, multiplicaci√≥n y divisi√≥n).</li>
                <li><strong>N√∫meros Racionales (Fracciones):</strong> Concepto, equivalencia, simplificaci√≥n y las 4 operaciones fundamentales con signos.</li>
            </ul>

            <h3>Estructura de las Sesiones</h3>
            <p>La unidad est√° dividida en 6 sesiones, cada una con una serie de retos y actividades que deber√°s completar para avanzar. ¬°El √©xito en una sesi√≥n desbloquea la siguiente!</p>
            <ul>
                <li><strong>Sesi√≥n 1:</strong> N√∫meros enteros (I): concepto, valor absoluto, suma y resta con signos.</li>
                <li><strong>Sesi√≥n 2:</strong> N√∫meros enteros (II): multiplicaci√≥n, divisi√≥n y jerarqu√≠a de operaciones (b√°sica).</li>
                <li><strong>Sesi√≥n 3:</strong> Jerarqu√≠a completa de operaciones combinadas con n√∫meros enteros.</li>
                <li><strong>Sesi√≥n 4:</strong> Fracciones (I): concepto, equivalencia y simplificaci√≥n.</li>
                <li><strong>Sesi√≥n 5:</strong> Fracciones (II): suma y resta con igual y distinto denominador (con signos).</li>
                <li><strong>Sesi√≥n 6:</strong> Fracciones (III): multiplicaci√≥n, divisi√≥n y expresiones combinadas.</li>
            </ul>

            <h3>¬øPor qu√© es diferente esta unidad?</h3>
            <ul>
                <li><strong>üéÆ Aprendizaje Activo:</strong> No ser√°s un espectador pasivo. Resolver√°s desaf√≠os, completar√°s misiones y subir√°s de nivel mientras aprendes.</li>
                <li><strong>üí° Aprendizaje Significativo:</strong> Conectar√°s los nuevos conceptos matem√°ticos con lo que ya sabes.</li>
                <li><strong>üöÄ Progreso Visible:</strong> Sabr√°s exactamente cu√°nto has avanzado y qu√© te falta por lograr.</li>
            </ul>

            <p>Esta experiencia no es solo una clase, es una Misi√≥n Z. Tu participaci√≥n en este proyecto es fundamental, ya que esta investigaci√≥n busca evaluar c√≥mo las estrategias gamificadas mediadas por tecnolog√≠a pueden mejorar tu aprendizaje significativo en matem√°ticas.</p>

            <p>No est√°s solo en este viaje. Tu participaci√≥n activa, tus opiniones y tus avances son fundamentales para transformar la ense√±anza de las matem√°ticas, no solo en nuestro colegio, sino potencialmente en muchos otros.</p>

            <h3>¬øListo para comenzar?</h3>
            <p>Explora los objetivos y luego sum√©rgete en las 6 sesiones dise√±adas para ti. Recuerda: cada sesi√≥n debe completarse antes de desbloquear la siguiente. ¬°El desaf√≠o te espera!</p>
        </div>
    </div>

    <div class="screen" id="objectivesScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('homeScreen')">‚Üê Volver al inicio</button>
            <h2>üéØ Objetivos de la Unidad Did√°ctica</h2>

            <h3>Objetivo General</h3>
            <p>Evaluar los efectos de la implementaci√≥n de estrategias de gamificaci√≥n mediadas por tecnolog√≠a en el aprendizaje significativo de matem√°ticas en estudiantes de grado octavo, transformando tu experiencia educativa en algo memorable y efectivo.</p>

            <h3>Objetivos Espec√≠ficos</h3>

            <h3>1Ô∏è‚É£ Diagnosticar tu Punto de Partida (Pretest)</h3>
            <p>Antes de comenzar las sesiones, realizar√°s una <strong>evaluaci√≥n inicial (pretest)</strong> que nos permitir√° identificar tu nivel actual de comprensi√≥n matem√°tica sobre n√∫meros enteros y fracciones. Esta prueba diagn√≥stica nos ayuda a:</p>
            <ul>
                <li>üìä Conocer tus conocimientos previos sobre el tema.</li>
                <li>üéØ Ajustar la unidad did√°ctica a tus necesidades.</li>
                <li>üõ†Ô∏è Servir como l√≠nea base para medir tu progreso.</li>
            </ul>

            <h3>2Ô∏è‚É£ Inmersi√≥n en las Sesiones (Gamificaci√≥n)</h3>
            <p>Durante las 6 sesiones, participar√°s en actividades dise√±adas bajo el marco de la gamificaci√≥n, que incluyen:</p>
            <ul>
                <li>üìö <strong>Recursos Digitales Interactivos:</strong> Videos, infograf√≠as y simulaciones para una mejor comprensi√≥n.</li>
                <li>üí° <strong>Retos y Misiones:</strong> Actividades de arrastrar y soltar, minijuegos y desaf√≠os de c√°lculo que te dar√°n puntos y medir√°n tu progreso.</li>
                <li>üìà <strong>Feedback Inmediato:</strong> Sabr√°s al instante si tus respuestas son correctas o incorrectas, acelerando tu aprendizaje.</li>
                <li>ü§ù <strong>Trabajo Colaborativo:</strong> Actividades en equipo que enriquecen tu comprensi√≥n mediante la interacci√≥n con tus compa√±eros.</li>
            </ul>

            <h3>3Ô∏è‚É£ Evaluar el Cambio (Postest)</h3>
            <p>Al finalizar las 6 sesiones, realizar√°s la <strong>misma evaluaci√≥n (postest)</strong> que hiciste al inicio. Esto nos permitir√°:</p>
            <ul>
                <li>‚úÖ Medir objetivamente cu√°nto has avanzado en tu aprendizaje.</li>
                <li>‚úÖ Comparar tu nivel inicial con tu nivel final.</li>
                <li>‚úÖ Evaluar la efectividad de la gamificaci√≥n en tu caso particular.</li>
                <li>‚úÖ Identificar los aspectos donde nuestra intervenci√≥n ha tenido mayor impacto.</li>
            </ul>

            <h3>El Aprendizaje Significativo</h3>
            <p>Buscamos que tu aprendizaje sea <strong>significativo</strong>, lo que implica:</p>
            <ul>
                <li>üí° Poder explicar los conceptos con tus propias palabras.</li>
                <li>üîó Relacionar ideas nuevas con conocimientos que ya ten√≠as.</li>
                <li>üéØ Aplicar lo aprendido en situaciones diferentes a las vistas en clase.</li>
                <li>üß† Comprender el "por qu√©" detr√°s de cada procedimiento matem√°tico.</li>
            </ul>

            <h3>üåü Tu Rol es Fundamental</h3>
            <p>No eres un "sujeto de estudio", sino un <strong>participante activo</strong> cuya voz importa. Tus opiniones, dudas, descubrimientos y sugerencias ser√°n escuchadas y valoradas durante todo el proceso. Tu experiencia ayudar√° a mejorar la ense√±anza de las matem√°ticas para futuras generaciones.</p>

            <h3>üî¨ Enfoque de Investigaci√≥n-Acci√≥n</h3>
            <p>Esta unidad did√°ctica se basa en un modelo de investigaci√≥n-acci√≥n, lo que significa que:</p>
            <ul>
                <li>üìä Se monitorea constantemente qu√© funciona y qu√© puede mejorar.</li>
                <li>üîÑ Se realizan ajustes sobre la marcha para optimizar tu experiencia.</li>
                <li>ü§ù Docentes y estudiantes colaboran en la construcci√≥n del conocimiento.</li>
                <li>üéì El objetivo final es transformar positivamente tu aprendizaje.</li>
                <li>üìù El pretest y postest proporcionan evidencia cient√≠fica del impacto de la gamificaci√≥n.</li>
            </ul>

            <p style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15)); border-radius: 20px; border-left: 6px solid #667eea; box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);"> <strong>üí™ ¬°Tu esfuerzo es parte de esta gran misi√≥n!</strong></p>
        </div>
    </div>
    
    <div class="screen" id="sectionsScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('homeScreen')">‚Üê Volver al inicio</button>
            <h2>üó∫Ô∏è Mapa de Sesiones: Misi√≥n Z</h2>
            <p style="font-size: 1.25em; line-height: 1.8; margin-bottom: 25px;">Selecciona una sesi√≥n para comenzar. Debes completar cada una para desbloquear la siguiente y avanzar en la Misi√≥n Z. ¬°Prep√°rate para subir de nivel!</p>

            <div class="sections-grid">
                <div class="section-card" data-section="1" onclick="enterSection(1)">
                    <div class="section-number">01</div>
                    <div class="section-title">üéØ Sesi√≥n 1</div>
                    <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.95;">N√∫meros enteros y operaciones b√°sicas (I).</div>
                    <div class="section-status">
                        <span>‚óè</span> Disponible - ¬°Comienza aqu√≠!
                    </div>
                </div>

                <div class="section-card locked" data-section="2">
                    <div class="lock-icon">üîí</div>
                    <div class="section-number">02</div>
                    <div class="section-title">‚ú® Sesi√≥n 2</div>
                    <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.95;">Operaciones con enteros (II): multiplicaci√≥n, divisi√≥n y jerarqu√≠a b√°sica.</div>
                    <div class="section-status">
                        <span>üîí</span> Bloqueada - Completa la Sesi√≥n 1.
                    </div>
                </div>

                <div class="section-card locked" data-section="3">
                    <div class="lock-icon">üîí</div>
                    <div class="section-number">03</div>
                    <div class="section-title">üß† Sesi√≥n 3</div>
                    <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.95;">Jerarqu√≠a completa de operaciones combinadas con enteros.</div>
                    <div class="section-status">
                        <span>üîí</span> Bloqueada - Completa la Sesi√≥n 2.
                    </div>
                </div>

                <div class="section-card locked" data-section="4">
                    <div class="lock-icon">üîí</div>
                    <div class="section-number">04</div>
                    <div class="section-title">‚ö° Sesi√≥n 4</div>
                    <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.95;">Fracciones (I): concepto, equivalencia y simplificaci√≥n.</div>
                    <div class="section-status">
                        <span>üîí</span> Bloqueada - Completa la Sesi√≥n 3.
                    </div>
                </div>

                <div class="section-card locked" data-section="5">
                    <div class="lock-icon">üîí</div>
                    <div class="section-number">05</div>
                    <div class="section-title">üé® Sesi√≥n 5</div>
                    <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.95;">Fracciones (II): suma y resta con igual y distinto denominador (con signos).</div>
                    <div class="section-status">
                        <span>üîí</span> Bloqueada - Completa la Sesi√≥n 4.
                    </div>
                </div>

                <div class="section-card locked" data-section="6">
                    <div class="lock-icon">üîí</div>
                    <div class="section-number">06</div>
                    <div class="section-title">üèÜ Sesi√≥n 6</div>
                    <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.95;">Fracciones (III): multiplicaci√≥n, divisi√≥n y expresiones combinadas.</div>
                    <div class="section-status">
                        <span>üîí</span> Bloqueada - Completa la Sesi√≥n 5.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="screen" id="session1Screen">
        <div class="content-screen" style="position: relative;">
            <button class="back-button" onclick="showScreen('sectionsScreen')" style="z-index: 10;">‚Üê Volver al mapa</button>
            <div style="text-align: center; margin-top: 30px;">
                <div class="session-header-icon">üéØ</div>
                <h2 class="session-title-gradient">Sesi√≥n 1: N√∫meros Enteros (I)</h2>
                <p style="font-size: 1.3em; color: #555; font-weight: 500;">¬°Tu aventura con los n√∫meros enteros comienza aqu√≠!</p>
            </div>

            <div class="content-grid-session1">
                <div class="card-session objective-card">
                    <h3>Objetivo de Sesi√≥n</h3>
                    <p>Al finalizar esta sesi√≥n, ser√°s capaz de identificar y clasificar los n√∫meros enteros, calcular su valor absoluto y aplicar las reglas de la suma y la resta con precisi√≥n en cualquier situaci√≥n.</p>
                </div>
                <div class="card-session learning-card">
                    <h3>Ruta de Aprendizaje</h3>
                    <ul class="learning-list">
                        <li class="learning-list-item" onclick="showScreen('session1TheoryScreen')"><span>üìö</span> Teor√≠a: El Mundo de los N√∫meros (Reto Inicial).</li>
                        <li class="learning-list-item" onclick="showScreen('session1DragScreen')"><span>üí°</span> Clasificaci√≥n de N√∫meros (Reto de Arrastre).</li>
                        <li class="learning-list-item" onclick="showScreen('session1ChallengeScreen')"><span>üèÜ</span> Valor Absoluto: El Desaf√≠o de la Distancia al Cero.</li>
                        <li class="learning-list-item" onclick="showScreen('session1OperationsScreen')"><span>‚ûï</span> Suma y Resta de Enteros: Reglas y Batalla de Operaciones.</li>
                        <li class="learning-list-item" onclick="showScreen('session1QuizScreen')"><span>üìù</span> Quiz Final: Prueba de Dominio de Enteros.</li>
                    </ul>
                </div>
            </div>

            <div class="session1-nav-grid">
                <div class="session-nav-card" onclick="showScreen('session1TheoryScreen')">
                    <div class="session-nav-card-icon">üìö</div>
                    <h4>1. Teor√≠a</h4>
                </div>
                <div class="session-nav-card" onclick="showScreen('session1DragScreen')">
                    <div class="session-nav-card-icon">üí°</div>
                    <h4>2. Clasificaci√≥n de N√∫meros</h4>
                </div>
                <div class="session-nav-card" onclick="showScreen('session1ChallengeScreen')">
                    <div class="session-nav-card-icon">üìè</div>
                    <h4>3. Valor Absoluto</h4>
                </div>
                <div class="session-nav-card" onclick="showScreen('session1OperationsScreen')">
                    <div class="session-nav-card-icon">‚öîÔ∏è</div>
                    <h4>4. Operaciones</h4>
                </div>
                <div class="session-nav-card" onclick="showScreen('session1QuizScreen')">
                    <div class="session-nav-card-icon">‚úÖ</div>
                    <h4>5. Quiz Final</h4>
                </div>
            </div>
        </div>
    </div>

    <div class="screen" id="session1TheoryScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('session1Screen')"> ‚Üê Volver a Sesi√≥n 1 </button>
            <div style="position: relative; text-align: center; margin-bottom: 30px;">
                <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                    <span class="math-symbol" style="position: absolute; left: 10%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">üìñ</span>
                    <span class="math-symbol" style="position: absolute; left: 85%; top: 30%; font-size: 2em; animation: floatMath 7s ease-in-out infinite; animation-delay: 0.5s;">üßÆ</span>
                    <span class="math-symbol" style="position: absolute; left: 15%; top: 60%; font-size: 2.2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s;">üìê</span>
                    <span class="math-symbol" style="position: absolute; left: 80%; top: 70%; font-size: 2.3em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 1.5s;">‚úèÔ∏è</span>
                </div>
                <h2 style="position: relative; z-index: 1;">üìö Teor√≠a: El Mundo de los N√∫meros Enteros (‚Ñ§)</h2>
            </div>

            <h3>¬øQu√© son los N√∫meros Enteros (‚Ñ§)?</h3>
            <p>Imagina una l√≠nea infinita con un punto central marcado como cero (0). A la derecha del cero est√°n los n√∫meros positivos: 1, 2, 3, 4... que van creciendo sin l√≠mite. A la izquierda del cero est√°n sus "hermanos opuestos", los n√∫meros negativos: -1, -2, -3, -4... que van decreciendo infinitamente. Todos ellos juntos forman la familia de los n√∫meros enteros, representada con el s√≠mbolo <strong>‚Ñ§</strong>.</p>
            
            <p>Piensa en el cero como el "punto de equilibrio" de una balanza. Todo lo que est√° a la derecha es ganancia, avance o lo positivo. Todo lo que est√° a la izquierda es p√©rdida, retroceso o lo negativo. Pero ambos lados son igual de importantes en matem√°ticas y en la vida real.</p>
            
            <h3>Los Tres Grupos de la Familia Entera</h3>
            <ul>
                <li><strong>Enteros Positivos (‚Ñ§‚Å∫ o ‚Ñï - N√∫meros Naturales):</strong> Son todos los n√∫meros mayores que cero. Cuando cuentas objetos, est√°s usando n√∫meros positivos. Por ejemplo: 1 manzana, 2 libros, 100 pesos de ganancia, 15 grados sobre cero. Se escriben con el signo + adelante o sin signo (ya que se asume que son positivos). Ejemplos: +5, +10, 20, 3.</li>
                
                <li><strong>El Cero (0):</strong> Es el n√∫mero neutral, el punto de referencia. No es positivo ni negativo. Representa "nada", pero tambi√©n significa el punto de partida. Es como estar en el piso 0 de un edificio (la planta baja), tener 0 grados Celsius (punto de congelaci√≥n del agua), o tener un saldo bancario de $0 (ni debes ni te sobra nada).</li>
                
                <li><strong>Enteros Negativos (‚Ñ§‚Åª):</strong> Son todos los n√∫meros menores que cero. Representan lo opuesto a los positivos. Siempre llevan el signo menos (-) adelante. Por ejemplo: si subes 3 pisos, escribes +3; si bajas 3 pisos, escribes -3. Otros ejemplos: -5¬∞C (5 grados bajo cero), -$1000 (debo mil pesos), -20 metros (20 metros bajo el nivel del mar).</li>
            </ul>

            <h3>¬øPor qu√© son importantes en la vida real?</h3>
            <p>Los n√∫meros negativos no son solo una invenci√≥n matem√°tica abstracta. Los usamos constantemente sin darnos cuenta:</p>
            <ul>
                <li><strong>üå°Ô∏è Temperatura:</strong> En Bogot√°, si la temperatura baja a 5 grados, la escribimos como +5¬∞C. Pero en pa√≠ses fr√≠os como Rusia o Canad√°, las temperaturas pueden ser de -15¬∞C (quince grados bajo cero). El cero es el punto de congelaci√≥n del agua.</li>
                
                <li><strong>üí∏ Dinero y Deudas:</strong> Si tienes $50.000 en tu cuenta bancaria, tu saldo es +$50.000. Pero si gastas $70.000 cuando solo ten√≠as $50.000, ahora tu saldo es -$20.000 (debes veinte mil pesos al banco). El banco te muestra este n√∫mero negativo para que sepas que est√°s en deuda.</li>
                
                <li><strong>üèîÔ∏è Altura y Profundidad:</strong> El nivel del mar es nuestro cero de referencia. El Pico Crist√≥bal Col√≥n en la Sierra Nevada tiene +5775 metros sobre el nivel del mar. Pero si un submarino est√° explorando el oc√©ano a 300 metros de profundidad, su altitud es de -300 metros (bajo el nivel del mar).</li>
                
                <li><strong>üéÆ Videojuegos:</strong> Tu personaje tiene 100 puntos de vida (+100). Si recibe un ataque de 30 puntos, el cambio es -30, dej√°ndote con 70 puntos. Los n√∫meros negativos representan p√©rdidas o da√±os.</li>
                
                <li><strong>üè¢ Edificios:</strong> Imagina que est√°s en un edificio. El piso 0 es la planta baja. Los pisos superiores son +1, +2, +3 (primer piso, segundo, tercero). Pero muchos edificios tienen s√≥tanos o parqueaderos subterr√°neos: piso -1, piso -2, piso -3. El signo negativo indica que est√°n bajo tierra.</li>
            </ul>

            <h3>üìñ ¬øSab√≠as que...?</h3>
            <p>Durante muchos siglos en Europa, los matem√°ticos rechazaban los n√∫meros negativos porque pensaban que "no ten√≠an sentido". ¬øC√≥mo puedes tener menos de cero manzanas? Pero los comerciantes chinos de la antigua Dinast√≠a Han (200 a.C. - 220 d.C.) ya los usaban hace m√°s de 2000 a√±os. Usaban varillas rojas para representar ganancias (n√∫meros positivos) y varillas negras para representar deudas (n√∫meros negativos). De ah√≠ viene la expresi√≥n "estar en n√∫meros rojos" cuando una empresa tiene p√©rdidas. ¬°Los n√∫meros negativos tienen una historia milenaria y han ayudado a la humanidad a entender mejor el mundo!</p>

            <p style="margin-top: 35px; font-size: 1.1em; color: #764ba2;">Tiempo Sugerido: <strong>15 min</strong> (Teor√≠a + Ejemplos).</p>

            <div style="text-align: right; margin-top: 40px;">
                <button class="start-activity-button back-button" onclick="completeSubActivity(1, 1); showScreen('session1DragScreen');">Continuar al Reto 2 ‚Üí</button>
            </div>
        </div>
    </div>

    <div class="screen" id="session1DragScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('session1Screen')"> ‚Üê Volver a Sesi√≥n 1 </button>
            <div style="position: relative; text-align: center; margin-bottom: 30px;">
                <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                    <span class="math-symbol" style="position: absolute; left: 12%; top: 25%; font-size: 2.5em; animation: floatMath 6.5s ease-in-out infinite;">üéØ</span>
                    <span class="math-symbol" style="position: absolute; left: 82%; top: 35%; font-size: 2em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 0.7s;">üî¢</span>
                    <span class="math-symbol" style="position: absolute; left: 18%; top: 55%; font-size: 2.2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1.2s;">üé≤</span>
                    <span class="math-symbol" style="position: absolute; left: 78%; top: 65%; font-size: 2.3em; animation: floatMath 7s ease-in-out infinite; animation-delay: 1.8s;">üß©</span>
                </div>
                <h2 style="position: relative; z-index: 1;">üí° Reto de Clasificaci√≥n de N√∫meros</h2>
            </div>

            <p style="font-size: 1.25em; line-height: 1.8; margin-bottom: 25px;"><strong>¬°Misi√≥n de Clasificaci√≥n!</strong> Arrastra cada uno de los 15 n√∫meros de la piscina inferior a la zona de destino correcta: Enteros Positivos o Enteros Negativos.</p>
            
            <p class="drag-pool-title">Piscina de N√∫meros (Arrastra los tokens)</p>
            <div id="dragPool" class="drag-pool">
<div class="drag-token" draggable="true" ondragstart="dragStart(event)" id="token_pi" data-value="œÄ">œÄ</div>
<div class="drag-token" draggable="true" ondragstart="dragStart(event)" id="token_root2" data-value="‚àö2">‚àö2</div>
<div class="drag-token" draggable="true" ondragstart="dragStart(event)" id="token_nonperiodic" data-value="2.718...">2.718...</div>
<div class="drag-token" draggable="true" ondragstart="dragStart(event)" id="token_periodic" data-value="-0.1212...">-0.1212...</div>
                </div>

         <div class="drag-zones">
    <div id="dropPositivos" class="dropzone" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event)">
        <h3>Enteros Positivos (‚Ñ§‚Å∫)</h3>
        <p style="color: #27ae60; font-weight: 700;">(N√∫meros mayores que 0)</p>
    </div>

    <div id="dropNoEnteros" class="dropzone" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event)">
        <h3 style="color: #4facfe;">N√∫meros No Enteros </h3>
        <p style="color: #4facfe; font-weight: 700;">(Racionales no enteros e Irracionales)</p>
    </div>

    <div id="dropNegativos" class="dropzone" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="drop(event)">
        <h3>Enteros Negativos (‚Ñ§‚Åª)</h3>
        <p style="color: #e74c3c; font-weight: 700;">(N√∫meros menores que 0)</p>
    </div>
</div>
            <p id="completionMessage" class="completion-message"></p>

            <div style="text-align: right; margin-top: 40px;">
                <button class="start-activity-button back-button" onclick="completeSubActivity(1, 2); showScreen('session1ChallengeScreen');">Continuar al Reto 3 ‚Üí</button>
            </div>
        </div>
    </div>

    <div class="screen" id="session1ChallengeScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('session1Screen')"> ‚Üê Volver a Sesi√≥n 1 </button>
            <div style="position: relative; text-align: center; margin-bottom: 30px;">
                <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                    <span class="math-symbol" style="position: absolute; left: 8%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">üéñÔ∏è</span>
                    <span class="math-symbol" style="position: absolute; left: 88%; top: 30%; font-size: 2em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 0.6s;">üìè</span>
                    <span class="math-symbol" style="position: absolute; left: 10%; top: 58%; font-size: 2.2em; animation: floatMath 8.5s ease-in-out infinite; animation-delay: 1.1s;">üé™</span>
                    <span class="math-symbol" style="position: absolute; left: 85%; top: 68%; font-size: 2.3em; animation: floatMath 7.2s ease-in-out infinite; animation-delay: 1.7s;">‚öñÔ∏è</span>
                </div>
                <h2 style="position: relative; z-index: 1;">üèÜ Valor Absoluto: El Desaf√≠o de la Distancia al Cero</h2>
            </div>

            <h3>¬øQu√© es el Valor Absoluto?</h3>
            <p>El valor absoluto de un n√∫mero entero se refiere a la <strong>distancia</strong> que existe entre ese n√∫mero y el cero (0) en la recta num√©rica. Se representa con barras verticales: <strong>|a|</strong>.</p>
            <ul>
                <li>El valor absoluto de un n√∫mero positivo es el mismo n√∫mero: <strong>|+a| = a</strong>.</li>
                <li>El valor absoluto de un n√∫mero negativo es su opuesto (el n√∫mero positivo): <strong>|‚àía| = a</strong>.</li>
                <li>El valor absoluto de cero es cero: <strong>|0| = 0</strong>.</li>
            </ul>

            <p>En esencia, el valor absoluto siempre es una cantidad **positiva** o **cero**, porque una distancia nunca puede ser negativa.</p>

            <h3>Valor Absoluto en la vida real</h3>
            <p>Piensa en el valor absoluto como la magnitud, sin considerar la direcci√≥n:</p>
            <ul>
                <li><strong>Nivel del Mar:</strong> Un submarino est√° a -20 metros (-20m) y un dron vuela a +20 metros (+20m). La distancia de ambos al nivel del mar (0) es <strong>20 metros</strong>. <strong>|-20| = 20</strong> y <strong>|20| = 20</strong>.</li>
                <li><strong>Carrera Este/Oeste:</strong> Si un corredor se desplaza 5 km al Este (+5 km) y otro 5 km al Oeste (-5 km), ambos han recorrido una distancia de <strong>5 km</strong> desde el punto de partida (0).</li>
                <li><strong>Diferencia de Goles:</strong> Un equipo con +3 goles y otro con -3 goles tienen una diferencia de <strong>3 goles</strong> respecto al punto de equilibrio (0).</li>
            </ul>

            

<!-- üèÅ MINIJUEGO: CARRERA DE DISTANCIAS -->
<div style="background: linear-gradient(135deg, #b2ebf2, #e1f5fe);
            border-left: 8px solid #00acc1;
            border-radius: 25px;
            padding: 35px 40px;
            margin-top: 40px;
            color: #0d47a1;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            animation: fadeInBox 1s ease-in-out;">

  <h2 style="color:#00796b; font-size:2em; margin-bottom:10px;">
    ‚≠ê Minijuego: Carrera de Distancias
  </h2>

  <p style="font-size:1.1em; color:#004d40; margin-bottom:15px;">
    <strong>Din√°mica en el Aula (Apoyo Visual en Pantalla):</strong>
  </p>

  <ul style="font-size:1.05em; line-height:1.8; margin-left:25px; color:#01579b;">
    <li>üè´ El docente mostrar√° o repartir√° tarjetas con n√∫meros enteros (positivos, negativos y el cero).</li>
    <li>üß© Los grupos deber√°n <strong>ordenar los n√∫meros desde el m√°s cercano al 0 hasta el m√°s lejano</strong>, aplicando el concepto de <strong>valor absoluto</strong>.</li>
    <li>üèÉ‚Äç‚ôÇÔ∏è El n√∫mero m√°s cercano al 0 ‚Äúva ganando la carrera‚Äù, y los m√°s alejados ‚Äúvan atr√°s‚Äù.</li>
  </ul>

  <h3 style="color:#00796b; margin-top:25px;">üí° Ejemplo:</h3>
  <p>Si las tarjetas son: <strong>‚àí4, ‚àí1, 3, 0, 2, ‚àí3</strong></p>

  <p>El orden correcto por <strong>valor absoluto</strong> ser√≠a:</p>

  <div style="background: rgba(255,255,255,0.9);
              padding: 15px;
              border-radius: 15px;
              text-align: center;
              font-size: 1.2em;
              color: #1565c0;
              margin: 12px 0;
              box-shadow: 0 4px 15px rgba(0,0,0,0.1);
              border: 2px dashed #81d4fa;">
      0, ‚àí1, 2, ‚àí3, 3, ‚àí4
  </div>

  <p><strong style="color:#d81b60;">Puntuaci√≥n:</strong>
     <span style="color:#1a237e;">+10 puntos</span> por cada posici√≥n correcta en la secuencia y
     <span style="color:#1a237e;">+20 puntos extra</span> si toda la secuencia est√° perfecta al primer intento.
  </p>

  <p><strong style="color:#004d40;">Objetivo:</strong> Comprender el
     <strong style="color:#f57f17;">valor absoluto</strong> como la distancia al cero y aplicarlo para comparar n√∫meros positivos y negativos.
  </p>

  <p style="font-size: 1em; color: #6a1b9a; font-weight: 600; margin-top: 20px;">
    ‚è±Ô∏è <strong>Tiempo Sugerido:</strong> 10 min (Juego)
  </p>
</div>

<!-- Peque√±a animaci√≥n para que aparezca suave -->
<style>
@keyframes fadeInBox {
  from {opacity: 0; transform: translateY(20px);}
  to {opacity: 1; transform: translateY(0);}
}
</style>




            <div style="text-align: right; margin-top: 40px;">
                <button class="start-activity-button back-button" onclick="completeSubActivity(1, 3); showScreen('session1OperationsScreen');">Continuar al Reto 4 ‚Üí</button>
            </div>
        </div>
    </div>

    <div class="screen" id="session1OperationsScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('session1Screen')"> ‚Üê Volver a Sesi√≥n 1 </button>
            <div style="position: relative; text-align: center; margin-bottom: 30px;">
                <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                    <span class="math-symbol" style="position: absolute; left: 13%; top: 22%; font-size: 2.5em; animation: floatMath 6.8s ease-in-out infinite;">‚ûï</span>
                    <span class="math-symbol" style="position: absolute; left: 80%; top: 32%; font-size: 2em; animation: floatMath 7.3s ease-in-out infinite; animation-delay: 0.8s;">‚ûñ</span>
                    <span class="math-symbol" style="position: absolute; left: 15%; top: 52%; font-size: 2.2em; animation: floatMath 8.2s ease-in-out infinite; animation-delay: 1.3s;">üé≠</span>
                    <span class="math-symbol" style="position: absolute; left: 83%; top: 72%; font-size: 2.3em; animation: floatMath 7.7s ease-in-out infinite; animation-delay: 1.9s;">‚ö°</span>
                </div>
                <h2 style="position: relative; z-index: 1;">‚öîÔ∏è Suma y Resta de Enteros: La Batalla de Operaciones</h2>
            </div>

            <h3>Reglas para la Suma de N√∫meros Enteros</h3>

            <h4>1. Sumar n√∫meros con el Mismo Signo (Ganancia + Ganancia)</h4>
            <p>Se **suman** sus valores absolutos y se **conserva** el signo que tienen en com√∫n.</p>
            <ul>
                <li><strong>Ejemplo 1:</strong> (+5) + (+3) = +8</li>
                <li><strong>Ejemplo 2:</strong> (‚àí5) + (‚àí3) = ‚àí8</li>
            </ul>

            <h4>2. Sumar n√∫meros con Signos Diferentes (Ganancia + P√©rdida)</h4>
            <p>Se **restan** sus valores absolutos (el mayor menos el menor) y se **conserva** el signo del n√∫mero que tiene el mayor valor absoluto.</p>
            <ul>
                <li><strong>Ejemplo 1:</strong> (+7) + (‚àí4) = +3 (7 es mayor que 4, y es positivo)</li>
                <li><strong>Ejemplo 2:</strong> (‚àí9) + (+5) = ‚àí4 (9 es mayor que 5, y es negativo)</li>
            </ul>

            <h3>Regla para la Resta de N√∫meros Enteros</h3>
            <p>La clave para la resta es convertirla en una **suma del opuesto**:</p>
            <p>La operaci√≥n <strong>A ‚àí B</strong> se convierte en <strong>A + (‚àíB)</strong>.</p>
            <ul>
                <li><strong>Paso 1:</strong> Reemplaza el signo de resta (‚Äì) por el de suma (+).</li>
                <li><strong>Paso 2:</strong> Cambia el n√∫mero que sigue (el sustraendo) por su <strong>opuesto</strong> (su signo).</li>
                <li><strong>Paso 3:</strong> Aplica las reglas de la suma (signos iguales o diferentes).</li>
            </ul>
            <p style="padding-left: 20px;"><strong>Ej. 1: 5 ‚àí (‚àí3)</strong> ‚Üí Se convierte en <strong>5 + (+3) = 8</strong>.</p>
            <p style="padding-left: 20px;"><strong>Ej. 2: (‚àí7) ‚àí (+2)</strong> ‚Üí Se convierte en <strong>(‚àí7) + (‚àí2) = ‚àí9</strong> (Signos iguales, se suman y se conserva el signo).</p>
            <p style="padding-left: 20px;"><strong>Ej. 3: 10 ‚àí 15</strong> (que es 10 ‚àí (+15)) ‚Üí Se convierte en <strong>10 + (‚àí15) = ‚àí5</strong> (Signos diferentes, se restan y el 15 tiene mayor magnitud y es negativo).</p>

            <h3>Analog√≠as para Comprender</h3>
            <p>Piensa en la recta num√©rica o en ganancias/p√©rdidas:</p>
            <ul>
                <li>Sumar un positivo es <strong>avanzar</strong>. Sumar un negativo es <strong>retroceder</strong>.</li>
                <li>Restar un negativo es <strong>eliminar una deuda</strong> (¬°una ganancia!). <strong>5 ‚àí (‚àí3)</strong> es tener 5 y que te quiten una deuda de 3. Resultado: tienes 8.</li>
                <li><strong>(+12) + (‚àí5):</strong> Ganas 12 y pierdes 5. El resultado final es una ganancia de 7.</li>
            </ul>

            <h3>Juego Grupal: Batalla de Operaciones</h3>
            <p><strong>Din√°mica:</strong></p>
            <ul>
                <li>El docente escribe una operaci√≥n de suma o resta de enteros en el tablero.</li>
                <li>Dos equipos (o estudiantes) se turnan para resolver la operaci√≥n.</li>
                <li>El equipo que responda correctamente m√°s r√°pido gana <strong>+50 puntos</strong>.</li>
                <li>Si un equipo responde mal, el otro tiene la oportunidad de robar los puntos.</li>
            </ul>

            <p style="margin-top: 35px; font-size: 1.1em; color: #764ba2;">Tiempo Sugerido: <strong>15 min</strong> (Teor√≠a + Juego).</p>

            <div style="text-align: right; margin-top: 40px;">
               <button class="start-activity-button back-button" onclick="completeSubActivity(1, 4); showScreen('session1QuizScreen');">Continuar al Quiz Final ‚Üí</button>
            </div>
        </div>
    </div>

    <div class="screen" id="session1QuizScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('session1Screen')"> ‚Üê Volver a Sesi√≥n 1 </button>
            <div style="position: relative; text-align: center; margin-bottom: 30px;">
                <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                    <span class="math-symbol" style="position: absolute; left: 11%; top: 24%; font-size: 2.5em; animation: floatMath 6.3s ease-in-out infinite;">üìù</span>
                    <span class="math-symbol" style="position: absolute; left: 84%; top: 34%; font-size: 2em; animation: floatMath 7.8s ease-in-out infinite; animation-delay: 0.9s;">üéì</span>
                    <span class="math-symbol" style="position: absolute; left: 14%; top: 56%; font-size: 2.2em; animation: floatMath 8.4s ease-in-out infinite; animation-delay: 1.4s;">üåü</span>
                    <span class="math-symbol" style="position: absolute; left: 81%; top: 66%; font-size: 2.3em; animation: floatMath 7.6s ease-in-out infinite; animation-delay: 2s;">üíØ</span>
                </div>
                <h2 style="position: relative; z-index: 1;">‚úÖ Quiz Final: Prueba de Dominio de Enteros</h2>
            </div>

            <p style="font-size: 1.25em; line-height: 1.8; margin-bottom: 25px;"><strong>¬°Hora de la Prueba!</strong> Resuelve las siguientes 8 operaciones y demuestra tu dominio de los n√∫meros enteros, el valor absoluto, la suma y la resta.</p>

            <div class="quiz-container">
                <div class="quiz-item">
                    <label for="q1">1. (‚àí3) + (‚àí2) =</label>
                    <input type="text" id="q1" class="quiz-input" data-correct="-5" placeholder="Escribe el resultado (ej: -5)" />
                </div>
                <div class="quiz-item">
                    <label for="q2">2. (+6) ‚àí (‚àí4) =</label>
                    <input type="text" id="q2" class="quiz-input" data-correct="10" placeholder="Escribe el resultado (ej: 10)" />
                </div>
                <div class="quiz-item">
                    <label for="q3">3. |‚àí8| =</label>
                    <input type="text" id="q3" class="quiz-input" data-correct="8" placeholder="Escribe el resultado (ej: 8)" />
                </div>
                <div class="quiz-item">
                    <label for="q4">4. (‚àí7) + (+9) =</label>
                    <input type="text" id="q4" class="quiz-input" data-correct="2" placeholder="Escribe el resultado (ej: 2)" />
                </div>
                <div class="quiz-item">
                    <label for="q5">5. (+10) ‚àí (+15) =</label>
                    <input type="text" id="q5" class="quiz-input" data-correct="-5" placeholder="Escribe el resultado (ej: -5)" />
                </div>
                <div class="quiz-item">
                    <label for="q6">6. (+5) + (‚àí3) =</label>
                    <input type="text" id="q6" class="quiz-input" data-correct="2" placeholder="Escribe el resultado (ej: 2)" />
                </div>
                <div class="quiz-item">
                    <label for="q7">7. |+4| =</label>
                    <input type="text" id="q7" class="quiz-input" data-correct="4" placeholder="Escribe el resultado (ej: 4)" />
                </div>
                <div class="quiz-item">
                    <label for="q8">8. (‚àí2) ‚àí (‚àí5) =</label>
                    <input type="text" id="q8" class="quiz-input" data-correct="3" placeholder="Escribe el resultado (ej: 3)" />
                </div>
            </div>

            <button class="submit-quiz-button back-button" onclick="submitQuiz(1)">Comprobar Resultados y Finalizar Sesi√≥n</button>
            
            <div id="quizResults" class="quiz-results">
                <h3>Resultados del Quiz:</h3>
                <p>Puntuaci√≥n: <span id="quizScore">0/8</span></p>
                <ul class="result-list" id="resultList">
                    </ul>
            </div>
            
            <p style="margin-top: 35px; font-size: 1.1em; color: #764ba2;">Tiempo Sugerido: <strong>10 min</strong> (Quiz).</p>
<div id="nextSessionButton" style="display: none; text-align: center; margin-top: 50px; animation: fadeInScale 1s ease-out;">
                <div style="background: linear-gradient(135deg, rgba(0, 242, 254, 0.2), rgba(79, 172, 254, 0.2)); padding: 30px; border-radius: 25px; border: 3px solid #00f2fe; box-shadow: 0 0 30px rgba(0, 242, 254, 0.5);">
                    <h3 style="color: #00f2fe; font-size: 2em; margin-bottom: 20px;">üéâ ¬°Felicidades! Sesi√≥n 1 Completada</h3>
                    <button class="back-button" onclick="showScreen('session2Screen')" style="background: linear-gradient(135deg, #00f2fe, #4facfe, #00c9ff); font-size: 1.5em; padding: 25px 60px; box-shadow: 0 15px 40px rgba(0, 242, 254, 0.6), 0 0 25px #00f2fe;">
                        üöÄ ¬°Comenzar Sesi√≥n 2: Multiplicaci√≥n y Divisi√≥n! ‚Üí
                    </button>
                </div>
            </div>
        </div>
    </div>


    <div class="screen" id="session2Screen">
    <div class="content-screen" style="position: relative;">
        <button class="back-button" onclick="showScreen('sectionsScreen')" style="z-index: 10;">‚Üê Volver al mapa</button>
        <div style="text-align: center; margin-top: 30px;">
            <div class="session-header-icon">‚ú®</div>
            <h2 class="session-title-gradient">Sesi√≥n 2: N√∫meros Enteros (II)</h2>
            <p style="font-size: 1.3em; color: #555; font-weight: 500;">¬°Multipliquemos y dividamos con signos!</p>
        </div>

        <div class="content-grid-session1">
            <div class="card-session objective-card">
                <h3>Objetivo de Sesi√≥n</h3>
                <p>Dominar las reglas de multiplicaci√≥n y divisi√≥n de n√∫meros enteros, comprendiendo la ley de los signos y aplicando la jerarqu√≠a b√°sica de operaciones en expresiones combinadas.</p>
            </div>
            <div class="card-session learning-card">
                <h3>Ruta de Aprendizaje</h3>
                <ul class="learning-list">
                    <li class="learning-list-item" onclick="showScreen('session2TheoryScreen')"><span>üìö</span> Teor√≠a: Multiplicaci√≥n y Divisi√≥n con Signos</li>
                    <li class="learning-list-item" onclick="showScreen('session2GameClassScreen')"><span>üé≤</span> Juego en Clase: Batalla de Signos</li>
                    <li class="learning-list-item" onclick="showScreen('session2ArcadeScreen')"><span>üéÆ</span> Juego Arcade: Esquiva y Aprende</li>
                    <li class="learning-list-item" onclick="showScreen('session2HierarchyScreen')"><span>üèóÔ∏è</span> Jerarqu√≠a de Operaciones</li>
                   
                </ul>
            </div>
        </div>

        <div class="session1-nav-grid">
            <div class="session-nav-card" onclick="showScreen('session2TheoryScreen')">
                <div class="session-nav-card-icon">üìö</div>
                <h4>1. Teor√≠a</h4>
            </div>
            <div class="session-nav-card" onclick="showScreen('session2GameClassScreen')">
                <div class="session-nav-card-icon">üé≤</div>
                <h4>2. Juego en Clase</h4>
            </div>
            <div class="session-nav-card" onclick="showScreen('session2ArcadeScreen')">
                <div class="session-nav-card-icon">üéÆ</div>
                <h4>3. Juego Arcade</h4>
            </div>
            <div class="session-nav-card" onclick="showScreen('session2HierarchyScreen')">
                <div class="session-nav-card-icon">üèóÔ∏è</div>
                <h4>4. Jerarqu√≠a</h4>
            </div>
             </div>
    </div>
</div>
<!-- TEOR√çA SESI√ìN 2: MULTIPLICACI√ìN Y DIVISI√ìN -->
    <div class="screen" id="session2TheoryScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('session2Screen')"> ‚Üê Volver a Sesi√≥n 2 </button>
            
            <div style="position: relative; text-align: center; margin-bottom: 30px;">
                <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                    <span class="math-symbol" style="position: absolute; left: 10%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">‚úñÔ∏è</span>
                    <span class="math-symbol" style="position: absolute; left: 85%; top: 30%; font-size: 2em; animation: floatMath 7s ease-in-out infinite; animation-delay: 0.5s;">‚ûó</span>
                    <span class="math-symbol" style="position: absolute; left: 15%; top: 60%; font-size: 2.2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s;">üéØ</span>
                    <span class="math-symbol" style="position: absolute; left: 80%; top: 70%; font-size: 2.3em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 1.5s;">‚ö°</span>
                </div>
                <h2 style="position: relative; z-index: 1;">üìö Multiplicaci√≥n y Divisi√≥n: La Ley de los Signos</h2>
            </div>

            <h3>La Magia de Multiplicar y Dividir Enteros</h3>
            <p>En la sesi√≥n anterior aprendiste a sumar y restar n√∫meros enteros. Ahora vamos a multiplicar y dividir, y descubrir√°s algo fascinante: <strong>el resultado depende de los signos que est√©s combinando</strong>.</p>
            
            <p>Piensa en los signos como "personalidades matem√°ticas". Cuando dos n√∫meros positivos se multiplican, es como dos amigos trabajando juntos: el resultado es positivo. Pero cuando un positivo y un negativo se encuentran, entran en conflicto y el resultado es negativo. ¬øY qu√© pasa cuando dos negativos se multiplican? ¬°Se neutralizan y dan positivo!</p>

            <h3>üé≠ La Ley de los Signos: Las 4 Reglas de Oro</h3>
            
            <div style="background: linear-gradient(135deg, #d4edda, #f3fff5); padding: 30px; border-radius: 20px; border-left: 10px solid #2ecc71; margin: 25px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                <h4 style="color: #27ae60; font-size: 1.6em; margin-bottom: 15px;">‚úÖ REGLA 1: Positivo √ó Positivo = Positivo</h4>
                <p style="font-size: 1.15em; line-height: 1.8; color: #2d5016;"><strong>Ejemplo:</strong> (+5) √ó (+3) = +15</p>
                <p style="font-size: 1.1em; line-height: 1.8; color: #2d5016;">Si ganas $5.000 por cada hora trabajada y trabajas 3 horas, ganas $15.000 (positivo). Dos cantidades positivas multiplicadas siempre dan un resultado positivo.</p>
            </div>

            <div style="background: linear-gradient(135deg, #fff3cd, #fffdf0); padding: 30px; border-radius: 20px; border-left: 10px solid #ffc107; margin: 25px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                <h4 style="color: #f57f17; font-size: 1.6em; margin-bottom: 15px;">‚ö†Ô∏è REGLA 2: Positivo √ó Negativo = Negativo</h4>
                <p style="font-size: 1.15em; line-height: 1.8; color: #6d4c41;"><strong>Ejemplo:</strong> (+4) √ó (‚àí2) = ‚àí8</p>
                <p style="font-size: 1.1em; line-height: 1.8; color: #6d4c41;">Si cada d√≠a gastas $4.000 en transporte, en 2 d√≠as has gastado $8.000. Si consideramos los gastos como negativos, ser√≠a: (+4) √ó (‚àí2) = ‚àí8. Un signo positivo multiplicado por uno negativo siempre da negativo.</p>
            </div>

            <div style="background: linear-gradient(135deg, #ffe0e0, #fff5f5); padding: 30px; border-radius: 20px; border-left: 10px solid #ff9800; margin: 25px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                <h4 style="color: #e65100; font-size: 1.6em; margin-bottom: 15px;">‚ö†Ô∏è REGLA 3: Negativo √ó Positivo = Negativo</h4>
                <p style="font-size: 1.15em; line-height: 1.8; color: #5d1f00;"><strong>Ejemplo:</strong> (‚àí6) √ó (+2) = ‚àí12</p>
                <p style="font-size: 1.1em; line-height: 1.8; color: #5d1f00;">El orden no importa: si tienes una deuda de $6.000 (‚àí6) y esa deuda se duplica (+2), ahora tienes una deuda de $12.000 (‚àí12). Sigue siendo negativo.</p>
            </div>

            <div style="background: linear-gradient(135deg, #e3f2fd, #f0f8ff); padding: 30px; border-radius: 20px; border-left: 10px solid #2196f3; margin: 25px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                <h4 style="color: #0d47a1; font-size: 1.6em; margin-bottom: 15px;">üéâ REGLA 4: Negativo √ó Negativo = Positivo</h4>
                <p style="font-size: 1.15em; line-height: 1.8; color: #01579b;"><strong>Ejemplo:</strong> (‚àí5) √ó (‚àí3) = +15</p>
                <p style="font-size: 1.1em; line-height: 1.8; color: #01579b;">Esta es la m√°s sorprendente: ¬°dos negativos dan positivo! Pi√©nsalo as√≠: si cada d√≠a cancelas una deuda de $5.000 (‚àí5 significa "eliminar deuda"), y lo haces durante 3 d√≠as (‚àí3 veces), en realidad has ganado $15.000. Los dos negativos se "cancelan" y dan positivo.</p>
            </div>

            <h3>üìè Resumen Visual de la Ley de los Signos</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0;">
                <div style="background: #2ecc71; color: white; padding: 25px; border-radius: 15px; text-align: center; font-size: 1.3em; font-weight: 700; box-shadow: 0 8px 20px rgba(46, 204, 113, 0.4);">
                    (+) √ó (+) = <span style="font-size: 1.5em;">+</span>
                </div>
                <div style="background: #e74c3c; color: white; padding: 25px; border-radius: 15px; text-align: center; font-size: 1.3em; font-weight: 700; box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);">
                    (+) √ó (‚àí) = <span style="font-size: 1.5em;">‚àí</span>
                </div>
                <div style="background: #e74c3c; color: white; padding: 25px; border-radius: 15px; text-align: center; font-size: 1.3em; font-weight: 700; box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);">
                    (‚àí) √ó (+) = <span style="font-size: 1.5em;">‚àí</span>
                </div>
                <div style="background: #2ecc71; color: white; padding: 25px; border-radius: 15px; text-align: center; font-size: 1.3em; font-weight: 700; box-shadow: 0 8px 20px rgba(46, 204, 113, 0.4);">
                    (‚àí) √ó (‚àí) = <span style="font-size: 1.5em;">+</span>
                </div>
            </div>

            <h3>‚ûó La Divisi√≥n Sigue las Mismas Reglas</h3>
            <p>¬°Buenas noticias! La divisi√≥n usa exactamente las mismas reglas que la multiplicaci√≥n:</p>
            <ul style="list-style: none; padding: 0; margin: 20px 0;">
                <li style="background: #f0f8ff; padding: 15px; margin: 10px 0; border-radius: 10px; border-left: 5px solid #2196f3; color: #01579b; font-weight: 500;">
                    <strong>(+12) √∑ (+3) = +4</strong> ‚Üí Signos iguales = resultado positivo
                </li>
                <li style="background: #fff0f5; padding: 15px; margin: 10px 0; border-radius: 10px; border-left: 5px solid #e74c3c; color: #c0392b; font-weight: 500;">
                    <strong>(+12) √∑ (‚àí3) = ‚àí4</strong> ‚Üí Signos diferentes = resultado negativo
                </li>
                <li style="background: #fff0f5; padding: 15px; margin: 10px 0; border-radius: 10px; border-left: 5px solid #e74c3c; color: #c0392b; font-weight: 500;">
                    <strong>(‚àí12) √∑ (+3) = ‚àí4</strong> ‚Üí Signos diferentes = resultado negativo
                </li>
                <li style="background: #f0f8ff; padding: 15px; margin: 10px 0; border-radius: 10px; border-left: 5px solid #2196f3; color: #01579b; font-weight: 500;">
                    <strong>(‚àí12) √∑ (‚àí3) = +4</strong> ‚Üí Signos iguales = resultado positivo
                </li>
            </ul>

            <h3>üéØ Regla Mnemot√©cnica: "Amigos y Enemigos"</h3>
            <div style="background: linear-gradient(135deg, #fceabb, #f8b500); padding: 30px; border-radius: 20px; margin: 30px 0; border: 5px solid #ffcc00; box-shadow: 0 15px 40px rgba(255, 198, 0, 0.4);">
                <p style="font-size: 1.2em; line-height: 1.8; color: #6d4c41; font-weight: 600;">
                    üíö <strong>Signos IGUALES = Amigos = POSITIVO</strong><br>
                    Cuando dos signos iguales se multiplican o dividen (dos positivos o dos negativos), se llevan bien y el resultado es positivo.
                </p>
                <p style="font-size: 1.2em; line-height: 1.8; color: #6d4c41; font-weight: 600; margin-top: 20px;">
                    üíî <strong>Signos DIFERENTES = Conflicto = NEGATIVO</strong><br>
                    Cuando un positivo y un negativo se multiplican o dividen, est√°n en conflicto y el resultado es negativo.
                </p>
            </div>

            <h3>üìñ ¬øSab√≠as que...?</h3>
            <p>El matem√°tico alem√°n Michael Stifel (1487-1567) fue uno de los primeros en usar los s√≠mbolos + y ‚àí para representar cantidades positivas y negativas en su libro "Arithmetica Integra" (1544). Antes de √©l, los matem√°ticos describ√≠an las operaciones con palabras largas. ¬°Imagina tener que escribir "multiplica el n√∫mero que es menos de cero con otro n√∫mero menos de cero" en lugar de simplemente escribir (‚àí3) √ó (‚àí2)!</p>

            <p style="margin-top: 35px; font-size: 1.1em; color: #764ba2;">Tiempo Sugerido: <strong>20 min</strong> (Teor√≠a + Ejemplos).</p>

            <div style="text-align: right; margin-top: 40px;">
<button class="start-activity-button back-button" onclick="completeSubActivity(2, 1); showScreen('session2GameClassScreen');">Continuar al Juego en Clase ‚Üí</button>
            </div>
        </div>
    </div>

      

<!-- JUEGO EN CLASE: BATALLA DE SIGNOS -->
    <div class="screen" id="session2GameClassScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('session2Screen')"> ‚Üê Volver a Sesi√≥n 2 </button>
            
            <div style="position: relative; text-align: center; margin-bottom: 30px;">
                <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                    <span class="math-symbol" style="position: absolute; left: 12%; top: 25%; font-size: 2.5em; animation: floatMath 6.5s ease-in-out infinite;">üé≤</span>
                    <span class="math-symbol" style="position: absolute; left: 82%; top: 35%; font-size: 2em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 0.7s;">‚öîÔ∏è</span>
                    <span class="math-symbol" style="position: absolute; left: 18%; top: 55%; font-size: 2.2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1.2s;">üèÜ</span>
                    <span class="math-symbol" style="position: absolute; left: 78%; top: 65%; font-size: 2.3em; animation: floatMath 7s ease-in-out infinite; animation-delay: 1.8s;">‚ú®</span>
                </div>
                <h2 style="position: relative; z-index: 1;">üé≤ Juego en Clase: Batalla de Signos</h2>
            </div>

            <div style="background: linear-gradient(135deg, #b2ebf2, #e1f5fe); border-left: 8px solid #00acc1; border-radius: 25px; padding: 35px 40px; margin-top: 30px; color: #0d47a1; box-shadow: 0 10px 25px rgba(0,0,0,0.15);">
                
                <h2 style="color:#00796b; font-size:2em; margin-bottom:20px;">‚öîÔ∏è Din√°mica: Batalla de Signos por Equipos</h2>

                <h3 style="color:#00796b; margin-top:25px;">üìã Objetivo del Juego</h3>
                <p style="font-size:1.1em; color:#004d40; margin-bottom:15px; line-height: 1.8;">
                    Los estudiantes trabajar√°n en equipos para resolver operaciones de multiplicaci√≥n y divisi√≥n de n√∫meros enteros lo m√°s r√°pido posible, aplicando correctamente la ley de los signos.
                </p>

                <h3 style="color:#00796b; margin-top:25px;">üë• Preparaci√≥n (5 min)</h3>
                <ul style="font-size:1.05em; line-height:1.8; margin-left:25px; color:#01579b;">
                    <li>üè´ Dividir la clase en 4 equipos (Equipo Rojo, Azul, Verde, Amarillo)</li>
                    <li>üìù Cada equipo elige un capit√°n que escribir√° las respuestas</li>
                    <li>üéØ El docente prepara tarjetas con operaciones de diferentes dificultades</li>
                    <li>‚è±Ô∏è Se necesita un cron√≥metro o temporizador</li>
                </ul>

                <h3 style="color:#00796b; margin-top:25px;">üéÆ Mec√°nica del Juego (20 min)</h3>
                
                <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 15px; margin: 15px 0; border: 2px solid #4dd0e1;">
                    <h4 style="color:#00838f; margin-bottom:10px;">‚≠ê RONDA 1: Velocidad B√°sica</h4>
                    <p style="color:#006064; line-height: 1.8;">
                        El docente muestra una operaci√≥n en el tablero (ejemplo: <strong>(+7) √ó (‚àí3)</strong>). El primer equipo que levante la mano y d√© la respuesta correcta (<strong>‚àí21</strong>) gana <strong>10 puntos</strong>. Si se equivoca, los dem√°s equipos tienen oportunidad de responder por <strong>5 puntos</strong>.
                    </p>
                    <p style="color:#d32f2f; font-weight: 600; margin-top: 10px;">
                        üìå 5 operaciones | Tiempo: 5 minutos
                    </p>
                </div>

                <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 15px; margin: 15px 0; border: 2px solid #4dd0e1;">
                    <h4 style="color:#00838f; margin-bottom:10px;">‚≠ê RONDA 2: Combo de Operaciones</h4>
                    <p style="color:#006064; line-height: 1.8;">
                        Cada equipo recibe una hoja con 3 operaciones para resolver en <strong>2 minutos</strong>. Ejemplo:
                    </p>
                    <ul style="color:#004d40; margin-left: 20px; line-height: 1.8;">
                        <li>(‚àí4) √ó (+5) = ?</li>
                        <li>(+18) √∑ (‚àí3) = ?</li>
                        <li>(‚àí8) √ó (‚àí2) = ?</li>
                    </ul>
                    <p style="color:#006064; line-height: 1.8; margin-top: 10px;">
                        El equipo que entregue primero <strong>Y tenga todas correctas</strong> gana <strong>30 puntos</strong>. Los dem√°s equipos con respuestas correctas ganan <strong>15 puntos</strong>.
                    </p>
                    <p style="color:#d32f2f; font-weight: 600; margin-top: 10px;">
                        üìå 3 combos | Tiempo: 6 minutos
                    </p>
                </div>

                <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 15px; margin: 15px 0; border: 2px solid #4dd0e1;">
                    <h4 style="color:#00838f; margin-bottom:10px;">‚≠ê RONDA 3: Desaf√≠o Mental</h4>
                    <p style="color:#006064; line-height: 1.8;">
                        El docente lee una operaci√≥n en voz alta <strong>SIN escribirla</strong> en el tablero. Los equipos tienen <strong>15 segundos</strong> para calcular mentalmente y escribir la respuesta. Ejemplo: "Menos seis por menos cuatro" = <strong>+24</strong>.
                    </p>
                    <p style="color:#006064; line-height: 1.8; margin-top: 10px;">
                        Cada respuesta correcta vale <strong>20 puntos</strong>. Esta ronda pone a prueba la memoria y velocidad mental.
                    </p>
                    <p style="color:#d32f2f; font-weight: 600; margin-top: 10px;">
                        üìå 5 operaciones mentales | Tiempo: 5 minutos
                    </p>
                </div>

                <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 15px; margin: 15px 0; border: 2px solid #4dd0e1;">
                    <h4 style="color:#00838f; margin-bottom:10px;">‚≠ê RONDA FINAL: S√∫per Desaf√≠o</h4>
                    <p style="color:#006064; line-height: 1.8;">
                        Una operaci√≥n dif√≠cil para todos los equipos. Ejemplo: <strong>(‚àí7) √ó (+3) √ó (‚àí2)</strong> = ?
                    </p>
                    <p style="color:#006064; line-height: 1.8; margin-top: 10px;">
                        El primer equipo en dar la respuesta correcta (<strong>+42</strong>) gana <strong>50 puntos EXTRA</strong>.
                    </p>
                    <p style="color:#d32f2f; font-weight: 600; margin-top: 10px;">
                        üìå 1 operaci√≥n √©pica | Tiempo: 4 minutos
                    </p>
                </div>

                <h3 style="color:#00796b; margin-top:25px;">üèÜ Puntuaci√≥n y Premios</h3>
                <p style="font-size:1.1em; color:#004d40; line-height: 1.8;">
                    Al final del juego, el equipo con m√°s puntos es el <strong>Campe√≥n de la Batalla de Signos</strong> ü•á. Los estudiantes pueden ganar puntos extra en la nota de participaci√≥n o peque√±os premios simb√≥licos (calcoman√≠as, dulces, certificados).
                </p>

                <div style="background: #fceabb; padding: 20px; border-radius: 15px; margin-top: 25px; border: 3px solid #ffcc00;">
                    <h4 style="color:#6d4c41; margin-bottom:10px;">üí° Consejo del Profesor</h4>
                    <p style="color:#6d4c41; line-height: 1.8; font-weight: 500;">
                        Este juego refuerza la ley de los signos de forma divertida y competitiva. La clave est√° en la repetici√≥n y la velocidad, lo que ayuda a que los estudiantes <strong>automaticen las reglas</strong> sin tener que pensarlas cada vez. ¬°Crea un ambiente de celebraci√≥n cuando los equipos acierten!
                    </p>
                </div>

                <p style="font-size: 1em; color: #6a1b9a; font-weight: 600; margin-top: 30px;">
                    ‚è±Ô∏è <strong>Tiempo Total Sugerido:</strong> 30 minutos (5 min preparaci√≥n + 20 min juego + 5 min cierre)
                </p>
            </div>

            <div style="text-align: right; margin-top: 40px;">
                <button class="start-activity-button back-button" onclick="completeSubActivity(2, 2); showScreen('session2ArcadeScreen');">Continuar al Juego Arcade ‚Üí</button>
            </div>
        </div>
    </div

<!-- JUEGO ARCADE: ESQUIVA Y APRENDE -->
      <!-- JUEGO ARCADE: ESQUIVA Y APRENDE (VERSI√ìN MEJORADA) -->
<div class="screen" id="session2ArcadeScreen">
    <div class="content-screen" style="background: linear-gradient(135deg, #f3e5f5, #faf0fc); border: 4px solid rgba(156, 39, 176, 0.5);">
        <button class="back-button" onclick="showScreen('session2Screen')"> ‚Üê Volver a Sesi√≥n 2 </button>
        
        <h2 style="text-align: center;">üéÆ Juego Arcade: Esquiva y Aprende</h2>

        <p style="font-size: 1.2em; text-align: center; margin-bottom: 30px; color: #555;">
            ¬°Esquiva los obst√°culos rojos, recoge estrellas verdes y responde preguntas!<br>
            <strong>Cada vez que pierdas o llegues a 0 de energ√≠a, responde una pregunta correctamente para continuar.</strong>
        </p>

        <!-- Contenedor del juego -->
        <div style="max-width: 900px; margin: 0 auto; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 20px; padding: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.3);">
            
            <div style="text-align: center; margin-bottom: 20px;">
                <h2 id="arcadeGameTitle" style="color: white; font-size: 2em; margin: 0;">üéÆ Evaluaci√≥n en Curso</h2>
            </div>

            <!-- Canvas del juego -->
            <div class="game-container" style="position: relative;">
                <canvas id="arcadeGameCanvas" width="860" height="500" style="background: #1a1a2e; border-radius: 15px; display: block; cursor: crosshair; width: 100%;"></canvas>
                <div class="touch-control-overlay" style="position: absolute; bottom: 20px; left: 0; right: 0; display: flex; justify-content: space-between; padding: 0 20px; pointer-events: none;">
                    <button class="touch-btn" id="arcadeLeftBtn" style="pointer-events: all; background: rgba(52, 152, 219, 0.8); color: white; border: 3px solid white; border-radius: 50%; width: 80px; height: 80px; font-size: 2.5em; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.5); transition: all 0.2s; display: flex; align-items: center; justify-content: center;">‚Üê</button>
                    <button class="touch-btn right" id="arcadeRightBtn" style="pointer-events: all; background: rgba(231, 76, 60, 0.8); color: white; border: 3px solid white; border-radius: 50%; width: 80px; height: 80px; font-size: 2.5em; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.5); transition: all 0.2s; display: flex; align-items: center; justify-content: center;">‚Üí</button>
                </div>
            </div>

            <!-- Controles y mensaje -->
            <div style="text-align: center; margin-top: 25px;">
                <p id="arcadeGameMessage" style="font-size: 1.2em; color: white; margin-bottom: 15px;">
                    üéÆ Usa las FLECHAS ‚Üê ‚Üí o los BOTONES en pantalla para moverte
                </p>
                <button id="arcadeStartRoundButton" class="back-button" style="display: none; font-size: 1.4em; padding: 20px 50px;">
                    üöÄ COMENZAR RONDA
                </button>
            </div>

            <div id="arcadeGameFeedback" style="margin-top: 20px; color: white; text-align: center; font-size: 1.1em;"></div>
        </div>

        <!-- Modal de p√©rdida -->
        <div id="arcadeLossModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; justify-content: center; align-items: center;">
            <div style="background: linear-gradient(135deg, #e74c3c, #c0392b); padding: 50px; border-radius: 30px; max-width: 600px; width: 90%; box-shadow: 0 25px 80px rgba(0,0,0,0.7); border: 5px solid #fff; text-align: center;">
                <h2 style="color: white; font-size: 3em; margin-bottom: 20px;">üí• ¬°OH NO!</h2>
                <p id="arcadeLossReason" style="color: white; font-size: 1.5em; margin-bottom: 30px; line-height: 1.6;"></p>
                <button class="back-button" onclick="showArcadeQuestionAfterLoss()" style="font-size: 1.4em; padding: 20px 50px; background: linear-gradient(135deg, #f39c12, #e67e22);">
                    üìù Responder Pregunta para Continuar
                </button>
            </div>
        </div>

        <!-- Modal de Pregunta -->
        <div id="arcadeQuestionModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10001; justify-content: center; align-items: center;">
            <div style="background: white; padding: 50px; border-radius: 30px; max-width: 700px; width: 90%; box-shadow: 0 25px 80px rgba(0,0,0,0.7); border: 5px solid #3498db;">
                <h3 style="color: #2c3e50; font-size: 2.5em; margin-bottom: 25px; text-align: center; border-bottom: 4px solid #3498db; padding-bottom: 15px;">‚ùì Pregunta de Matem√°ticas</h3>
                <p id="arcadeQuestionText" style="font-size: 1.6em; color: #34495e; margin-bottom: 35px; text-align: center; font-weight: 600; line-height: 1.5;"></p>
                
                <div id="arcadeAnswerOptions" style="display: grid; gap: 18px;">
                    <!-- Las opciones se generar√°n din√°micamente -->
                </div>
            </div>
        </div>

        <!-- Modal de Game Over -->
        <div id="arcadeGameOverModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; justify-content: center; align-items: center;">
            <div style="background: linear-gradient(135deg, #9b59b6, #8e44ad); padding: 60px; border-radius: 30px; max-width: 700px; width: 90%; box-shadow: 0 30px 90px rgba(0,0,0,0.8); border: 6px solid #fff; text-align: center;">
                <h2 style="color: white; font-size: 3.5em; margin-bottom: 25px;">üéÆ ¬°JUEGO COMPLETADO!</h2>
                <p style="color: white; font-size: 2em; margin-bottom: 20px;">
                    Preguntas respondidas: <span id="arcadeGameOverScore" style="font-weight: bold; color: #f1c40f;">0/10</span>
                </p>
                <p style="color: white; font-size: 1.4em; margin-bottom: 40px; line-height: 1.6;">
                    Has completado el desaf√≠o. ¬°Excelente trabajo!
                </p>
                <button class="back-button" onclick="showArcadeFinalResults()" style="font-size: 1.6em; padding: 25px 60px; background: linear-gradient(135deg, #27ae60, #229954);">
                    ‚úÖ Ver Resultados Finales
                </button>
            </div>
        </div>
<div id="arcadeFinalResultsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10002; justify-content: center; align-items: center; overflow-y: auto;">
    <div style="background: white; padding: 50px; border-radius: 30px; max-width: 900px; width: 90%; box-shadow: 0 25px 80px rgba(0,0,0,0.7); border: 5px solid #2ecc71; margin: 50px 0;">
        <h3 style="color: #2c3e50; font-size: 2.5em; margin-bottom: 25px; text-align: center; border-bottom: 4px solid #2ecc71; padding-bottom: 15px;">üíØ Resultados Detallados del Juego</h3>
        <p style="font-size: 1.4em; color: #34495e; text-align: center; margin-bottom: 30px;">
            Tu esfuerzo ha sido medido. Aqu√≠ est√° tu desempe√±o en las 10 preguntas.
        </p>
        <ul id="arcadeResultList" style="list-style: none; padding: 0;">
            </ul>
        <button class="back-button" onclick="finalizeSession2()" style="font-size: 1.6em; padding: 25px 60px; background: linear-gradient(135deg, #00f2fe, #4facfe, #00c9ff); margin-top: 40px; width: 100%;">
            Continuar a Jerarqu√≠a de Operaciones ‚Üí
        </button>
    </div>
</div>

        <div style="text-align: center; margin-top: 40px;">
            <p style="color: #764ba2; font-size: 1.2em; font-weight: 600;">
                üéØ Responde correctamente 10 preguntas para terminar
            </p>
        </div>

        <div style="text-align: right; margin-top: 40px;">
            <button class="back-button" onclick="showScreen('session2HierarchyScreen')">Continuar a Jerarqu√≠a ‚Üí</button>
        </div>
    </div>
</div>
<!-- JERARQU√çA DE OPERACIONES -->
    <div class="screen" id="session2HierarchyScreen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('session2Screen')"> ‚Üê Volver a Sesi√≥n 2 </button>
            
            <div style="position: relative; text-align: center; margin-bottom: 30px;">
                <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                    <span class="math-symbol" style="position: absolute; left: 11%; top: 24%; font-size: 2.5em; animation: floatMath 6.3s ease-in-out infinite;">üèóÔ∏è</span>
                    <span class="math-symbol" style="position: absolute; left: 84%; top: 34%; font-size: 2em; animation: floatMath 7.8s ease-in-out infinite; animation-delay: 0.9s;">üìê</span>
                    <span class="math-symbol" style="position: absolute; left: 14%; top: 56%; font-size: 2.2em; animation: floatMath 8.4s ease-in-out infinite; animation-delay: 1.4s;">üî¢</span>
                    <span class="math-symbol" style="position: absolute; left: 81%; top: 66%; font-size: 2.3em; animation: floatMath 7.6s ease-in-out infinite; animation-delay: 2s;">‚öôÔ∏è</span>
                </div>
                <h2 style="position: relative; z-index: 1;">üèóÔ∏è Jerarqu√≠a de Operaciones: El Orden Correcto</h2>
            </div>

            <h3>¬øPor qu√© necesitamos un orden?</h3>
            <p>Imagina que tienes esta operaci√≥n: <strong>5 + 3 √ó 2</strong>. Si haces las operaciones de izquierda a derecha, obtendr√≠as: 5 + 3 = 8, luego 8 √ó 2 = 16. Pero si primero multiplicas 3 √ó 2 = 6, y luego sumas 5 + 6 = 11. ¬øCu√°l es la correcta?</p>

            <p>Para evitar confusiones, los matem√°ticos establecieron un <strong>orden universal</strong> para resolver operaciones. Este orden se llama <strong>jerarqu√≠a de operaciones</strong> y TODOS en el mundo deben seguirlo para obtener el mismo resultado.</p>

            <h3>üéØ La Jerarqu√≠a: PEMDSR</h3>
            
            <div style="background: linear-gradient(135deg, #e8eaf6, #c5cae9); padding: 35px; border-radius: 25px; margin: 30px 0; border: 5px solid #5c6bc0; box-shadow: 0 15px 40px rgba(92, 107, 192, 0.4);">
                <h3 style="color: #283593; text-align: center; font-size: 2em; margin-bottom: 25px;">üìã Orden de Operaciones (de arriba hacia abajo)</h3>
                
                <div style="display: grid; gap: 15px;">
                    <div style="background: #fff; padding: 20px; border-radius: 15px; border-left: 8px solid #f44336;">
                        <h4 style="color: #c62828; font-size: 1.5em; margin-bottom: 10px;">1Ô∏è‚É£ Par√©ntesis ( )</h4>
                        <p style="color: #555; line-height: 1.8;">Siempre resuelve primero lo que est√° dentro de par√©ntesis.</p>
                    </div>
                    
                    <div style="background: #fff; padding: 20px; border-radius: 15px; border-left: 8px solid #ff9800;">
                        <h4 style="color: #e65100; font-size: 1.5em; margin-bottom: 10px;">2Ô∏è‚É£ Exponentes y Ra√≠ces</h4>
                        <p style="color: #555; line-height: 1.8;">Potencias (x¬≤) y ra√≠ces cuadradas (‚àö).</p>
                    </div>
                    
                    <div style="background: #fff; padding: 20px; border-radius: 15px; border-left: 8px solid #4caf50;">
                        <h4 style="color: #2e7d32; font-size: 1.5em; margin-bottom: 10px;">3Ô∏è‚É£ Multiplicaci√≥n √ó y Divisi√≥n √∑</h4>
                        <p style="color: #555; line-height: 1.8;">De izquierda a derecha. Tienen la misma prioridad.</p>
                    </div>
                    
                    <div style="background: #fff; padding: 20px; border-radius: 15px; border-left: 8px solid #2196f3;">
                        <h4 style="color: #0d47a1; font-size: 1.5em; margin-bottom: 10px;">4Ô∏è‚É£ Suma + y Resta ‚àí</h4>
                        <p style="color: #555; line-height: 1.8;">De izquierda a derecha. Tambi√©n tienen la misma prioridad.</p>
                    </div>
                </div>
            </div>

            <h3>üìù Ejemplos Resueltos Paso a Paso</h3>

            <div style="background: #f0f4c3; padding: 30px; border-radius: 20px; margin: 25px 0; border: 3px solid #aed581; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                <h4 style="color: #33691e; font-size: 1.5em; margin-bottom: 15px;">Ejemplo 1: 5 + 3 √ó 2</h4>
                <p style="font-size: 1.15em; color: #1b5e20; line-height: 2;">
                    <strong>Paso 1:</strong> Identificar operaciones ‚Üí tenemos suma y multiplicaci√≥n<br>
                    <strong>Paso 2:</strong> La multiplicaci√≥n va primero ‚Üí 3 √ó 2 = 6<br>
                    <strong>Paso 3:</strong> Ahora sumamos ‚Üí 5 + 6 = <strong style="font-size: 1.3em; color: #2e7d32;">11</strong>
                </p>
            </div>

            <div style="background: #e1f5fe; padding: 30px; border-radius: 20px; margin: 25px 0; border: 3px solid #4fc3f7; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                <h4 style="color: #01579b; font-size: 1.5em; margin-bottom: 15px;">Ejemplo 2: (8 ‚àí 3) √ó 4</h4>
                <p style="font-size: 1.15em; color: #0277bd; line-height: 2;">
                    <strong>Paso 1:</strong> Resolver par√©ntesis primero ‚Üí 8 ‚àí 3 = 5<br>
                    <strong>Paso 2:</strong> Multiplicar el resultado ‚Üí 5 √ó 4 = <strong style="font-size: 1.3em; color: #01579b;">20</strong>
                </p>
            </div>

            <div style="background: #fce4ec; padding: 30px; border-radius: 20px; margin: 25px 0; border: 3px solid #f48fb1; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                <h4 style="color: #880e4f; font-size: 1.5em; margin-bottom: 15px;">Ejemplo 3: 20 √∑ 4 + 3 √ó 2</h4>
                <p style="font-size: 1.15em; color: #ad1457; line-height: 2;">
                    <strong>Paso 1:</strong> Divisi√≥n y multiplicaci√≥n primero (de izquierda a derecha)<br>
                    ‚Üí 20 √∑ 4 = 5<br>
                    ‚Üí 3 √ó 2 = 6<br>
                    <strong>Paso 2:</strong> Ahora sumamos ‚Üí 5 + 6 = <strong style="font-size: 1.3em; color: #c2185b;">11</strong>
                </p>
            </div>

            <div style="background: #fff3e0; padding: 30px; border-radius: 20px; margin: 25px 0; border: 3px solid #ffb74d; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                <h4 style="color: #e65100; font-size: 1.5em; margin-bottom: 15px;">Ejemplo 4 (con negativos): (‚àí5) + 3 √ó (‚àí2)</h4>
                <p style="font-size: 1.15em; color: #bf360c; line-height: 2;">
                    <strong>Paso 1:</strong> Multiplicaci√≥n primero ‚Üí 3 √ó (‚àí2) = ‚àí6<br>
                    <strong>Paso 2:</strong> Sumar ‚Üí (‚àí5) + (‚àí6) = <strong style="font-size: 1.3em; color: #d84315;">‚àí11</strong>
                </p>
            </div>

            <h3>‚ö†Ô∏è Error Com√∫n</h3>
            <div style="background: #ffebee; padding: 25px; border-radius: 15px; border-left: 8px solid #f44336; margin: 25px 0;">
                <p style="color: #b71c1c; font-size: 1.2em; line-height: 1.8; font-weight: 600;">
                    ‚ùå <strong>INCORRECTO:</strong> Resolver de izquierda a derecha sin respetar la jerarqu√≠a<br>
                    ‚úÖ <strong>CORRECTO:</strong> Seguir siempre el orden PEMDSR
                </p>
            </div>

            <h3>üéØ Regla Mnemot√©cnica</h3>
            <p style="font-size: 1.2em; background: #fceabb; padding: 25px; border-radius: 15px; color: #6d4c41; font-weight: 600; text-align: center; border: 3px solid #ffcc00;">
                <strong>"Por Favor, Excuse Mi Querida Se√±ora Ruth"</strong><br>
                <span style="font-size: 0.9em;">(Par√©ntesis, Exponentes, Multiplicaci√≥n/Divisi√≥n, Suma/Resta)</span>
            </p>

            <p style="margin-top: 35px; font-size: 1.1em; color: #764ba2;">Tiempo Sugerido: <strong>15 min</strong>.</p>

          <div style="text-align: center; margin-top: 50px; background: linear-gradient(135deg, rgba(46, 204, 113, 0.2), rgba(52, 152, 219, 0.2)); padding: 40px; border-radius: 25px; border: 4px solid #2ecc71;">
    <h3 style="color: #27ae60; font-size: 2.2em; margin-bottom: 20px;">¬°Explicaci√≥n de Jerarqu√≠a Completa!</h3>
    <p style="font-size: 1.3em; color: #16a085; margin-bottom: 30px;">Es momento de aplicar la teor√≠a. ¬°Prep√°rate para el reto de pr√°ctica!</p>
   <button class="back-button" onclick="completeSubActivity(2, 4); showScreen('session2PracticeScreen')" style="font-size: 1.4em; padding: 20px 50px; background: linear-gradient(135deg, #ff8000, #ffa500);">
    üìù Continuar al Reto 5: Taller de Pr√°ctica ‚Üí
</button>
		</div>
        </div>
    </div>
</div>




<div class="screen" id="session2PracticeScreen">
    <div class="content-screen">
        <button class="back-button" onclick="showScreen('session2HierarchyScreen')"> ‚Üê Volver a Jerarqu√≠a </button>
        
        <div style="position: relative; text-align: center; margin-bottom: 30px;">
            <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                <span class="math-symbol" style="position: absolute; left: 10%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">üìù</span>
                <span class="math-symbol" style="position: absolute; left: 85%; top: 30%; font-size: 2em; animation: floatMath 7s ease-in-out infinite; animation-delay: 0.5s;">üìä</span>
                <span class="math-symbol" style="position: absolute; left: 15%; top: 60%; font-size: 2.2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s;">üß†</span>
                <span class="math-symbol" style="position: absolute; left: 80%; top: 70%; font-size: 2.3em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 1.5s;">üí™</span>
            </div>
            <h2 style="position: relative; z-index: 1;">üìù Reto 5: Pr√°ctica de Jerarqu√≠a de Operaciones (Nivel B√°sico)</h2>
        </div>

        <p style="font-size: 1.25em; line-height: 1.8; margin-bottom: 25px;">
            ¬°Es hora de poner a prueba tus habilidades! Resuelve los siguientes **7 ejercicios** de dificultad media. Recuerda usar la Jerarqu√≠a (PEMDSR) y las reglas de los signos.
        </p>
        
        <div class="quiz-container">
            <div class="quiz-item">
                <label for="p1">1. 15 ‚àí 4 √ó (‚àí2) + 7 =</label>
                <input type="text" id="p1" class="quiz-input" data-correct="30" placeholder="" />
            </div>
            <div class="quiz-item">
                <label for="p2">2. (‚àí10) √∑ 5 + (1 ‚àí 6) =</label>
                <input type="text" id="p2" class="quiz-input" data-correct="-7" placeholder="" />
            </div>
            <div class="quiz-item">
                <label for="p3">3. 3 √ó (‚àí5) + 30 √∑ (‚àí6) =</label>
                <input type="text" id="p3" class="quiz-input" data-correct="-20" placeholder="" />
            </div>
            <div class="quiz-item">
                <label for="p4">4. 5 + 2 √ó (1 ‚àí 4) =</label>
                <input type="text" id="p4" class="quiz-input" data-correct="-1" placeholder="" />
            </div>
            <div class="quiz-item">
                <label for="p5">5. (‚àí20) √∑ 4 + 5 √ó (‚àí2) =</label>
                <input type="text" id="p5" class="quiz-input" data-correct="-15" placeholder="" />
            </div>
            <div class="quiz-item">
                <label for="p6">6. 12 ‚àí (8 √∑ 2) √ó 3 =</label>
                <input type="text" id="p6" class="quiz-input" data-correct="0" placeholder="" />
            </div>
            <div class="quiz-item">
                <label for="p7">7. (‚àí1) √ó 7 + 10 ‚àí 3 =</label>
                <input type="text" id="p7" class="quiz-input" data-correct="0" placeholder="" />
            </div>
            </div>

        <button class="submit-quiz-button back-button" onclick="submitPracticeQuiz(2)">Comprobar Resultados y Finalizar Sesi√≥n</button>
        
        <div id="practiceResults" class="quiz-results" style="display: none; border-color: #ff8000; box-shadow: 0 10px 30px rgba(255, 128, 0, 0.4);">
            <h3>Resultados de la Pr√°ctica:</h3>
            <p>Puntuaci√≥n: <span id="practiceScore">0/7</span></p>
            <ul class="result-list" id="practiceResultList">
            </ul>
        </div>
        
        <div id="completeSession2Button" style="display: none; text-align: center; margin-top: 50px; animation: fadeInScale 1s ease-out;">
            <div style="background: linear-gradient(135deg, rgba(46, 204, 113, 0.2), rgba(52, 152, 219, 0.2)); padding: 30px; border-radius: 25px; border: 3px solid #2ecc71; box-shadow: 0 0 30px rgba(46, 204, 113, 0.5);">
                <h3 style="color: #27ae60; font-size: 2em; margin-bottom: 20px;">üéâ ¬°Sesi√≥n 2 COMPLETADA!</h3>
                <button class="back-button" onclick="showScreen('session3Screen')" style="background: linear-gradient(135deg, #2ecc71, #27ae60); font-size: 1.5em; padding: 25px 60px;">
    üöÄ ¬°Comenzar Sesi√≥n 3: Jerarqu√≠a Completa! ‚Üí
</button>
            </div>
        </div>
    </div>
</div>
    
<!-- ============================================== -->
<!-- SESI√ìN 3: JERARQU√çA COMPLETA DE OPERACIONES -->
<!-- ============================================== -->

<div class="screen" id="session3Screen">
    <div class="content-screen" style="position: relative;">
        <button class="back-button" onclick="showScreen('sectionsScreen')" style="z-index: 10;">‚Üê Volver al mapa</button>
        <div style="text-align: center; margin-top: 30px;">
            <div class="session-header-icon">üß†</div>
            <h2 class="session-title-gradient">Sesi√≥n 3: Jerarqu√≠a Completa de Operaciones</h2>
            <p style="font-size: 1.3em; color: #555; font-weight: 500;">¬°Domina las operaciones combinadas con par√©ntesis, corchetes y llaves!</p>
        </div>

        <div class="content-grid-session1">
            <div class="card-session objective-card">
                <h3>Objetivo de Sesi√≥n</h3>
                <p>Dominar la jerarqu√≠a completa de operaciones con n√∫meros enteros, aplicando correctamente el orden de par√©ntesis ( ), corchetes [ ] y llaves { }, y resolviendo expresiones matem√°ticas complejas con precisi√≥n.</p>
            </div>
            <div class="card-session learning-card">
                <h3>Ruta de Aprendizaje</h3>
                <ul class="learning-list">
                    <li class="learning-list-item" onclick="showScreen('session3TheoryScreen')"><span>üìö</span> Teor√≠a: Jerarqu√≠a Completa con S√≠mbolos de Agrupaci√≥n</li>
                    <li class="learning-list-item" onclick="showScreen('session3PracticeScreen')"><span>‚úçÔ∏è</span> Pr√°ctica Progresiva: 20 Ejercicios Secuenciales</li>
                    <li class="learning-list-item" onclick="openEscapeRoom()"><span>üîê</span> Escape Room: Desaf√≠o Final</li>
                </ul>
            </div>
        </div>

        <div class="session1-nav-grid">
            <div class="session-nav-card" onclick="showScreen('session3TheoryScreen')">
                <div class="session-nav-card-icon">üìö</div>
                <h4>1. Teor√≠a</h4>
            </div>
            <div class="session-nav-card" onclick="showScreen('session3PracticeScreen')">
                <div class="session-nav-card-icon">‚úçÔ∏è</div>
                <h4>2. Pr√°ctica (20 ejercicios)</h4>
            </div>
            <div class="session-nav-card" onclick="openEscapeRoom()">
                <div class="session-nav-card-icon">üîê</div>
                <h4>3. Escape Room</h4>
            </div>
        </div>
    </div>
</div>



<!-- TEOR√çA SESI√ìN 3 - VERSI√ìN MEJORADA -->
<div class="screen" id="session3TheoryScreen">
    <div class="content-screen">
        <button class="back-button" onclick="showScreen('session3Screen')"> ‚Üê Volver a Sesi√≥n 3 </button>
        
        <div style="position: relative; text-align: center; margin-bottom: 30px;">
            <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                <span class="math-symbol" style="position: absolute; left: 10%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">üî¢</span>
                <span class="math-symbol" style="position: absolute; left: 85%; top: 30%; font-size: 2em; animation: floatMath 7s ease-in-out infinite; animation-delay: 0.5s;">üìê</span>
                <span class="math-symbol" style="position: absolute; left: 15%; top: 60%; font-size: 2.2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s;">üéØ</span>
                <span class="math-symbol" style="position: absolute; left: 80%; top: 70%; font-size: 2.3em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 1.5s;">‚ö°</span>
            </div>
            <h2 style="position: relative; z-index: 1;">üìö Jerarqu√≠a Completa: Par√©ntesis, Corchetes y Llaves</h2>
        </div>

        <!-- INTRODUCCI√ìN CON FONDO -->
        <div style="background: linear-gradient(135deg, #e1f5fe, #b3e5fc); padding: 30px; border-radius: 25px; margin: 30px 0; border: 4px solid #03a9f4; box-shadow: 0 15px 40px rgba(3, 169, 244, 0.3);">
            <h3 style="color: #01579b; font-size: 1.8em; margin-bottom: 15px;">üéØ ¬øPor qu√© necesitamos s√≠mbolos de agrupaci√≥n?</h3>
            <p style="font-size: 1.2em; line-height: 1.8; color: #0277bd;">En la Sesi√≥n 2 aprendiste la jerarqu√≠a b√°sica (PEMDSR). Ahora vamos a <strong>nivel EXPERTO</strong>. Cuando tienes expresiones muy complejas con m√∫ltiples operaciones anidadas, necesitas s√≠mbolos de agrupaci√≥n para indicar claramente QU√â se debe resolver PRIMERO.</p>
            
            <p style="font-size: 1.15em; line-height: 1.8; color: #01579b; margin-top: 20px;">üí° Piensa en los s√≠mbolos de agrupaci√≥n como <strong>"cajas dentro de cajas"</strong>. Primero abres la caja m√°s peque√±a (par√©ntesis), luego la mediana (corchetes), y finalmente la m√°s grande (llaves).</p>
        </div>

        <h3 style="color: #9c27b0; font-size: 2em; text-align: center; margin: 40px 0 30px 0;">üîë La Jerarqu√≠a COMPLETA: De adentro hacia afuera</h3>
        
        <div style="background: linear-gradient(135deg, #f3e5f5, #e1bee7); padding: 40px; border-radius: 30px; margin: 30px 0; border: 5px solid #9c27b0; box-shadow: 0 20px 50px rgba(156, 39, 176, 0.4);">
            <h3 style="color: #4a148c; text-align: center; font-size: 2.2em; margin-bottom: 30px; text-shadow: 0 2px 5px rgba(0,0,0,0.1);">üìã Orden COMPLETO de Operaciones</h3>
            
            <div style="display: grid; gap: 20px;">
                <div style="background: linear-gradient(135deg, #fff, #f3e5f5); padding: 25px; border-radius: 20px; border-left: 10px solid #9c27b0; box-shadow: 0 8px 20px rgba(156, 39, 176, 0.2); transition: transform 0.3s;">
                    <h4 style="color: #6a1b9a; font-size: 1.6em; margin-bottom: 15px; display: flex; align-items: center;">
                        <span style="background: #9c27b0; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 1.2em;">1</span>
                        Par√©ntesis Internos ( )
                    </h4>
                    <p style="color: #4a148c; line-height: 1.9; font-size: 1.1em; padding-left: 55px;">Siempre resuelve <strong>PRIMERO</strong> lo que est√° dentro de par√©ntesis. Si hay par√©ntesis anidados (uno dentro de otro), empieza por el <strong>M√ÅS INTERNO</strong>.</p>
                    <div style="background: rgba(156, 39, 176, 0.1); padding: 15px; border-radius: 10px; margin-top: 15px; margin-left: 55px;">
                        <p style="color: #6a1b9a; font-weight: 600; font-size: 1.1em;">üìù Ejemplo: 5 √ó (3 + (8 ‚àí 2))</p>
                        <p style="color: #4a148c; margin-top: 8px;">‚Üí Primero resuelve <span style="background: #ffeb3b; padding: 3px 8px; border-radius: 5px; font-weight: 700;">(8 ‚àí 2) = 6</span></p>
                    </div>
                </div>
                
                <div style="background: linear-gradient(135deg, #fff, #e8eaf6); padding: 25px; border-radius: 20px; border-left: 10px solid #3f51b5; box-shadow: 0 8px 20px rgba(63, 81, 181, 0.2);">
                    <h4 style="color: #1a237e; font-size: 1.6em; margin-bottom: 15px; display: flex; align-items: center;">
                        <span style="background: #3f51b5; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 1.2em;">2</span>
                        Corchetes [ ]
                    </h4>
                    <p style="color: #283593; line-height: 1.9; font-size: 1.1em; padding-left: 55px;">Despu√©s de resolver <strong>TODO</strong> lo que hay en par√©ntesis, resuelves lo que est√° dentro de corchetes.</p>
                    <div style="background: rgba(63, 81, 181, 0.1); padding: 15px; border-radius: 10px; margin-top: 15px; margin-left: 55px;">
                        <p style="color: #1a237e; font-weight: 600; font-size: 1.1em;">üìù Ejemplo: [10 ‚àí (3 + 2)]</p>
                        <p style="color: #283593; margin-top: 8px;">‚Üí Primero <span style="background: #ffeb3b; padding: 3px 8px; border-radius: 5px; font-weight: 700;">(3 + 2) = 5</span>, luego <span style="background: #a5d6a7; padding: 3px 8px; border-radius: 5px; font-weight: 700;">[10 ‚àí 5] = 5</span></p>
                    </div>
                </div>
                
                <div style="background: linear-gradient(135deg, #fff, #e0f2f1); padding: 25px; border-radius: 20px; border-left: 10px solid #00bcd4; box-shadow: 0 8px 20px rgba(0, 188, 212, 0.2);">
                    <h4 style="color: #006064; font-size: 1.6em; margin-bottom: 15px; display: flex; align-items: center;">
                        <span style="background: #00bcd4; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 1.2em;">3</span>
                        Llaves { }
                    </h4>
                    <p style="color: #00695c; line-height: 1.9; font-size: 1.1em; padding-left: 55px;">Finalmente, despu√©s de resolver par√©ntesis y corchetes, resuelves lo que est√° dentro de llaves.</p>
                    <div style="background: rgba(0, 188, 212, 0.1); padding: 15px; border-radius: 10px; margin-top: 15px; margin-left: 55px;">
                        <p style="color: #006064; font-weight: 600; font-size: 1.1em;">üìù Ejemplo: {20 ‚àí [5 + (2 √ó 3)]}</p>
                        <p style="color: #00695c; margin-top: 8px;">‚Üí Resuelves de <strong>adentro hacia afuera</strong></p>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #fff, #fff3e0); padding: 20px; border-radius: 15px; border-left: 8px solid #ff9800;">
                    <h4 style="color: #e65100; font-size: 1.4em; margin-bottom: 10px;">4Ô∏è‚É£ Multiplicaci√≥n √ó y Divisi√≥n √∑</h4>
                    <p style="color: #ef6c00; line-height: 1.8; font-size: 1.05em;">De izquierda a derecha. Tienen la misma prioridad.</p>
                </div>
                
                <div style="background: linear-gradient(135deg, #fff, #e3f2fd); padding: 20px; border-radius: 15px; border-left: 8px solid #2196f3;">
                    <h4 style="color: #0d47a1; font-size: 1.4em; margin-bottom: 10px;">5Ô∏è‚É£ Suma + y Resta ‚àí</h4>
                    <p style="color: #1565c0; line-height: 1.8; font-size: 1.05em;">De izquierda a derecha. Tambi√©n tienen la misma prioridad.</p>
                </div>
            </div>
        </div>

        <!-- REGLA DE ORO -->
        <div style="background: linear-gradient(135deg, #fff9c4, #fff59d); padding: 35px; border-radius: 25px; margin: 40px 0; border: 5px solid #fbc02d; box-shadow: 0 20px 50px rgba(251, 192, 45, 0.4); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -20px; right: -20px; font-size: 8em; opacity: 0.1;">üèÜ</div>
            <h3 style="color: #f57f17; font-size: 2em; margin-bottom: 25px; text-align: center; position: relative; z-index: 1;">üéì Regla de Oro: "De ADENTRO hacia AFUERA"</h3>
            <div style="position: relative; z-index: 1;">
                <p style="font-size: 1.25em; line-height: 2; color: #6d4c41; font-weight: 600; margin: 15px 0;">
                    <span style="background: #f57f17; color: white; padding: 5px 15px; border-radius: 10px; display: inline-block; margin-right: 10px;">PASO 1</span> Busca el s√≠mbolo M√ÅS INTERNO (generalmente par√©ntesis)
                </p>
                <p style="font-size: 1.25em; line-height: 2; color: #6d4c41; font-weight: 600; margin: 15px 0;">
                    <span style="background: #ff9800; color: white; padding: 5px 15px; border-radius: 10px; display: inline-block; margin-right: 10px;">PASO 2</span> Resuelve TODO lo que est√° dentro de ese s√≠mbolo
                </p>
                <p style="font-size: 1.25em; line-height: 2; color: #6d4c41; font-weight: 600; margin: 15px 0;">
                    <span style="background: #fbc02d; color: white; padding: 5px 15px; border-radius: 10px; display: inline-block; margin-right: 10px;">PASO 3</span> Elimina ese s√≠mbolo y contin√∫a hacia AFUERA
                </p>
                <p style="font-size: 1.25em; line-height: 2; color: #6d4c41; font-weight: 600; margin: 15px 0;">
                    <span style="background: #f9a825; color: white; padding: 5px 15px; border-radius: 10px; display: inline-block; margin-right: 10px;">PASO 4</span> Repite hasta que no queden s√≠mbolos de agrupaci√≥n
                </p>
                <p style="font-size: 1.25em; line-height: 2; color: #6d4c41; font-weight: 600; margin: 15px 0;">
                    <span style="background: #f57c00; color: white; padding: 5px 15px; border-radius: 10px; display: inline-block; margin-right: 10px;">PASO 5</span> Aplica PEMDSR (Multiplicaci√≥n/Divisi√≥n, luego Suma/Resta)
                </p>
            </div>
        </div>

        <h3 style="color: #1976d2; font-size: 2em; text-align: center; margin: 50px 0 30px 0;">üìù Ejemplos Resueltos Paso a Paso</h3>

        <!-- EJEMPLO 1 -->
        <div style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); padding: 35px; border-radius: 25px; margin: 30px 0; border: 4px solid #2196f3; box-shadow: 0 15px 40px rgba(33, 150, 243, 0.3);">
            <h4 style="color: #0d47a1; font-size: 1.8em; margin-bottom: 20px; display: flex; align-items: center;">
                <span style="background: #2196f3; color: white; padding: 10px 20px; border-radius: 15px; margin-right: 15px;">1</span>
                {15 ‚àí [8 + (3 √ó 2)]}
            </h4>
            <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                <p style="font-size: 1.15em; color: #01579b; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #1976d2;">Paso 1:</strong> Identificar el s√≠mbolo M√ÅS INTERNO ‚Üí <span style="background: #ffeb3b; padding: 5px 12px; border-radius: 8px; font-weight: 700;">(3 √ó 2)</span>
                </p>
                <p style="font-size: 1.15em; color: #01579b; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #1976d2;">Paso 2:</strong> Resolver ‚Üí 3 √ó 2 = <strong style="color: #2e7d32; font-size: 1.3em;">6</strong>
                </p>
                <p style="font-size: 1.15em; color: #01579b; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #1976d2;">Paso 3:</strong> Reemplazar ‚Üí {15 ‚àí [8 + <strong style="color: #2e7d32;">6</strong>]}
                </p>
                <p style="font-size: 1.15em; color: #01579b; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #1976d2;">Paso 4:</strong> Resolver corchetes ‚Üí [8 + 6] = <strong style="color: #2e7d32; font-size: 1.3em;">14</strong>
                </p>
                <p style="font-size: 1.15em; color: #01579b; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #1976d2;">Paso 5:</strong> Reemplazar ‚Üí {15 ‚àí <strong style="color: #2e7d32;">14</strong>}
                </p>
                <p style="font-size: 1.15em; color: #01579b; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #1976d2;">Paso 6:</strong> Resolver llaves ‚Üí 15 ‚àí 14 = <strong style="font-size: 1.5em; color: #1565c0;">1</strong>
                </p>
            </div>
            <div style="background: linear-gradient(135deg, #4caf50, #388e3c); color: white; padding: 20px; border-radius: 15px; text-align: center; font-size: 1.5em; font-weight: 700; margin-top: 20px; box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);">
                ‚úÖ RESPUESTA FINAL: 1
            </div>
        </div>

        <!-- EJEMPLO 2 -->
        <div style="background: linear-gradient(135deg, #f3e5f5, #e1bee7); padding: 35px; border-radius: 25px; margin: 30px 0; border: 4px solid #9c27b0; box-shadow: 0 15px 40px rgba(156, 39, 176, 0.3);">
            <h4 style="color: #6a1b9a; font-size: 1.8em; margin-bottom: 20px; display: flex; align-items: center;">
                <span style="background: #9c27b0; color: white; padding: 10px 20px; border-radius: 15px; margin-right: 15px;">2</span>
                20 √∑ [10 ‚àí (3 + 2)] + 5
            </h4>
            <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                <p style="font-size: 1.15em; color: #4a148c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #7b1fa2;">Paso 1:</strong> Par√©ntesis interno ‚Üí <span style="background: #ffeb3b; padding: 5px 12px; border-radius: 8px; font-weight: 700;">(3 + 2)</span> = <strong style="color: #2e7d32; font-size: 1.3em;">5</strong>
                </p>
                <p style="font-size: 1.15em; color: #4a148c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #7b1fa2;">Paso 2:</strong> Reemplazar ‚Üí 20 √∑ [10 ‚àí <strong style="color: #2e7d32;">5</strong>] + 5
                </p>
                <p style="font-size: 1.15em; color: #4a148c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #7b1fa2;">Paso 3:</strong> Corchetes ‚Üí [10 ‚àí 5] = <strong style="color: #2e7d32; font-size: 1.3em;">5</strong>
                </p>
                <p style="font-size: 1.15em; color: #4a148c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #7b1fa2;">Paso 4:</strong> Reemplazar ‚Üí 20 √∑ <strong style="color: #2e7d32;">5</strong> + 5
                </p>
                <p style="font-size: 1.15em; color: #4a148c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #7b1fa2;">Paso 5:</strong> Divisi√≥n primero ‚Üí 20 √∑ 5 = <strong style="color: #2e7d32; font-size: 1.3em;">4</strong>
                </p>
                <p style="font-size: 1.15em; color: #4a148c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #7b1fa2;">Paso 6:</strong> Suma ‚Üí 4 + 5 = <strong style="font-size: 1.5em; color: #6a1b9a;">9</strong>
                </p>
            </div>
            <div style="background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: white; padding: 20px; border-radius: 15px; text-align: center; font-size: 1.5em; font-weight: 700; margin-top: 20px; box-shadow: 0 8px 20px rgba(156, 39, 176, 0.4);">
                ‚úÖ RESPUESTA FINAL: 9
            </div>
        </div>

        <!-- EJEMPLO 3 CON NEGATIVOS -->
        <div style="background: linear-gradient(135deg, #fff3e0, #ffe0b2); padding: 35px; border-radius: 25px; margin: 30px 0; border: 4px solid #ff9800; box-shadow: 0 15px 40px rgba(255, 152, 0, 0.3);">
            <h4 style="color: #e65100; font-size: 1.8em; margin-bottom: 20px; display: flex; align-items: center;">
                <span style="background: #ff9800; color: white; padding: 10px 20px; border-radius: 15px; margin-right: 15px;">3</span>
                {(‚àí5) √ó [(‚àí8) √∑ (‚àí2)]} + 10
            </h4>
            <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                <p style="font-size: 1.15em; color: #bf360c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #e65100;">Paso 1:</strong> Par√©ntesis m√°s interno ‚Üí <span style="background: #ffeb3b; padding: 5px 12px; border-radius: 8px; font-weight: 700;">(‚àí8) √∑ (‚àí2)</span>
                </p>
                <p style="font-size: 1.15em; color: #bf360c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #e65100;">Paso 2:</strong> Aplicar ley de signos ‚Üí (‚àí) √∑ (‚àí) = (+) ‚Üí 8 √∑ 2 = <strong style="color: #2e7d32; font-size: 1.3em;">4</strong>
                </p>
                <p style="font-size: 1.15em; color: #bf360c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #e65100;">Paso 3:</strong> Reemplazar ‚Üí {(‚àí5) √ó [<strong style="color: #2e7d32;">4</strong>]} + 10
                </p>
                <p style="font-size: 1.15em; color: #bf360c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #e65100;">Paso 4:</strong> Corchetes ‚Üí [4] = 4
                </p>
                <p style="font-size: 1.15em; color: #bf360c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #e65100;">Paso 5:</strong> Llaves ‚Üí (‚àí5) √ó 4 = <strong style="color: #c62828; font-size: 1.3em;">‚àí20</strong>
                </p>
                <p style="font-size: 1.15em; color: #bf360c; line-height: 2.2; margin: 10px 0;">
                    <strong style="color: #e65100;">Paso 6:</strong> Suma ‚Üí (‚àí20) + 10 = <strong style="font-size: 1.5em; color: #d84315;">‚àí10</strong>
                </p>
            </div>
            <div style="background: linear-gradient(135deg, #ff9800, #f57c00); color: white; padding: 20px; border-radius: 15px; text-align: center; font-size: 1.5em; font-weight: 700; margin-top: 20px; box-shadow: 0 8px 20px rgba(255, 152, 0, 0.4);">
                ‚úÖ RESPUESTA FINAL: ‚àí10
            </div>
        </div>

        <!-- ERRORES COMUNES -->
        <div style="background: linear-gradient(135deg, #ffebee, #ffcdd2); padding: 30px; border-radius: 20px; border-left: 10px solid #f44336; margin: 40px 0; box-shadow: 0 10px 30px rgba(244, 67, 54, 0.3);">
            <h3 style="color: #c62828; font-size: 1.8em; margin-bottom: 20px;">‚ö†Ô∏è Errores Comunes que DEBES Evitar</h3>
            <div style="background: white; padding: 20px; border-radius: 15px; margin: 10px 0; border-left: 5px solid #e53935;">
                <p style="font-size: 1.15em; line-height: 1.8; color: #b71c1c;"><strong>‚ùå Error 1:</strong> Resolver de afuera hacia adentro (INCORRECTO)</p>
            </div>
            <div style="background: white; padding: 20px; border-radius: 15px; margin: 10px 0; border-left: 5px solid #e53935;">
                <p style="font-size: 1.15em; line-height: 1.8; color: #b71c1c;"><strong>‚ùå Error 2:</strong> No respetar la jerarqu√≠a dentro de cada agrupaci√≥n</p>
            </div>
            <div style="background: white; padding: 20px; border-radius: 15px; margin: 10px 0; border-left: 5px solid #e53935;">
                <p style="font-size: 1.15em; line-height: 1.8; color: #b71c1c;"><strong>‚ùå Error 3:</strong> Olvidar aplicar la ley de signos en multiplicaciones/divisiones</p>
            </div>
            <div style="background: white; padding: 20px; border-radius: 15px; margin: 10px 0; border-left: 5px solid #e53935;">
                <p style="font-size: 1.15em; line-height: 1.8; color: #b71c1c;"><strong>‚ùå Error 4:</strong> Saltarse s√≠mbolos de agrupaci√≥n por impaciencia</p>
            </div>
        </div>

        <!-- CONSEJO DE MAESTRO -->
        <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 40px; border-radius: 25px; margin: 40px 0; box-shadow: 0 20px 50px rgba(102, 126, 234, 0.5); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -30px; right: -30px; font-size: 10em; opacity: 0.1;">üë®‚Äçüè´</div>
            <h3 style="font-size: 2em; margin-bottom: 25px; text-align: center; text-shadow: 0 2px 5px rgba(0,0,0,0.3); position: relative; z-index: 1;">üí° Consejo de Maestro</h3>
            <div style="position: relative; z-index: 1;">
                <p style="font-size: 1.3em; line-height: 2; font-weight: 500; margin: 15px 0;">
                    üìù <strong>Cuando te enfrentes a una expresi√≥n compleja:</strong>
                </p>
                <p style="font-size: 1.2em; line-height: 2; margin: 15px 0; padding-left: 30px;">
                    1Ô∏è‚É£ Respira profundo y NO te apresures üßò
                </p>
                <p style="font-size: 1.2em; line-height: 2; margin: 15px 0; padding-left: 30px;">
                    2Ô∏è‚É£ Encierra con colores diferentes cada nivel de agrupaci√≥n
                </p>
                <p style="font-size: 1.2em; line-height: 2; margin: 15px 0; padding-left: 30px;">
                    3Ô∏è‚É£ Trabaja SIEMPRE de adentro hacia afuera
                </p>
                <p style="font-size: 1.2em; line-height: 2; margin: 15px 0; padding-left: 30px;">
                    4Ô∏è‚É£ Escribe CADA PASO (no lo hagas todo en tu cabeza)
                </p>
                <p style="font-size: 1.2em; line-height: 2; margin: 15px 0; padding-left: 30px;">
                    5Ô∏è‚É£ Verifica tu respuesta sustituyendo hacia atr√°s
                </p>
                <p style="font-size: 1.3em; line-height: 2; font-weight: 600; margin-top: 25px; text-align: center; background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px;">
                    üéØ La clave es la PACIENCIA y el ORDEN. ¬°Los expertos no son r√°pidos, son PRECISOS!
                </p>
            </div>
        </div>

        <p style="margin-top: 35px; font-size: 1.1em; color: #764ba2;">Tiempo Sugerido: <strong>25 min</strong> (Teor√≠a + Ejemplos).</p>

        <div style="text-align: right; margin-top: 40px;">
            <button class="start-activity-button back-button" onclick="completeSubActivity(3, 1); showScreen('session3PracticeScreen');">Continuar a Pr√°ctica Progresiva ‚Üí</button>
        </div>
    </div>
</div>

<!-- PR√ÅCTICA PROGRESIVA SESI√ìN 3: 15 EJERCICIOS MEJORADOS -->
<div class="screen" id="session3PracticeScreen">
    <div class="content-screen">
        <button class="back-button" onclick="showScreen('session3Screen')"> ‚Üê Volver a Sesi√≥n 3 </button>
        
        <div style="position: relative; text-align: center; margin-bottom: 30px;">
            <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                <span class="math-symbol" style="position: absolute; left: 10%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">‚úçÔ∏è</span>
                <span class="math-symbol" style="position: absolute; left: 85%; top: 30%; font-size: 2em; animation: floatMath 7s ease-in-out infinite; animation-delay: 0.5s;">üéØ</span>
                <span class="math-symbol" style="position: absolute; left: 15%; top: 60%; font-size: 2.2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s;">üí™</span>
                <span class="math-symbol" style="position: absolute; left: 80%; top: 70%; font-size: 2.3em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 1.5s;">üß†</span>
            </div>
            <h2 style="position: relative; z-index: 1;">‚úçÔ∏è Pr√°ctica Progresiva: 15 Ejercicios Secuenciales</h2>
        </div>

        <!-- HEADER INFORMATIVO -->
        <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 30px; border-radius: 20px; margin-bottom: 40px; box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4); color: white;">
            <h3 style="font-size: 1.8em; margin-bottom: 15px; text-align: center; text-shadow: 0 2px 5px rgba(0,0,0,0.3);">üéØ ¬°Demuestra tu dominio!</h3>
            <p style="font-size: 1.2em; line-height: 1.8; text-align: center; margin-bottom: 20px;">
                Resuelve los 15 ejercicios en orden de dificultad creciente.<br>
                Necesitas <strong style="background: rgba(255,255,255,0.3); padding: 5px 15px; border-radius: 10px;">al menos 10 correctos</strong> para avanzar al Escape Room.
            </p>
            <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 15px; margin-top: 25px;">
                <div style="background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 5px;">‚è±Ô∏è</div>
                    <div style="font-size: 1.1em; font-weight: 600;">T√≥mate tu tiempo</div>
                </div>
                <div style="background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 5px;">üìù</div>
                    <div style="font-size: 1.1em; font-weight: 600;">Usa papel y l√°piz</div>
                </div>
                <div style="background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 5px;">üéØ</div>
                    <div style="font-size: 1.1em; font-weight: 600;">Precisi√≥n > Velocidad</div>
                </div>
            </div>
        </div>

        <!-- BARRA DE PROGRESO -->
        <div style="background: linear-gradient(135deg, #f5f5f5, #e0e0e0); padding: 20px; border-radius: 20px; margin-bottom: 40px; border: 3px solid #9e9e9e; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
            <p style="font-size: 1.2em; font-weight: 700; color: #424242; margin-bottom: 15px; text-align: center;">üìä Progreso de Resoluci√≥n</p>
            <div id="session3ProgressBar" style="background: #bdbdbd; height: 30px; border-radius: 15px; overflow: hidden; box-shadow: 0 3px 8px rgba(0,0,0,0.2) inset; position: relative;">
                <div id="session3ProgressFill" style="background: linear-gradient(90deg, #667eea, #764ba2, #f093fb); height: 100%; width: 0%; transition: width 0.8s cubic-bezier(0.4, 0.0, 0.2, 1); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.1em; box-shadow: 0 0 20px rgba(102, 126, 234, 0.6);"></div>
            </div>
        </div>

        <div class="quiz-container" style="background: linear-gradient(135deg, #fafafa, #f5f5f5); padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
            
            <!-- NIVEL 1: B√ÅSICO (Ejercicios 1-5) -->
            <div style="background: linear-gradient(135deg, #e8f5e9, #c8e6c9); padding: 20px; border-radius: 15px; margin-bottom: 25px; border-left: 8px solid #4caf50;">
                <h3 style="color: #2e7d32; font-size: 1.6em; margin-bottom: 15px; display: flex; align-items: center;">
                    <span style="background: #4caf50; color: white; padding: 8px 18px; border-radius: 10px; margin-right: 15px;">NIVEL 1</span>
                    B√°sico - Calentamiento
                </h3>
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f1f8e9); border-left: 5px solid #8bc34a;">
                <label for="s3q1">1. 10 + (5 √ó 2) ‚àí 8 =</label>
                <input type="text" id="s3q1" class="quiz-input" data-correct="12" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f1f8e9); border-left: 5px solid #8bc34a;">
                <label for="s3q2">2. 24 √∑ [12 ‚àí (3 + 3)] =</label>
                <input type="text" id="s3q2" class="quiz-input" data-correct="4" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f1f8e9); border-left: 5px solid #8bc34a;">
                <label for="s3q3">3. {20 ‚àí [15 ‚àí (2 √ó 3)]} =</label>
                <input type="text" id="s3q3" class="quiz-input" data-correct="11" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f1f8e9); border-left: 5px solid #8bc34a;">
                <label for="s3q4">4. 7 √ó (10 ‚àí 6) + 5 =</label>
                <input type="text" id="s3q4" class="quiz-input" data-correct="33" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f1f8e9); border-left: 5px solid #8bc34a;">
                <label for="s3q5">5. [18 √∑ (2 + 1)] √ó 4 =</label>
                <input type="text" id="s3q5" class="quiz-input" data-correct="24" placeholder="Respuesta" />
            </div>

            <!-- NIVEL 2: INTERMEDIO (Ejercicios 6-10) -->
            <div style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); padding: 20px; border-radius: 15px; margin: 30px 0 25px 0; border-left: 8px solid #2196f3;">
                <h3 style="color: #0d47a1; font-size: 1.6em; margin-bottom: 15px; display: flex; align-items: center;">
                    <span style="background: #2196f3; color: white; padding: 8px 18px; border-radius: 10px; margin-right: 15px;">NIVEL 2</span>
                    Intermedio - Aumenta el Desaf√≠o
                </h3>
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #e3f2fd); border-left: 5px solid #42a5f5;">
                <label for="s3q6">6. {30 ‚àí [12 + (4 √ó 2)]} + 5 =</label>
                <input type="text" id="s3q6" class="quiz-input" data-correct="15" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #e3f2fd); border-left: 5px solid #42a5f5;">
                <label for="s3q7">7. 50 √∑ {10 ‚àí [8 ‚àí (3 + 2)]} =</label>
                <input type="text" id="s3q7" class="quiz-input" data-correct="10" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #e3f2fd); border-left: 5px solid #42a5f5;">
                <label for="s3q8">8. [(15 + 5) √∑ 4] √ó (6 ‚àí 2) =</label>
                <input type="text" id="s3q8" class="quiz-input" data-correct="20" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #e3f2fd); border-left: 5px solid #42a5f5;">
                <label for="s3q9">9. {[(24 ‚àí 8) √∑ 4] + 3} √ó 2 =</label>
                <input type="text" id="s3q9" class="quiz-input" data-correct="18" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #e3f2fd); border-left: 5px solid #42a5f5;">
                <label for="s3q10">10. 40 ‚àí {15 + [10 ‚àí (3 + 2)]} =</label>
                <input type="text" id="s3q10" class="quiz-input" data-correct="20" placeholder="Respuesta" />
            </div>

            <!-- NIVEL 3: AVANZADO/EXPERTO (Ejercicios 11-15) -->
            <div style="background: linear-gradient(135deg, #f3e5f5, #e1bee7); padding: 20px; border-radius: 15px; margin: 30px 0 25px 0; border-left: 8px solid #9c27b0;">
                <h3 style="color: #6a1b9a; font-size: 1.6em; margin-bottom: 15px; display: flex; align-items: center;">
                    <span style="background: #9c27b0; color: white; padding: 8px 18px; border-radius: 10px; margin-right: 15px;">NIVEL 3</span>
                    Avanzado - ¬°Demuestra tu Maestr√≠a!
                </h3>
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f3e5f5); border-left: 5px solid #ab47bc;">
                <label for="s3q11">11. (‚àí5) √ó [10 ‚àí (3 + 4)] + 8 =</label>
                <input type="text" id="s3q11" class="quiz-input" data-correct="-7" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f3e5f5); border-left: 5px solid #ab47bc;">
                <label for="s3q12">12. 60 ‚àí {[(‚àí8) √ó (‚àí3)] + 15} =</label>
                <input type="text" id="s3q12" class="quiz-input" data-correct="21" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f3e5f5); border-left: 5px solid #ab47bc;">
                <label for="s3q13">13. [(‚àí20) √∑ (‚àí4)] √ó {10 ‚àí [8 ‚àí 3]} =</label>
                <input type="text" id="s3q13" class="quiz-input" data-correct="25" placeholder="Respuesta" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #fff3e0); border-left: 5px solid #ff9800; box-shadow: 0 5px 15px rgba(255, 152, 0, 0.2);">
                <label for="s3q14" style="color: #e65100; font-weight: 700;">14. 100 ‚àí {50 + [20 ‚àí (8 √∑ 2) √ó 3]} =</label>
                <input type="text" id="s3q14" class="quiz-input" data-correct="62" placeholder="Respuesta" style="border-color: #ff9800;" />
            </div>
            
            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #ffebee); border-left: 5px solid #f44336; box-shadow: 0 5px 15px rgba(244, 67, 54, 0.2);">
                <label for="s3q15" style="color: #c62828; font-weight: 700;">15. üî• DESAF√çO FINAL: 150 ‚àí {[(‚àí60) √∑ (‚àí12)] √ó [18 ‚àí (4 + 5)]} ‚àí 10 =</label>
                <input type="text" id="s3q15" class="quiz-input" data-correct="95" placeholder="Respuesta" style="border-color: #f44336; border-width: 3px;" />
            </div>
        </div>

        <button class="submit-quiz-button back-button" onclick="submitSession3Practice()" style="background: linear-gradient(135deg, #667eea, #764ba2, #f093fb); font-size: 1.4em; padding: 25px 50px; margin-top: 40px; box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);">
            üîç Verificar Todas las Respuestas
        </button>
        
        <div id="session3PracticeResults" class="quiz-results" style="display: none; background: linear-gradient(135deg, #f5f5f5, #ffffff); border: 4px solid #667eea; box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3); margin-top: 40px;">
            <h3 style="color: #667eea; font-size: 2em; border-bottom: 3px solid #667eea; padding-bottom: 15px; margin-bottom: 25px;">üìä Resultados de la Pr√°ctica</h3>
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; text-align: center; box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);">
                <p style="font-size: 1.5em; margin-bottom: 10px;">Tu Puntuaci√≥n:</p>
                <p style="font-size: 3em; font-weight: 900; margin: 0;"><span id="session3PracticeScore">0/15</span></p>
            </div>
            <ul class="result-list" id="session3PracticeResultList" style="list-style: none; padding: 0;"></ul>
        </div>
        
        <div id="session3CompleteButton" style="display: none; text-align: center; margin-top: 50px; animation: fadeInScale 1s ease-out;">
            <div style="background: linear-gradient(135deg, rgba(156, 39, 176, 0.2), rgba(103, 58, 183, 0.2)); padding: 40px; border-radius: 30px; border: 4px solid #9c27b0; box-shadow: 0 20px 60px rgba(156, 39, 176, 0.5); position: relative; overflow: hidden;">
                <div style="position: absolute; top: -50px; right: -50px; font-size: 15em; opacity: 0.1;">üéâ</div>
                <h3 style="color: #6a1b9a; font-size: 2.5em; margin-bottom: 25px; position: relative; z-index: 1;">üéâ ¬°PR√ÅCTICA SUPERADA!</h3>
                <p style="font-size: 1.3em; color: #4a148c; margin-bottom: 30px; line-height: 1.8; position: relative; z-index: 1;">
                    Has demostrado dominio de la jerarqu√≠a completa.<br>
                    <strong style="font-size: 1.2em;">¬°Est√°s listo para el Escape Room!</strong>
                </p>
                <button class="back-button" onclick="openEscapeRoom()" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2, #6a1b9a); font-size: 1.6em; padding: 30px 70px; box-shadow: 0 15px 40px rgba(156, 39, 176, 0.6); position: relative; z-index: 1;">
                    üîê ¬°Acceder al Escape Room! ‚Üí
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ESCAPE ROOM SESI√ìN 3: PANTALLA INFORMATIVA -->
<div class="screen" id="session3EscapeRoomScreen">
    <div class="content-screen">
        <button class="back-button" onclick="showScreen('session3Screen')"> ‚Üê Volver a Sesi√≥n 3 </button>
        
        <div style="position: relative; text-align: center; margin-bottom: 40px;">
            <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                <span class="math-symbol" style="position: absolute; left: 10%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">üîê</span>
                <span class="math-symbol" style="position: absolute; left: 85%; top: 30%; font-size: 2em; animation: floatMath 7s ease-in-out infinite; animation-delay: 0.5s;">üêâ</span>
                <span class="math-symbol" style="position: absolute; left: 15%; top: 60%; font-size: 2.2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s;">‚öîÔ∏è</span>
                <span class="math-symbol" style="position: absolute; left: 80%; top: 70%; font-size: 2.3em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 1.5s;">üèÜ</span>
            </div>
            <h2 style="position: relative; z-index: 1; font-size: 3em; background: linear-gradient(135deg, #667eea, #764ba2, #f093fb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">üîê Escape Room: La Batalla del Drag√≥n</h2>
        </div>

        <!-- INTRODUCCI√ìN √âPICA -->
        <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 40px; border-radius: 30px; margin: 30px 0; border: 5px solid #f093fb; box-shadow: 0 20px 60px rgba(240, 147, 251, 0.5); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -50px; right: -50px; font-size: 15em; opacity: 0.05; transform: rotate(-15deg);">üêâ</div>
            
            <div style="text-align: center; margin-bottom: 30px; position: relative; z-index: 1;">
                <div style="font-size: 6em; animation: pulse 2s infinite;">üêâ</div>
                <h3 style="color: #f093fb; font-size: 2.5em; margin-top: 20px; text-shadow: 0 0 20px rgba(240, 147, 251, 0.8);">¬°El Drag√≥n Matem√°tico te Desaf√≠a!</h3>
            </div>
            
            <p style="color: #ffffff; font-size: 1.3em; line-height: 2; text-align: center; margin-bottom: 30px; position: relative; z-index: 1;">
                Un poderoso drag√≥n ha encerrado los conocimientos matem√°ticos en una torre oscura. 
                Solo los valientes que dominen las operaciones con n√∫meros enteros podr√°n liberarlos.
                <br><br>
                <strong style="color: #ffeb3b; font-size: 1.2em;">¬øAceptas el desaf√≠o?</strong>
            </p>
        </div>

        <!-- ESTRUCTURA DEL DESAF√çO -->
        <div style="background: linear-gradient(135deg, #f3e5f5, #e1bee7); padding: 40px; border-radius: 25px; margin: 40px 0; border: 4px solid #9c27b0; box-shadow: 0 15px 40px rgba(156, 39, 176, 0.4);">
            <h3 style="color: #6a1b9a; font-size: 2.2em; text-align: center; margin-bottom: 35px; display: flex; align-items: center; justify-content: center; gap: 15px;">
                <span style="font-size: 1.5em;">‚öîÔ∏è</span>
                Estructura del Escape Room
                <span style="font-size: 1.5em;">üó°Ô∏è</span>
            </h3>

            <div style="display: grid; gap: 25px;">
                <!-- NIVELES 1 y 2 -->
                <div style="background: linear-gradient(135deg, #e8f5e9, #c8e6c9); padding: 30px; border-radius: 20px; border-left: 10px solid #4caf50; box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3); transition: transform 0.3s;" onmouseover="this.style.transform='translateX(10px)'" onmouseout="this.style.transform='translateX(0)'">
                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px;">
                        <span style="background: #4caf50; color: white; font-size: 1.5em; font-weight: 900; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(76, 175, 80, 0.5);">1-2</span>
                        <h4 style="color: #2e7d32; font-size: 1.8em; margin: 0;">Niveles 1 y 2: Las Puertas del Castillo</h4>
                    </div>
                    <p style="color: #1b5e20; font-size: 1.2em; line-height: 1.8; padding-left: 80px;">
                        <strong>üìö Contenido:</strong> Operaciones b√°sicas con n√∫meros enteros<br>
                        <strong>üéØ Temas:</strong> Suma, resta, multiplicaci√≥n, divisi√≥n y ley de signos<br>
                        <strong>‚ö° Dificultad:</strong> B√°sico - Intermedio<br>
                        <strong>üìñ Basado en:</strong> Sesi√≥n 1 y parte de Sesi√≥n 2
                    </p>
                </div>

                <!-- NIVELES 3 y 4 -->
                <div style="background: linear-gradient(135deg, #fff3e0, #ffe0b2); padding: 30px; border-radius: 20px; border-left: 10px solid #ff9800; box-shadow: 0 8px 20px rgba(255, 152, 0, 0.3); transition: transform 0.3s;" onmouseover="this.style.transform='translateX(10px)'" onmouseout="this.style.transform='translateX(0)'">
                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px;">
                        <span style="background: #ff9800; color: white; font-size: 1.5em; font-weight: 900; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(255, 152, 0, 0.5);">3-4</span>
                        <h4 style="color: #e65100; font-size: 1.8em; margin: 0;">Niveles 3 y 4: La Guarida del Drag√≥n</h4>
                    </div>
                    <p style="color: #bf360c; font-size: 1.2em; line-height: 1.8; padding-left: 80px;">
                        <strong>üìö Contenido:</strong> Jerarqu√≠a completa de operaciones<br>
                        <strong>üéØ Temas:</strong> Par√©ntesis, corchetes, llaves y operaciones combinadas<br>
                        <strong>‚ö° Dificultad:</strong> Avanzado - Experto<br>
                        <strong>üìñ Basado en:</strong> Sesi√≥n 2 (jerarqu√≠a) y Sesi√≥n 3 completa
                    </p>
                </div>
            </div>
        </div>

        <!-- RECOMPENSAS -->
        <div style="background: linear-gradient(135deg, #fff9c4, #fff59d); padding: 35px; border-radius: 25px; margin: 40px 0; border: 5px solid #fbc02d; box-shadow: 0 20px 50px rgba(251, 192, 45, 0.4); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -30px; right: -30px; font-size: 12em; opacity: 0.1;">üèÜ</div>
            <h3 style="color: #f57f17; font-size: 2em; text-align: center; margin-bottom: 25px; position: relative; z-index: 1;">üéÅ Recompensas por Completar el Escape Room</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; position: relative; z-index: 1;">
                <div style="background: rgba(255, 255, 255, 0.9); padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <div style="font-size: 3em; margin-bottom: 10px;">‚úÖ</div>
                    <p style="color: #6d4c41; font-size: 1.2em; font-weight: 600;">Dominio de<br>N√∫meros Enteros</p>
                </div>
                <div style="background: rgba(255, 255, 255, 0.9); padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <div style="font-size: 3em; margin-bottom: 10px;">üîì</div>
                    <p style="color: #6d4c41; font-size: 1.2em; font-weight: 600;">Desbloqueo de<br>Sesi√≥n 4: Fracciones</p>
                </div>
                <div style="background: rgba(255, 255, 255, 0.9); padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <div style="font-size: 3em; margin-bottom: 10px;">üèÖ</div>
                    <p style="color: #6d4c41; font-size: 1.2em; font-weight: 600;">Certificado de<br>Conquistador</p>
                </div>
            </div>
        </div>

        <!-- CONSEJOS ANTES DE EMPEZAR -->
        <div style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); padding: 35px; border-radius: 25px; margin: 40px 0; border: 4px solid #2196f3; box-shadow: 0 15px 40px rgba(33, 150, 243, 0.3);">
            <h3 style="color: #0d47a1; font-size: 2em; text-align: center; margin-bottom: 25px;">üí° Consejos Antes de Comenzar</h3>
            <div style="display: grid; gap: 15px;">
                <div style="background: white; padding: 20px; border-radius: 15px; border-left: 6px solid #2196f3; display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 2em;">üìù</span>
                    <p style="color: #01579b; font-size: 1.15em; margin: 0; line-height: 1.6;">Ten papel y l√°piz a mano para resolver las operaciones</p>
                </div>
                <div style="background: white; padding: 20px; border-radius: 15px; border-left: 6px solid #2196f3; display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 2em;">‚è∞</span>
                    <p style="color: #01579b; font-size: 1.15em; margin: 0; line-height: 1.6;">No hay l√≠mite de tiempo, trabaja con calma y precisi√≥n</p>
                </div>
                <div style="background: white; padding: 20px; border-radius: 15px; border-left: 6px solid #2196f3; display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 2em;">üéØ</span>
                    <p style="color: #01579b; font-size: 1.15em; margin: 0; line-height: 1.6;">Lee bien cada pregunta antes de responder</p>
                </div>
                <div style="background: white; padding: 20px; border-radius: 15px; border-left: 6px solid #2196f3; display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 2em;">üîÑ</span>
                    <p style="color: #01579b; font-size: 1.15em; margin: 0; line-height: 1.6;">Si te equivocas, puedes reintentar desde el nivel donde quedaste</p>
                </div>
            </div>
        </div>

        <!-- BOT√ìN √âPICO DE INICIO -->
        <div style="text-align: center; margin: 60px 0;">
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 50px; border-radius: 30px; display: inline-block; box-shadow: 0 25px 70px rgba(102, 126, 234, 0.6); position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent); animation: shimmer 2s infinite;"></div>
                
                <p style="color: white; font-size: 1.5em; margin-bottom: 25px; font-weight: 600; text-shadow: 0 2px 10px rgba(0,0,0,0.3); position: relative; z-index: 1;">
                    ‚öîÔ∏è ¬øEst√°s listo para enfrentar al Drag√≥n Matem√°tico? ‚öîÔ∏è
                </p>
                
                <button onclick="launchEscapeRoom()" class="back-button" style="background: linear-gradient(135deg, #f093fb, #f5576c); font-size: 2em; padding: 30px 80px; border: 4px solid white; box-shadow: 0 15px 40px rgba(245, 87, 108, 0.6), 0 0 30px rgba(255,255,255,0.5) inset; position: relative; z-index: 1; transition: all 0.3s;">
                    üêâ ¬°INICIAR ESCAPE ROOM! üó°Ô∏è
                </button>
                
                <p style="color: rgba(255,255,255,0.9); font-size: 1.1em; margin-top: 20px; font-style: italic; position: relative; z-index: 1;">
                    Se abrir√° en una nueva pesta√±a
                </p>
            </div>
        </div>

        <style>
            @keyframes shimmer {
                0% { transform: translateX(-100%); }
                100% { transform: translateX(100%); }
            }
        </style>
    </div>
</div>

<!-- ============================================== -->
    <!-- ========== SESI√ìN 4: FRACCIONES (I) ========== -->
    <!-- ============================================== -->
    
    <div class="screen" id="session4Screen">
        <div class="content-screen" style="position: relative; background: linear-gradient(180deg, rgba(255,215,0,0.05) 0%, rgba(255,140,0,0.08) 100%);">
            <button class="back-button" onclick="showScreen('sectionsScreen')" style="z-index: 10;">‚Üê Volver al mapa</button>
            
            <!-- Decoraci√≥n flotante tem√°tica de pizza/fracciones -->
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden; z-index: 0;">
                <span style="position: absolute; left: 5%; top: 15%; font-size: 3em; animation: floatMath 8s ease-in-out infinite; opacity: 0.25;">üçï</span>
                <span style="position: absolute; right: 8%; top: 20%; font-size: 2.5em; animation: floatMath 7s ease-in-out infinite; animation-delay: 1s; opacity: 0.25;">ü•ß</span>
                <span style="position: absolute; left: 10%; bottom: 30%; font-size: 2.8em; animation: floatMath 9s ease-in-out infinite; animation-delay: 2s; opacity: 0.25;">üç∞</span>
                <span style="position: absolute; right: 12%; bottom: 25%; font-size: 2.2em; animation: floatMath 6s ease-in-out infinite; animation-delay: 0.5s; opacity: 0.25;">üéÇ</span>
            </div>
            
            <div style="text-align: center; margin-top: 30px; position: relative; z-index: 1;">
                <div style="font-size: 5em; animation: rotate3d 4s infinite, glow 2s infinite alternate;">üçï</div>
                <h2 class="session-title-gradient" style="background: linear-gradient(135deg, #FF6B35, #F7931E, #FFD700); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 2.8em;">Sesi√≥n 4: Fracciones (I)</h2>
                <p style="font-size: 1.4em; color: #D35400; font-weight: 600; text-shadow: 0 2px 10px rgba(211, 84, 0, 0.3);">üéØ ¬°Divide y Conquista el Mundo de las Fracciones!</p>
            </div>

            <div class="content-grid-session1" style="position: relative; z-index: 1;">
                <div class="card-session objective-card" style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); border-left: 8px solid #FF9800;">
                    <h3 style="color: #E65100;">üéØ Objetivo de Sesi√≥n</h3>
                    <p style="color: #BF360C;">Comprender el concepto de fracci√≥n como parte de un todo, identificar sus elementos (numerador y denominador), y dominar las fracciones equivalentes y la simplificaci√≥n.</p>
                </div>
                <div class="card-session learning-card" style="background: linear-gradient(135deg, #FFF8E1, #FFECB3); border-left: 8px solid #FFC107;">
                    <h3 style="color: #FF8F00;">üó∫Ô∏è Ruta de Aprendizaje</h3>
                    <ul class="learning-list">
                        <li class="learning-list-item" onclick="showScreen('session4Theory1Screen')" style="background: linear-gradient(135deg, #FFCCBC, #FFAB91);"><span>üìö</span> Teor√≠a 1: El Mundo de las Fracciones</li>
                        <li class="learning-list-item" onclick="showScreen('session4Theory2Screen')" style="background: linear-gradient(135deg, #FFE0B2, #FFCC80);"><span>üîÑ</span> Teor√≠a 2: Equivalencia y Simplificaci√≥n</li>
                        <li class="learning-list-item" onclick="showScreen('session4GameClassScreen')" style="background: linear-gradient(135deg, #C8E6C9, #A5D6A7);"><span>üé≤</span> Juego en el Aula: Pizza Fraccionaria</li>
                        <li class="learning-list-item" onclick="showScreen('session4ActivityScreen')" style="background: linear-gradient(135deg, #B3E5FC, #81D4FA);"><span>üèÜ</span> Actividad Gamificada: Conquista Fraccionaria</li>
                        <li class="learning-list-item" onclick="showScreen('session4ArcadeScreen')" style="background: linear-gradient(135deg, #E1BEE7, #CE93D8);"><span>üéÆ</span> Juego Arcade: Pr√≥ximamente...</li>
                    </ul>
                </div>
            </div>

<div class="session1-nav-grid" style="position: relative; z-index: 1;">
                <div class="session-nav-card session4-card" onclick="showScreen('session4Theory1Screen')" style="background: linear-gradient(135deg, #FF8A65, #FF7043); box-shadow: 0 10px 30px rgba(255, 112, 67, 0.4);">
                    <div class="session-nav-card-icon">üìö</div>
                    <h4>1. Teor√≠a: Concepto</h4>
                </div>
                <div class="session-nav-card session4-card" onclick="showScreen('session4Theory2Screen')" style="background: linear-gradient(135deg, #FFB74D, #FFA726); box-shadow: 0 10px 30px rgba(255, 167, 38, 0.4);">
                    <div class="session-nav-card-icon">üîÑ</div>
                    <h4>2. Equivalencia</h4>
                </div>
                <div class="session-nav-card session4-card" onclick="showScreen('session4GameClassScreen')" style="background: linear-gradient(135deg, #81C784, #66BB6A); box-shadow: 0 10px 30px rgba(102, 187, 106, 0.4);">
                    <div class="session-nav-card-icon">üé≤</div>
                    <h4>3. Juego en Aula</h4>
                </div>
                <div class="session-nav-card session4-card" onclick="showScreen('session4ActivityScreen')" style="background: linear-gradient(135deg, #4FC3F7, #29B6F6); box-shadow: 0 10px 30px rgba(41, 182, 246, 0.4);">
                    <div class="session-nav-card-icon">üèÜ</div>
                    <h4>4. Actividad</h4>
                </div>
                <div class="session-nav-card session4-card" onclick="showScreen('session4ArcadeScreen')" style="background: linear-gradient(135deg, #BA68C8, #AB47BC); box-shadow: 0 10px 30px rgba(171, 71, 188, 0.4);">
                    <div class="session-nav-card-icon">üéÆ</div>
                    <h4>5. Arcade üîí</h4>
                </div>
            </div>
        </div>
    </div>
    
<!-- ========== TEOR√çA 1: EL MUNDO DE LAS FRACCIONES ========== -->
<div class="screen" id="session4Theory1Screen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(255,138,101,0.08) 0%, rgba(255,183,77,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session4Screen')"> ‚Üê Volver a Sesi√≥n 4 </button>
        
        <!-- Encabezado con animaciones -->
        <div style="position: relative; text-align: center; margin-bottom: 40px;">
            <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                <span class="math-symbol" style="position: absolute; left: 8%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">üçï</span>
                <span class="math-symbol" style="position: absolute; left: 88%; top: 25%; font-size: 2.2em; animation: floatMath 7s ease-in-out infinite; animation-delay: 0.5s;">ü•ß</span>
                <span class="math-symbol" style="position: absolute; left: 12%; top: 60%; font-size: 2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s;">üç∞</span>
                <span class="math-symbol" style="position: absolute; left: 85%; top: 65%; font-size: 2.3em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 1.5s;">üßÄ</span>
            </div>
            <h2 style="position: relative; z-index: 1; color: #E65100; font-size: 2.5em; text-shadow: 0 3px 15px rgba(230, 81, 0, 0.3);">üìö El Mundo de las Fracciones</h2>
            <p style="font-size: 1.3em; color: #FF8F00; font-weight: 500;">¬°Descubre c√≥mo dividir el mundo en partes iguales!</p>
        </div>

        <!-- INTRODUCCI√ìN ENGANCHADORA -->
        <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 35px; border-radius: 25px; margin: 30px 0; border: 4px solid #FF9800; box-shadow: 0 15px 40px rgba(255, 152, 0, 0.3); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -20px; right: -20px; font-size: 8em; opacity: 0.1; transform: rotate(15deg);">üçï</div>
            <h3 style="color: #E65100; font-size: 1.8em; margin-bottom: 20px;">ü§î ¬øAlguna vez has compartido una pizza?</h3>
            <p style="font-size: 1.25em; line-height: 1.9; color: #BF360C;">
                Imagina esto: est√°s con 3 amigos y piden una pizza. El repartidor la corta en <strong>8 pedazos iguales</strong>. 
                Si t√∫ te comes <strong>2 pedazos</strong>, ¬øqu√© parte de la pizza comiste?
            </p>
            <p style="font-size: 1.25em; line-height: 1.9; color: #BF360C; margin-top: 15px;">
                La respuesta es: comiste <strong style="font-size: 1.4em; color: #D84315;">2/8</strong> de la pizza (que tambi√©n es <strong>1/4</strong> o "un cuarto"). 
                ¬°Eso es una <strong>FRACCI√ìN</strong>! üéâ
            </p>
        </div>

        <!-- DEFINICI√ìN FORMAL CON ESTILO -->
        <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 40px; border-radius: 25px; margin: 35px 0; border-left: 10px solid #1976D2; box-shadow: 0 15px 40px rgba(25, 118, 210, 0.25);">
            <h3 style="color: #0D47A1; font-size: 2em; margin-bottom: 25px; text-align: center;">üìñ ¬øQu√© es una Fracci√≥n?</h3>
            <p style="font-size: 1.3em; line-height: 2; color: #1565C0; text-align: center;">
                Una <strong>fracci√≥n</strong> es una forma de representar <strong>partes iguales de un todo</strong>.
            </p>
            <p style="font-size: 1.2em; line-height: 1.9; color: #1976D2; margin-top: 20px;">
                Cuando no podemos expresar una cantidad con un n√∫mero entero (1, 2, 3...), usamos fracciones. 
                Por ejemplo, si tienes media manzana, no puedes decir "tengo 1 manzana" ni "tengo 0 manzanas". 
                Dices: <strong>"tengo 1/2 manzana"</strong> (la mitad).
            </p>
            <div style="background: rgba(255,255,255,0.7); padding: 25px; border-radius: 15px; margin-top: 25px; text-align: center;">
                <p style="font-size: 1.15em; color: #0D47A1; font-weight: 600; margin: 0;">
                    üí° <strong>Concepto Clave:</strong> Una fracci√≥n divide algo en partes <u>IGUALES</u>. 
                    Si las partes no son iguales, ¬°no es una fracci√≥n v√°lida!
                </p>
            </div>
        </div>

        <!-- LAS PARTES DE UNA FRACCI√ìN - VISUAL GRANDE -->
        <h3 style="color: #6A1B9A; font-size: 2.2em; text-align: center; margin: 50px 0 30px 0;">üîç Las Partes de una Fracci√≥n</h3>
        
        <div style="background: linear-gradient(135deg, #F3E5F5, #E1BEE7); padding: 45px; border-radius: 30px; margin: 30px 0; border: 5px solid #9C27B0; box-shadow: 0 20px 50px rgba(156, 39, 176, 0.3);">
            
            <!-- Representaci√≥n visual grande de la fracci√≥n -->
            <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 40px;">
                <div style="background: white; padding: 40px 60px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); text-align: center;">
                    <div style="font-size: 5em; font-weight: 900; color: #7B1FA2; line-height: 1;">
                        <span id="fraction-num-display" style="display: block; border-bottom: 8px solid #9C27B0; padding-bottom: 15px;">3</span>
                        <span id="fraction-den-display" style="display: block; padding-top: 15px;">4</span>
                    </div>
                </div>
            </div>
            
            <!-- Explicaci√≥n del numerador -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
                <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 30px; border-radius: 20px; border-left: 8px solid #4CAF50; box-shadow: 0 8px 25px rgba(76, 175, 80, 0.25);">
                    <h4 style="color: #2E7D32; font-size: 1.6em; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span style="background: #4CAF50; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em;">‚Üë</span>
                        NUMERADOR
                    </h4>
                    <p style="font-size: 1.2em; line-height: 1.8; color: #1B5E20;">
                        Es el n√∫mero de <strong>ARRIBA</strong>. Indica <strong>cu√°ntas partes TOMAMOS</strong> o seleccionamos del total.
                    </p>
                    <div style="background: rgba(255,255,255,0.8); padding: 15px; border-radius: 10px; margin-top: 15px;">
                        <p style="color: #2E7D32; font-weight: 600; margin: 0; font-size: 1.1em;">
                            üìå En <sup>3</sup>/<sub>4</sub> ‚Üí El <strong>3</strong> significa que tomamos 3 partes
                        </p>
                    </div>
                </div>
                
                <div style="background: linear-gradient(135deg, #FFEBEE, #FFCDD2); padding: 30px; border-radius: 20px; border-left: 8px solid #F44336; box-shadow: 0 8px 25px rgba(244, 67, 54, 0.25);">
                    <h4 style="color: #C62828; font-size: 1.6em; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span style="background: #F44336; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em;">‚Üì</span>
                        DENOMINADOR
                    </h4>
                    <p style="font-size: 1.2em; line-height: 1.8; color: #B71C1C;">
                        Es el n√∫mero de <strong>ABAJO</strong>. Indica en <strong>cu√°ntas partes IGUALES</strong> se divide el todo.
                    </p>
                    <div style="background: rgba(255,255,255,0.8); padding: 15px; border-radius: 10px; margin-top: 15px;">
                        <p style="color: #C62828; font-weight: 600; margin: 0; font-size: 1.1em;">
                            üìå En <sup>3</sup>/<sub>4</sub> ‚Üí El <strong>4</strong> significa que el total tiene 4 partes
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Regla mnemot√©cnica -->
            <div style="background: linear-gradient(135deg, #FFF9C4, #FFF59D); padding: 25px; border-radius: 15px; margin-top: 30px; border: 3px solid #FBC02D; text-align: center;">
                <p style="font-size: 1.3em; color: #F57F17; font-weight: 700; margin: 0;">
                    üß† <strong>Truco para Recordar:</strong> "<u>D</u>enominador = <u>D</u>ivide" (est√° abajo, divide el todo)
                </p>
            </div>
        </div>

        <!-- EJEMPLOS VISUALES CON PIZZAS -->
        <h3 style="color: #D84315; font-size: 2em; text-align: center; margin: 50px 0 30px 0;">üçï Ejemplos Visuales: ¬°Fracciones de Pizza!</h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin: 30px 0;">
            
            <!-- Ejemplo 1/2 -->
            <div style="background: linear-gradient(135deg, #FFCCBC, #FFAB91); padding: 30px; border-radius: 20px; text-align: center; box-shadow: 0 10px 30px rgba(255, 87, 34, 0.3); transition: transform 0.3s;" onmouseover="this.style.transform='translateY(-10px)'" onmouseout="this.style.transform='translateY(0)'">
                <div style="font-size: 4em; margin-bottom: 15px;">üçï</div>
                <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 15px;">
                    <span style="font-size: 3em; font-weight: 900; color: #BF360C;">¬Ω</span>
                </div>
                <p style="font-size: 1.2em; color: #4E342E; font-weight: 600;">UN MEDIO</p>
                <p style="font-size: 1.1em; color: #5D4037; line-height: 1.6;">La pizza se divide en <strong>2 partes</strong> iguales y tomas <strong>1 parte</strong>.</p>
                <div style="display: flex; justify-content: center; gap: 10px; margin-top: 15px;">
                    <div style="width: 60px; height: 60px; background: #FF5722; border-radius: 50% 50% 0 0; border: 3px solid #BF360C;"></div>
                    <div style="width: 60px; height: 60px; background: #FFCCBC; border-radius: 50% 50% 0 0; border: 3px solid #BF360C; opacity: 0.5;"></div>
                </div>
            </div>
            
            <!-- Ejemplo 1/4 -->
            <div style="background: linear-gradient(135deg, #C8E6C9, #A5D6A7); padding: 30px; border-radius: 20px; text-align: center; box-shadow: 0 10px 30px rgba(76, 175, 80, 0.3); transition: transform 0.3s;" onmouseover="this.style.transform='translateY(-10px)'" onmouseout="this.style.transform='translateY(0)'">
                <div style="font-size: 4em; margin-bottom: 15px;">ü•ß</div>
                <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 15px;">
                    <span style="font-size: 3em; font-weight: 900; color: #2E7D32;">¬º</span>
                </div>
                <p style="font-size: 1.2em; color: #1B5E20; font-weight: 600;">UN CUARTO</p>
                <p style="font-size: 1.1em; color: #33691E; line-height: 1.6;">El pastel se divide en <strong>4 partes</strong> iguales y tomas <strong>1 parte</strong>.</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; width: 80px; margin: 15px auto 0;">
                    <div style="width: 35px; height: 35px; background: #4CAF50; border-radius: 50% 0 0 0; border: 2px solid #2E7D32;"></div>
                    <div style="width: 35px; height: 35px; background: #C8E6C9; border-radius: 0 50% 0 0; border: 2px solid #2E7D32; opacity: 0.5;"></div>
                    <div style="width: 35px; height: 35px; background: #C8E6C9; border-radius: 0 0 0 50%; border: 2px solid #2E7D32; opacity: 0.5;"></div>
                    <div style="width: 35px; height: 35px; background: #C8E6C9; border-radius: 0 0 50% 0; border: 2px solid #2E7D32; opacity: 0.5;"></div>
                </div>
            </div>
            
            <!-- Ejemplo 3/4 -->
            <div style="background: linear-gradient(135deg, #B3E5FC, #81D4FA); padding: 30px; border-radius: 20px; text-align: center; box-shadow: 0 10px 30px rgba(3, 169, 244, 0.3); transition: transform 0.3s;" onmouseover="this.style.transform='translateY(-10px)'" onmouseout="this.style.transform='translateY(0)'">
                <div style="font-size: 4em; margin-bottom: 15px;">üç∞</div>
                <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 15px;">
                    <span style="font-size: 3em; font-weight: 900; color: #0277BD;">¬æ</span>
                </div>
                <p style="font-size: 1.2em; color: #01579B; font-weight: 600;">TRES CUARTOS</p>
                <p style="font-size: 1.1em; color: #0288D1; line-height: 1.6;">La torta se divide en <strong>4 partes</strong> iguales y tomas <strong>3 partes</strong>.</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; width: 80px; margin: 15px auto 0;">
                    <div style="width: 35px; height: 35px; background: #03A9F4; border-radius: 50% 0 0 0; border: 2px solid #0277BD;"></div>
                    <div style="width: 35px; height: 35px; background: #03A9F4; border-radius: 0 50% 0 0; border: 2px solid #0277BD;"></div>
                    <div style="width: 35px; height: 35px; background: #03A9F4; border-radius: 0 0 0 50%; border: 2px solid #0277BD;"></div>
                    <div style="width: 35px; height: 35px; background: #B3E5FC; border-radius: 0 0 50% 0; border: 2px solid #0277BD; opacity: 0.5;"></div>
                </div>
            </div>
        </div>

        <!-- EJEMPLOS DE LA VIDA REAL -->
        <h3 style="color: #00695C; font-size: 2em; text-align: center; margin: 50px 0 30px 0;">üåç Fracciones en tu Vida Diaria</h3>
        
        <div style="background: linear-gradient(135deg, #E0F2F1, #B2DFDB); padding: 40px; border-radius: 25px; margin: 30px 0; border: 4px solid #00897B; box-shadow: 0 15px 40px rgba(0, 137, 123, 0.25);">
            <p style="font-size: 1.2em; color: #004D40; line-height: 1.8; margin-bottom: 25px;">
                Las fracciones no son solo n√∫meros en un libro. ¬°Las usas todos los d√≠as sin darte cuenta! Aqu√≠ hay ejemplos:
            </p>
            
            <div style="display: grid; gap: 20px;">
                <div style="background: white; padding: 25px; border-radius: 15px; border-left: 6px solid #26A69A; display: flex; align-items: center; gap: 20px; transition: transform 0.3s;" onmouseover="this.style.transform='translateX(10px)'" onmouseout="this.style.transform='translateX(0)'">
                    <span style="font-size: 3em;">‚è∞</span>
                    <div>
                        <p style="color: #00695C; font-size: 1.2em; font-weight: 700; margin: 0 0 8px 0;">El Tiempo</p>
                        <p style="color: #00796B; font-size: 1.1em; margin: 0; line-height: 1.6;">"Faltan <strong>15 minutos</strong> para la hora" = Falta <strong>¬º</strong> de hora (porque 15 es la cuarta parte de 60)</p>
                    </div>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 15px; border-left: 6px solid #26A69A; display: flex; align-items: center; gap: 20px; transition: transform 0.3s;" onmouseover="this.style.transform='translateX(10px)'" onmouseout="this.style.transform='translateX(0)'">
                    <span style="font-size: 3em;">üì±</span>
                    <div>
                        <p style="color: #00695C; font-size: 1.2em; font-weight: 700; margin: 0 0 8px 0;">La Bater√≠a del Celular</p>
                        <p style="color: #00796B; font-size: 1.1em; margin: 0; line-height: 1.6;">"Me queda <strong>media bater√≠a</strong>" = Tienes <strong>¬Ω</strong> (50%) de carga</p>
                    </div>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 15px; border-left: 6px solid #26A69A; display: flex; align-items: center; gap: 20px; transition: transform 0.3s;" onmouseover="this.style.transform='translateX(10px)'" onmouseout="this.style.transform='translateX(0)'">
                    <span style="font-size: 3em;">üéµ</span>
                    <div>
                        <p style="color: #00695C; font-size: 1.2em; font-weight: 700; margin: 0 0 8px 0;">La M√∫sica</p>
                        <p style="color: #00796B; font-size: 1.1em; margin: 0; line-height: 1.6;">Las notas musicales usan fracciones: negra (¬º), blanca (¬Ω), corchea (‚Öõ)</p>
                    </div>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 15px; border-left: 6px solid #26A69A; display: flex; align-items: center; gap: 20px; transition: transform 0.3s;" onmouseover="this.style.transform='translateX(10px)'" onmouseout="this.style.transform='translateX(0)'">
                    <span style="font-size: 3em;">üè™</span>
                    <div>
                        <p style="color: #00695C; font-size: 1.2em; font-weight: 700; margin: 0 0 8px 0;">Las Compras</p>
                        <p style="color: #00796B; font-size: 1.1em; margin: 0; line-height: 1.6;">"Quiero <strong>medio kilo</strong> de queso" = <strong>¬Ω</strong> kg = 500 gramos</p>
                    </div>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 15px; border-left: 6px solid #26A69A; display: flex; align-items: center; gap: 20px; transition: transform 0.3s;" onmouseover="this.style.transform='translateX(10px)'" onmouseout="this.style.transform='translateX(0)'">
                    <span style="font-size: 3em;">‚öΩ</span>
                    <div>
                        <p style="color: #00695C; font-size: 1.2em; font-weight: 700; margin: 0 0 8px 0;">Los Deportes</p>
                        <p style="color: #00796B; font-size: 1.1em; margin: 0; line-height: 1.6;">"Vamos en el <strong>primer tiempo</strong>" = Llevamos <strong>¬Ω</strong> del partido</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- MINI-ACTIVIDAD INTERACTIVA 1 -->
        <div style="background: linear-gradient(135deg, #FCE4EC, #F8BBD9); padding: 40px; border-radius: 25px; margin: 40px 0; border: 5px solid #E91E63; box-shadow: 0 15px 40px rgba(233, 30, 99, 0.3);">
            <h3 style="color: #880E4F; font-size: 1.8em; text-align: center; margin-bottom: 25px;">üéÆ ¬°Mini-Reto R√°pido!</h3>
            <p style="font-size: 1.2em; color: #AD1457; text-align: center; margin-bottom: 30px;">
                Haz clic en la respuesta correcta para cada pregunta:
            </p>
            
            <div id="miniQuiz1" style="display: grid; gap: 25px;">
                <!-- Pregunta 1 -->
                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <p style="font-size: 1.2em; color: #880E4F; font-weight: 600; margin-bottom: 15px;">
                        1Ô∏è‚É£ En la fracci√≥n <sup>5</sup>/<sub>8</sub>, ¬øcu√°l es el NUMERADOR?
                    </p>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button onclick="checkMiniAnswer(this, false)" style="padding: 15px 30px; font-size: 1.3em; border: 3px solid #E91E63; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 700;">8</button>
                        <button onclick="checkMiniAnswer(this, true)" style="padding: 15px 30px; font-size: 1.3em; border: 3px solid #E91E63; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 700;">5</button>
                        <button onclick="checkMiniAnswer(this, false)" style="padding: 15px 30px; font-size: 1.3em; border: 3px solid #E91E63; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 700;">13</button>
                    </div>
                </div>
                
                <!-- Pregunta 2 -->
                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <p style="font-size: 1.2em; color: #880E4F; font-weight: 600; margin-bottom: 15px;">
                        2Ô∏è‚É£ Si una pizza tiene 6 pedazos y te comes 2, ¬øqu√© fracci√≥n comiste?
                    </p>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button onclick="checkMiniAnswer(this, false)" style="padding: 15px 30px; font-size: 1.3em; border: 3px solid #E91E63; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 700;">6/2</button>
                        <button onclick="checkMiniAnswer(this, true)" style="padding: 15px 30px; font-size: 1.3em; border: 3px solid #E91E63; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 700;">2/6</button>
                        <button onclick="checkMiniAnswer(this, false)" style="padding: 15px 30px; font-size: 1.3em; border: 3px solid #E91E63; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 700;">2/4</button>
                    </div>
                </div>
                
                <!-- Pregunta 3 -->
                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <p style="font-size: 1.2em; color: #880E4F; font-weight: 600; margin-bottom: 15px;">
                        3Ô∏è‚É£ ¬øQu√© indica el DENOMINADOR?
                    </p>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button onclick="checkMiniAnswer(this, false)" style="padding: 12px 20px; font-size: 1.1em; border: 3px solid #E91E63; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s;">Las partes que tomo</button>
                        <button onclick="checkMiniAnswer(this, true)" style="padding: 12px 20px; font-size: 1.1em; border: 3px solid #E91E63; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s;">Las partes totales</button>
                        <button onclick="checkMiniAnswer(this, false)" style="padding: 12px 20px; font-size: 1.1em; border: 3px solid #E91E63; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s;">El resultado</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TIPOS DE FRACCIONES -->
        <h3 style="color: #4527A0; font-size: 2em; text-align: center; margin: 50px 0 30px 0;">üìä Tipos de Fracciones</h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin: 30px 0;">
            
            <!-- Fracci√≥n Propia -->
            <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 30px; border-radius: 20px; border: 4px solid #4CAF50; box-shadow: 0 10px 30px rgba(76, 175, 80, 0.3);">
                <div style="text-align: center; margin-bottom: 20px;">
                    <span style="background: #4CAF50; color: white; padding: 10px 25px; border-radius: 25px; font-size: 1.3em; font-weight: 700;">PROPIA</span>
                </div>
                <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px;">
                    <span style="font-size: 3em; font-weight: 900; color: #2E7D32;">
                        <sup>2</sup>/<sub>5</sub>
                    </span>
                </div>
                <p style="font-size: 1.15em; color: #1B5E20; line-height: 1.8; text-align: center;">
                    El numerador es <strong>MENOR</strong> que el denominador.<br>
                    <span style="font-size: 1.3em;">2 < 5</span><br>
                    <em>Representa menos de un entero</em>
                </p>
            </div>
            
            <!-- Fracci√≥n Impropia -->
            <div style="background: linear-gradient(135deg, #FFEBEE, #FFCDD2); padding: 30px; border-radius: 20px; border: 4px solid #F44336; box-shadow: 0 10px 30px rgba(244, 67, 54, 0.3);">
                <div style="text-align: center; margin-bottom: 20px;">
                    <span style="background: #F44336; color: white; padding: 10px 25px; border-radius: 25px; font-size: 1.3em; font-weight: 700;">IMPROPIA</span>
                </div>
                <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px;">
                    <span style="font-size: 3em; font-weight: 900; color: #C62828;">
                        <sup>7</sup>/<sub>4</sub>
                    </span>
                </div>
                <p style="font-size: 1.15em; color: #B71C1C; line-height: 1.8; text-align: center;">
                    El numerador es <strong>MAYOR</strong> que el denominador.<br>
                    <span style="font-size: 1.3em;">7 > 4</span><br>
                    <em>Representa m√°s de un entero</em>
                </p>
            </div>
            
            <!-- N√∫mero Mixto -->
            <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 30px; border-radius: 20px; border: 4px solid #2196F3; box-shadow: 0 10px 30px rgba(33, 150, 243, 0.3);">
                <div style="text-align: center; margin-bottom: 20px;">
                    <span style="background: #2196F3; color: white; padding: 10px 25px; border-radius: 25px; font-size: 1.3em; font-weight: 700;">MIXTO</span>
                </div>
                <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px;">
                    <span style="font-size: 3em; font-weight: 900; color: #1565C0;">
                        1 <sup>3</sup>/<sub>4</sub>
                    </span>
                </div>
                <p style="font-size: 1.15em; color: #0D47A1; line-height: 1.8; text-align: center;">
                    Combina un n√∫mero <strong>ENTERO</strong> con una fracci√≥n propia.<br>
                    <span style="font-size: 1.1em;"><sup>7</sup>/<sub>4</sub> = 1 <sup>3</sup>/<sub>4</sub></span><br>
                    <em>"Un entero y tres cuartos"</em>
                </p>
            </div>
        </div>

        <!-- DATO HIST√ìRICO CURIOSO -->
        <div style="background: linear-gradient(135deg, #FFF8E1, #FFECB3); padding: 35px; border-radius: 25px; margin: 40px 0; border: 4px solid #FFB300; box-shadow: 0 15px 40px rgba(255, 179, 0, 0.3); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -30px; right: -30px; font-size: 10em; opacity: 0.1;">üìú</div>
            <h3 style="color: #FF8F00; font-size: 1.8em; margin-bottom: 20px;">üìñ ¬øSab√≠as que...?</h3>
            <p style="font-size: 1.2em; line-height: 1.9; color: #E65100;">
                Los <strong>antiguos egipcios</strong> (hace m√°s de 4000 a√±os) fueron los primeros en usar fracciones. 
                Pero ten√≠an una regla curiosa: ¬°solo usaban fracciones con numerador 1! 
                Por ejemplo, en lugar de escribir <sup>2</sup>/<sub>5</sub>, escrib√≠an <sup>1</sup>/<sub>3</sub> + <sup>1</sup>/<sub>15</sub>.
            </p>
            <p style="font-size: 1.15em; line-height: 1.9; color: #F57C00; margin-top: 15px;">
                üèõÔ∏è La palabra "<strong>fracci√≥n</strong>" viene del lat√≠n "<em>fractio</em>" que significa "<strong>romper</strong>" o "<strong>partir</strong>". 
                ¬°Literalmente estamos "rompiendo" un entero en pedazos!
            </p>
        </div>

        <!-- TIEMPO Y BOT√ìN DE CONTINUAR -->
        <p style="margin-top: 35px; font-size: 1.15em; color: #E65100; text-align: center;">
            ‚è±Ô∏è Tiempo Sugerido: <strong>20-25 min</strong> (Teor√≠a + Mini-retos)
        </p>

        <div style="text-align: center; margin-top: 40px;">
            <button class="back-button" onclick="completeSubActivity(4, 1); showScreen('session4Theory2Screen');" style="background: linear-gradient(135deg, #FF9800, #F57C00); font-size: 1.4em; padding: 20px 50px; box-shadow: 0 10px 30px rgba(255, 152, 0, 0.5);">
                ¬°Continuar a Equivalencia y Simplificaci√≥n! ‚Üí
            </button>
        </div>
    </div>
</div>


<!-- ========== TEOR√çA 2: EQUIVALENCIA Y SIMPLIFICACI√ìN ========== -->
<div class="screen" id="session4Theory2Screen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(156,39,176,0.05) 0%, rgba(103,58,183,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session4Screen')"> ‚Üê Volver a Sesi√≥n 4 </button>
        
        <!-- Encabezado animado -->
        <div style="position: relative; text-align: center; margin-bottom: 40px;">
            <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                <span class="math-symbol" style="position: absolute; left: 8%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">‚öñÔ∏è</span>
                <span class="math-symbol" style="position: absolute; left: 88%; top: 25%; font-size: 2.2em; animation: floatMath 7s ease-in-out infinite; animation-delay: 0.5s;">üîÑ</span>
                <span class="math-symbol" style="position: absolute; left: 12%; top: 60%; font-size: 2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s;">‚úÇÔ∏è</span>
                <span class="math-symbol" style="position: absolute; left: 85%; top: 65%; font-size: 2.3em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 1.5s;">üéØ</span>
            </div>
            <h2 style="position: relative; z-index: 1; color: #6A1B9A; font-size: 2.5em; text-shadow: 0 3px 15px rgba(106, 27, 154, 0.3);">üîÑ Equivalencia y Simplificaci√≥n</h2>
            <p style="font-size: 1.3em; color: #8E24AA; font-weight: 500;">¬°Descubre el secreto de las fracciones gemelas!</p>
        </div>

        <!-- INTRODUCCI√ìN CON HISTORIA -->
        <div style="background: linear-gradient(135deg, #F3E5F5, #E1BEE7); padding: 35px; border-radius: 25px; margin: 30px 0; border: 4px solid #9C27B0; box-shadow: 0 15px 40px rgba(156, 39, 176, 0.25); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -20px; right: -20px; font-size: 8em; opacity: 0.1; transform: rotate(15deg);">‚öñÔ∏è</div>
            <h3 style="color: #6A1B9A; font-size: 1.8em; margin-bottom: 20px;">ü§î ¬øAlguna vez has notado algo curioso?</h3>
            <p style="font-size: 1.25em; line-height: 1.9; color: #4A148C;">
                Si comes <strong>2 de 4 pedazos</strong> de pizza, comiste la <strong>mitad</strong>. 
                Pero si comes <strong>4 de 8 pedazos</strong>... ¬°tambi√©n comiste la <strong>mitad</strong>! üçï
            </p>
            <p style="font-size: 1.25em; line-height: 1.9; color: #4A148C; margin-top: 15px;">
                Esto significa que <strong style="font-size: 1.4em; color: #7B1FA2;"><sup>2</sup>/<sub>4</sub> = <sup>4</sup>/<sub>8</sub> = <sup>1</sup>/<sub>2</sub></strong>
            </p>
            <p style="font-size: 1.2em; line-height: 1.9; color: #6A1B9A; margin-top: 15px; font-weight: 600;">
                ¬°Son <strong>FRACCIONES EQUIVALENTES</strong>! Diferentes n√∫meros, pero el mismo valor. üéâ
            </p>
        </div>

        <!-- DEFINICI√ìN DE FRACCIONES EQUIVALENTES -->
        <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 40px; border-radius: 25px; margin: 35px 0; border-left: 10px solid #4CAF50; box-shadow: 0 15px 40px rgba(76, 175, 80, 0.25);">
            <h3 style="color: #2E7D32; font-size: 2em; margin-bottom: 25px; text-align: center;">üìñ ¬øQu√© son las Fracciones Equivalentes?</h3>
            <p style="font-size: 1.3em; line-height: 2; color: #1B5E20; text-align: center;">
                Son fracciones que <strong>representan la misma cantidad</strong>, aunque tengan n√∫meros diferentes.
            </p>
            <div style="background: rgba(255,255,255,0.8); padding: 25px; border-radius: 15px; margin-top: 25px; text-align: center;">
                <p style="font-size: 1.2em; color: #2E7D32; font-weight: 600; margin: 0;">
                    üí° <strong>Analog√≠a:</strong> Es como decir "media hora" o "30 minutos". 
                    <br>¬°Son lo mismo expresado de forma diferente!
                </p>
            </div>
        </div>

        <!-- DEMOSTRACI√ìN VISUAL GRANDE -->
        <h3 style="color: #1565C0; font-size: 2em; text-align: center; margin: 50px 0 30px 0;">üëÄ ¬°M√≠ralo con tus propios ojos!</h3>
        
        <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 40px; border-radius: 25px; margin: 30px 0; border: 4px solid #2196F3; box-shadow: 0 15px 40px rgba(33, 150, 243, 0.25);">
            <p style="font-size: 1.2em; color: #0D47A1; text-align: center; margin-bottom: 30px;">
                Observa c√≥mo estas tres barras representan <strong>LA MISMA CANTIDAD</strong> (la mitad sombreada):
            </p>
            
            <div style="display: grid; gap: 30px; max-width: 600px; margin: 0 auto;">
                <!-- Barra 1/2 -->
                <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <span style="font-size: 2.5em; font-weight: 900; color: #1565C0; min-width: 80px;"><sup>1</sup>/<sub>2</sub></span>
                        <div style="flex: 1; display: flex; height: 50px; border-radius: 10px; overflow: hidden; border: 3px solid #1565C0;">
                            <div style="flex: 1; background: linear-gradient(135deg, #2196F3, #1976D2);"></div>
                            <div style="flex: 1; background: #E3F2FD;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Barra 2/4 -->
                <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <span style="font-size: 2.5em; font-weight: 900; color: #1565C0; min-width: 80px;"><sup>2</sup>/<sub>4</sub></span>
                        <div style="flex: 1; display: flex; height: 50px; border-radius: 10px; overflow: hidden; border: 3px solid #1565C0;">
                            <div style="flex: 1; background: linear-gradient(135deg, #2196F3, #1976D2);"></div>
                            <div style="flex: 1; background: linear-gradient(135deg, #2196F3, #1976D2);"></div>
                            <div style="flex: 1; background: #E3F2FD;"></div>
                            <div style="flex: 1; background: #E3F2FD;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Barra 4/8 -->
                <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <span style="font-size: 2.5em; font-weight: 900; color: #1565C0; min-width: 80px;"><sup>4</sup>/<sub>8</sub></span>
                        <div style="flex: 1; display: flex; height: 50px; border-radius: 10px; overflow: hidden; border: 3px solid #1565C0;">
                            <div style="flex: 1; background: linear-gradient(135deg, #2196F3, #1976D2);"></div>
                            <div style="flex: 1; background: linear-gradient(135deg, #2196F3, #1976D2);"></div>
                            <div style="flex: 1; background: linear-gradient(135deg, #2196F3, #1976D2);"></div>
                            <div style="flex: 1; background: linear-gradient(135deg, #2196F3, #1976D2);"></div>
                            <div style="flex: 1; background: #E3F2FD;"></div>
                            <div style="flex: 1; background: #E3F2FD;"></div>
                            <div style="flex: 1; background: #E3F2FD;"></div>
                            <div style="flex: 1; background: #E3F2FD;"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="background: #FFF9C4; padding: 20px; border-radius: 15px; margin-top: 30px; border: 3px solid #FBC02D; text-align: center;">
                <p style="font-size: 1.3em; color: #F57F17; font-weight: 700; margin: 0;">
                    ‚öñÔ∏è ¬°Las tres barras tienen <strong>exactamente la misma parte sombreada</strong>!
                </p>
            </div>
        </div>

        <!-- C√ìMO ENCONTRAR FRACCIONES EQUIVALENTES -->
        <h3 style="color: #D84315; font-size: 2.2em; text-align: center; margin: 50px 0 30px 0;">üîß ¬øC√≥mo encontrar Fracciones Equivalentes?</h3>
        
        <p style="font-size: 1.25em; color: #5D4037; text-align: center; margin-bottom: 30px; line-height: 1.8;">
            Hay dos m√©todos m√°gicos: <strong>AMPLIFICAR</strong> (hacer m√°s grande) y <strong>SIMPLIFICAR</strong> (hacer m√°s peque√±o)
        </p>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; margin: 30px 0;">
            
            <!-- AMPLIFICAR -->
            <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 35px; border-radius: 25px; border: 5px solid #4CAF50; box-shadow: 0 15px 40px rgba(76, 175, 80, 0.3);">
                <div style="text-align: center; margin-bottom: 25px;">
                    <span style="font-size: 3em;">üìà</span>
                    <h4 style="color: #2E7D32; font-size: 1.8em; margin: 10px 0;">AMPLIFICAR</h4>
                    <p style="color: #388E3C; font-size: 1.1em;">(Multiplicar arriba y abajo por el MISMO n√∫mero)</p>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                    <p style="font-size: 1.15em; color: #1B5E20; line-height: 1.8; margin-bottom: 15px;">
                        <strong>Regla:</strong> Si multiplicas el numerador Y el denominador por el mismo n√∫mero, ¬°la fracci√≥n vale lo mismo!
                    </p>
                </div>
                
                <div style="background: #F1F8E9; padding: 25px; border-radius: 15px; text-align: center;">
                    <p style="font-size: 1.2em; color: #33691E; margin-bottom: 15px;"><strong>Ejemplo:</strong></p>
                    <div style="font-size: 1.8em; color: #2E7D32; font-weight: 700;">
                        <sup>2</sup>/<sub>3</sub> 
                        <span style="color: #4CAF50; margin: 0 10px;">√ó</span> 
                        <sup style="background: #FFEB3B; padding: 3px 8px; border-radius: 5px;">2</sup>/<sub style="background: #FFEB3B; padding: 3px 8px; border-radius: 5px;">2</sub>
                        <span style="color: #4CAF50; margin: 0 10px;">=</span>
                        <sup>4</sup>/<sub>6</sub>
                    </div>
                    <p style="font-size: 1.1em; color: #558B2F; margin-top: 15px;">
                        ‚úÖ <sup>2</sup>/<sub>3</sub> y <sup>4</sup>/<sub>6</sub> son equivalentes
                    </p>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 15px; margin-top: 20px;">
                    <p style="font-size: 1.1em; color: #2E7D32; line-height: 1.8;">
                        <strong>M√°s ejemplos:</strong><br>
                        ‚Ä¢ <sup>1</sup>/<sub>4</sub> √ó <sup>3</sup>/<sub>3</sub> = <sup>3</sup>/<sub>12</sub><br>
                        ‚Ä¢ <sup>3</sup>/<sub>5</sub> √ó <sup>4</sup>/<sub>4</sub> = <sup>12</sup>/<sub>20</sub><br>
                        ‚Ä¢ <sup>1</sup>/<sub>2</sub> √ó <sup>5</sup>/<sub>5</sub> = <sup>5</sup>/<sub>10</sub>
                    </p>
                </div>
            </div>
            
            <!-- SIMPLIFICAR -->
            <div style="background: linear-gradient(135deg, #FFEBEE, #FFCDD2); padding: 35px; border-radius: 25px; border: 5px solid #F44336; box-shadow: 0 15px 40px rgba(244, 67, 54, 0.3);">
                <div style="text-align: center; margin-bottom: 25px;">
                    <span style="font-size: 3em;">üìâ</span>
                    <h4 style="color: #C62828; font-size: 1.8em; margin: 10px 0;">SIMPLIFICAR</h4>
                    <p style="color: #D32F2F; font-size: 1.1em;">(Dividir arriba y abajo por el MISMO n√∫mero)</p>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                    <p style="font-size: 1.15em; color: #B71C1C; line-height: 1.8; margin-bottom: 15px;">
                        <strong>Regla:</strong> Si divides el numerador Y el denominador por el mismo n√∫mero, ¬°la fracci√≥n vale lo mismo!
                    </p>
                </div>
                
                <div style="background: #FFEBEE; padding: 25px; border-radius: 15px; text-align: center;">
                    <p style="font-size: 1.2em; color: #C62828; margin-bottom: 15px;"><strong>Ejemplo:</strong></p>
                    <div style="font-size: 1.8em; color: #C62828; font-weight: 700;">
                        <sup>6</sup>/<sub>8</sub> 
                        <span style="color: #F44336; margin: 0 10px;">√∑</span> 
                        <sup style="background: #FFEB3B; padding: 3px 8px; border-radius: 5px;">2</sup>/<sub style="background: #FFEB3B; padding: 3px 8px; border-radius: 5px;">2</sub>
                        <span style="color: #F44336; margin: 0 10px;">=</span>
                        <sup>3</sup>/<sub>4</sub>
                    </div>
                    <p style="font-size: 1.1em; color: #D32F2F; margin-top: 15px;">
                        ‚úÖ <sup>6</sup>/<sub>8</sub> y <sup>3</sup>/<sub>4</sub> son equivalentes
                    </p>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 15px; margin-top: 20px;">
                    <p style="font-size: 1.1em; color: #C62828; line-height: 1.8;">
                        <strong>M√°s ejemplos:</strong><br>
                        ‚Ä¢ <sup>4</sup>/<sub>8</sub> √∑ <sup>4</sup>/<sub>4</sub> = <sup>1</sup>/<sub>2</sub><br>
                        ‚Ä¢ <sup>9</sup>/<sub>12</sub> √∑ <sup>3</sup>/<sub>3</sub> = <sup>3</sup>/<sub>4</sub><br>
                        ‚Ä¢ <sup>10</sup>/<sub>15</sub> √∑ <sup>5</sup>/<sub>5</sub> = <sup>2</sup>/<sub>3</sub>
                    </p>
                </div>
            </div>
        </div>

        <!-- REGLA DE ORO -->
        <div style="background: linear-gradient(135deg, #FFF9C4, #FFF59D); padding: 40px; border-radius: 25px; margin: 40px 0; border: 5px solid #FBC02D; box-shadow: 0 15px 40px rgba(251, 192, 45, 0.4); text-align: center;">
            <h3 style="color: #F57F17; font-size: 2em; margin-bottom: 20px;">‚≠ê LA REGLA DE ORO ‚≠ê</h3>
            <p style="font-size: 1.5em; color: #E65100; font-weight: 700; line-height: 1.8;">
                "Lo que hagas arriba, hazlo abajo"
            </p>
            <p style="font-size: 1.2em; color: #FF8F00; margin-top: 15px; line-height: 1.8;">
                Si multiplicas o divides el numerador por un n√∫mero,<br>
                <strong>DEBES</strong> hacer lo mismo con el denominador.
            </p>
            <div style="background: white; padding: 20px; border-radius: 15px; margin-top: 25px; display: inline-block;">
                <p style="font-size: 1.3em; color: #6D4C41; margin: 0;">
                    ‚ö†Ô∏è Si solo cambias uno, ¬°la fracci√≥n cambia de valor!
                </p>
            </div>
        </div>

        <!-- FRACCI√ìN IRREDUCIBLE -->
        <h3 style="color: #00695C; font-size: 2.2em; text-align: center; margin: 50px 0 30px 0;">‚úÇÔ∏è La Fracci√≥n Irreducible (La M√°s Simple)</h3>
        
        <div style="background: linear-gradient(135deg, #E0F2F1, #B2DFDB); padding: 40px; border-radius: 25px; margin: 30px 0; border: 4px solid #00897B; box-shadow: 0 15px 40px rgba(0, 137, 123, 0.25);">
            <div style="background: white; padding: 30px; border-radius: 20px; margin-bottom: 25px;">
                <h4 style="color: #00695C; font-size: 1.6em; margin-bottom: 15px;">üìñ ¬øQu√© es una Fracci√≥n Irreducible?</h4>
                <p style="font-size: 1.2em; color: #004D40; line-height: 1.9;">
                    Es una fracci√≥n que <strong>ya no se puede simplificar m√°s</strong>. 
                    El numerador y el denominador no tienen ning√∫n divisor com√∫n (excepto el 1).
                </p>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div style="background: white; padding: 25px; border-radius: 15px; text-align: center; border-left: 6px solid #4CAF50;">
                    <p style="font-size: 1.1em; color: #2E7D32; font-weight: 600; margin-bottom: 10px;">‚úÖ ES irreducible:</p>
                    <span style="font-size: 2.5em; font-weight: 900; color: #4CAF50;"><sup>3</sup>/<sub>4</sub></span>
                    <p style="font-size: 1em; color: #388E3C; margin-top: 10px;">3 y 4 solo se dividen entre 1</p>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 15px; text-align: center; border-left: 6px solid #F44336;">
                    <p style="font-size: 1.1em; color: #C62828; font-weight: 600; margin-bottom: 10px;">‚ùå NO es irreducible:</p>
                    <span style="font-size: 2.5em; font-weight: 900; color: #F44336;"><sup>6</sup>/<sub>8</sub></span>
                    <p style="font-size: 1em; color: #D32F2F; margin-top: 10px;">6 y 8 se pueden dividir entre 2</p>
                </div>
            </div>
            
            <div style="background: #B2DFDB; padding: 25px; border-radius: 15px; margin-top: 25px;">
                <h4 style="color: #00695C; font-size: 1.4em; margin-bottom: 15px;">üîç ¬øC√≥mo simplificar hasta la irreducible?</h4>
                <p style="font-size: 1.15em; color: #004D40; line-height: 1.9;">
                    <strong>Paso 1:</strong> Busca un n√∫mero que divida EXACTO tanto al numerador como al denominador.<br>
                    <strong>Paso 2:</strong> Divide ambos por ese n√∫mero.<br>
                    <strong>Paso 3:</strong> Repite hasta que no encuentres m√°s divisores comunes.
                </p>
            </div>
        </div>

        <!-- EJEMPLO PASO A PASO DE SIMPLIFICACI√ìN -->
        <div style="background: linear-gradient(135deg, #EDE7F6, #D1C4E9); padding: 40px; border-radius: 25px; margin: 40px 0; border: 4px solid #673AB7; box-shadow: 0 15px 40px rgba(103, 58, 183, 0.25);">
            <h3 style="color: #4527A0; font-size: 1.8em; text-align: center; margin-bottom: 30px;">üìù Ejemplo Paso a Paso: Simplificar <sup>12</sup>/<sub>18</sub></h3>
            
            <div style="display: grid; gap: 20px; max-width: 700px; margin: 0 auto;">
                <div style="background: white; padding: 25px; border-radius: 15px; display: flex; align-items: center; gap: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <span style="background: #673AB7; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em; font-weight: 700;">1</span>
                    <div>
                        <p style="font-size: 1.2em; color: #4527A0; margin: 0; line-height: 1.6;">
                            <strong>Pregunta:</strong> ¬øHay un n√∫mero que divida a 12 y a 18?<br>
                            <span style="color: #7C4DFF;">S√≠, el 2 divide a ambos.</span>
                        </p>
                    </div>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 15px; display: flex; align-items: center; gap: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <span style="background: #673AB7; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em; font-weight: 700;">2</span>
                    <div>
                        <p style="font-size: 1.2em; color: #4527A0; margin: 0; line-height: 1.6;">
                            <strong>Divide ambos entre 2:</strong><br>
                            <span style="font-size: 1.5em;"><sup>12</sup>/<sub>18</sub> √∑ <sup>2</sup>/<sub>2</sub> = <sup>6</sup>/<sub>9</sub></span>
                        </p>
                    </div>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 15px; display: flex; align-items: center; gap: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <span style="background: #673AB7; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em; font-weight: 700;">3</span>
                    <div>
                        <p style="font-size: 1.2em; color: #4527A0; margin: 0; line-height: 1.6;">
                            <strong>¬øSe puede seguir?</strong> ¬øHay n√∫mero que divida a 6 y 9?<br>
                            <span style="color: #7C4DFF;">S√≠, el 3 divide a ambos.</span>
                        </p>
                    </div>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 15px; display: flex; align-items: center; gap: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <span style="background: #673AB7; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em; font-weight: 700;">4</span>
                    <div>
                        <p style="font-size: 1.2em; color: #4527A0; margin: 0; line-height: 1.6;">
                            <strong>Divide ambos entre 3:</strong><br>
                            <span style="font-size: 1.5em;"><sup>6</sup>/<sub>9</sub> √∑ <sup>3</sup>/<sub>3</sub> = <sup>2</sup>/<sub>3</sub></span>
                        </p>
                    </div>
                </div>
                
                <div style="background: #D1C4E9; padding: 25px; border-radius: 15px; display: flex; align-items: center; gap: 20px;">
                    <span style="font-size: 3em;">üéâ</span>
                    <div>
                        <p style="font-size: 1.3em; color: #4527A0; margin: 0; font-weight: 700;">
                            ¬°LISTO! <sup>2</sup>/<sub>3</sub> es la fracci√≥n irreducible.<br>
                            <span style="font-weight: 400; font-size: 0.9em;">2 y 3 solo tienen al 1 como divisor com√∫n.</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- MINI-ACTIVIDAD INTERACTIVA 2 -->
        <div style="background: linear-gradient(135deg, #E1F5FE, #B3E5FC); padding: 40px; border-radius: 25px; margin: 40px 0; border: 5px solid #03A9F4; box-shadow: 0 15px 40px rgba(3, 169, 244, 0.3);">
            <h3 style="color: #01579B; font-size: 1.8em; text-align: center; margin-bottom: 25px;">üéÆ ¬°Mini-Reto de Equivalencia!</h3>
            <p style="font-size: 1.2em; color: #0277BD; text-align: center; margin-bottom: 30px;">
                Haz clic en la fracci√≥n equivalente correcta:
            </p>
            
            <div id="miniQuiz2" style="display: grid; gap: 25px;">
                <!-- Pregunta 1 -->
                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <p style="font-size: 1.2em; color: #01579B; font-weight: 600; margin-bottom: 15px;">
                        1Ô∏è‚É£ ¬øCu√°l es equivalente a <sup>1</sup>/<sub>2</sub>?
                    </p>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button onclick="checkMiniAnswer(this, false)" style="padding: 15px 30px; font-size: 1.3em; border: 3px solid #03A9F4; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 700;"><sup>2</sup>/<sub>3</sub></button>
                        <button onclick="checkMiniAnswer(this, true)" style="padding: 15px 30px; font-size: 1.3em; border: 3px solid #03A9F4; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 700;"><sup>3</sup>/<sub>6</sub></button>
                        <button onclick="checkMiniAnswer(this, false)" style="padding: 15px 30px; font-size: 1.3em; border: 3px solid #03A9F4; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 700;"><sup>1</sup>/<sub>3</sub></button>
                    </div>
                </div>
                
                <!-- Pregunta 2 -->
                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <p style="font-size: 1.2em; color: #01579B; font-weight: 600; margin-bottom: 15px;">
                        2Ô∏è‚É£ Simplifica <sup>8</sup>/<sub>12</sub> a su forma irreducible:
                    </p>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button onclick="checkMiniAnswer(this, false)" style="padding: 15px 30px; font-size: 1.3em; border: 3px solid #03A9F4; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 700;"><sup>4</sup>/<sub>6</sub></button>
                        <button onclick="checkMiniAnswer(this, false)" style="padding: 15px 30px; font-size: 1.3em; border: 3px solid #03A9F4; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 700;"><sup>1</sup>/<sub>2</sub></button>
                        <button onclick="checkMiniAnswer(this, true)" style="padding: 15px 30px; font-size: 1.3em; border: 3px solid #03A9F4; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 700;"><sup>2</sup>/<sub>3</sub></button>
                    </div>
                </div>
                
                <!-- Pregunta 3 -->
                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <p style="font-size: 1.2em; color: #01579B; font-weight: 600; margin-bottom: 15px;">
                        3Ô∏è‚É£ Si amplificas <sup>2</sup>/<sub>5</sub> por 3, obtienes:
                    </p>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button onclick="checkMiniAnswer(this, true)" style="padding: 15px 30px; font-size: 1.3em; border: 3px solid #03A9F4; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 700;"><sup>6</sup>/<sub>15</sub></button>
                        <button onclick="checkMiniAnswer(this, false)" style="padding: 15px 30px; font-size: 1.3em; border: 3px solid #03A9F4; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 700;"><sup>5</sup>/<sub>8</sub></button>
                        <button onclick="checkMiniAnswer(this, false)" style="padding: 15px 30px; font-size: 1.3em; border: 3px solid #03A9F4; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 700;"><sup>6</sup>/<sub>5</sub></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TRUCO DEL MCD -->
        <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 40px; border-radius: 25px; margin: 40px 0; border: 4px solid #FF9800; box-shadow: 0 15px 40px rgba(255, 152, 0, 0.3);">
            <h3 style="color: #E65100; font-size: 1.8em; text-align: center; margin-bottom: 25px;">üí° Truco Pro: El MCD (M√°ximo Com√∫n Divisor)</h3>
            <p style="font-size: 1.2em; color: #BF360C; line-height: 1.9; margin-bottom: 20px;">
                Si quieres simplificar una fracci√≥n <strong>de un solo golpe</strong>, divide ambos n√∫meros por su <strong>MCD</strong> 
                (el n√∫mero m√°s grande que divide a ambos exactamente).
            </p>
            
            <div style="background: white; padding: 30px; border-radius: 20px;">
                <p style="font-size: 1.2em; color: #E65100; margin-bottom: 15px;"><strong>Ejemplo:</strong> Simplificar <sup>12</sup>/<sub>18</sub></p>
                <p style="font-size: 1.15em; color: #6D4C41; line-height: 1.9;">
                    ‚Ä¢ Divisores de 12: 1, 2, 3, 4, <strong style="background: #FFEB3B; padding: 2px 6px; border-radius: 5px;">6</strong>, 12<br>
                    ‚Ä¢ Divisores de 18: 1, 2, 3, <strong style="background: #FFEB3B; padding: 2px 6px; border-radius: 5px;">6</strong>, 9, 18<br>
                    ‚Ä¢ MCD = <strong>6</strong> (el mayor que est√° en ambos)
                </p>
                <p style="font-size: 1.3em; color: #E65100; margin-top: 20px; text-align: center; font-weight: 700;">
                    <sup>12</sup>/<sub>18</sub> √∑ <sup>6</sup>/<sub>6</sub> = <sup>2</sup>/<sub>3</sub> ‚úÖ
                </p>
            </div>
        </div>

        <!-- DATO CURIOSO -->
        <div style="background: linear-gradient(135deg, #ECEFF1, #CFD8DC); padding: 35px; border-radius: 25px; margin: 40px 0; border: 4px solid #607D8B; box-shadow: 0 15px 40px rgba(96, 125, 139, 0.3); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -30px; right: -30px; font-size: 10em; opacity: 0.1;">üßÆ</div>
            <h3 style="color: #37474F; font-size: 1.8em; margin-bottom: 20px;">üìñ ¬øSab√≠as que...?</h3>
            <p style="font-size: 1.2em; line-height: 1.9; color: #455A64;">
                El matem√°tico griego <strong>Euclides</strong> (hace m√°s de 2300 a√±os) invent√≥ un m√©todo genial para encontrar el MCD 
                llamado el "<strong>Algoritmo de Euclides</strong>". ¬°Este m√©todo todav√≠a se usa hoy en computadoras modernas! 
                Es incre√≠ble que un descubrimiento tan antiguo siga siendo √∫til en la era digital. üíª
            </p>
        </div>

        <!-- TIEMPO Y BOT√ìN DE CONTINUAR -->
        <p style="margin-top: 35px; font-size: 1.15em; color: #6A1B9A; text-align: center;">
            ‚è±Ô∏è Tiempo Sugerido: <strong>20-25 min</strong> (Teor√≠a + Mini-retos)
        </p>

        <div style="text-align: center; margin-top: 40px;">
            <button class="back-button" onclick="completeSubActivity(4, 2); showScreen('session4GameClassScreen');" style="background: linear-gradient(135deg, #9C27B0, #7B1FA2); font-size: 1.4em; padding: 20px 50px; box-shadow: 0 10px 30px rgba(156, 39, 176, 0.5);">
                ¬°Continuar al Juego en el Aula! üé≤ ‚Üí
            </button>
        </div>
    </div>
</div>
<!-- ========== JUEGO EN EL AULA: PIZZA FRACCIONARIA ========== -->
<div class="screen" id="session4GameClassScreen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(76,175,80,0.05) 0%, rgba(139,195,74,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session4Screen')"> ‚Üê Volver a Sesi√≥n 4 </button>
        
        <!-- Encabezado animado -->
        <div style="position: relative; text-align: center; margin-bottom: 40px;">
            <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                <span class="math-symbol" style="position: absolute; left: 8%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">üé≤</span>
                <span class="math-symbol" style="position: absolute; left: 88%; top: 25%; font-size: 2.2em; animation: floatMath 7s ease-in-out infinite; animation-delay: 0.5s;">üçï</span>
                <span class="math-symbol" style="position: absolute; left: 12%; top: 60%; font-size: 2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s;">üèÜ</span>
                <span class="math-symbol" style="position: absolute; left: 85%; top: 65%; font-size: 2.3em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 1.5s;">‚≠ê</span>
            </div>
            <h2 style="position: relative; z-index: 1; color: #2E7D32; font-size: 2.5em; text-shadow: 0 3px 15px rgba(46, 125, 50, 0.3);">üé≤ Juego en el Aula: Pizza Fraccionaria</h2>
            <p style="font-size: 1.3em; color: #558B2F; font-weight: 500;">¬°Convi√©rtete en el Maestro Pizzero de las Fracciones!</p>
        </div>

        <!-- BANNER DE JUEGO -->
        <div style="background: linear-gradient(135deg, #4CAF50, #8BC34A); padding: 40px; border-radius: 30px; margin: 30px 0; box-shadow: 0 20px 50px rgba(76, 175, 80, 0.4); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -50px; right: -50px; font-size: 15em; opacity: 0.15;">üçï</div>
            <div style="position: relative; z-index: 1; text-align: center;">
                <span style="font-size: 5em; display: block; margin-bottom: 20px; animation: bounce 2s infinite;">üçï</span>
                <h3 style="color: white; font-size: 2.2em; text-shadow: 0 3px 10px rgba(0,0,0,0.3); margin-bottom: 15px;">¬°PIZZA FRACCIONARIA!</h3>
                <p style="color: rgba(255,255,255,0.95); font-size: 1.3em; max-width: 600px; margin: 0 auto; line-height: 1.6;">
                    Un juego colaborativo donde los equipos compiten para demostrar su dominio de las fracciones
                </p>
                <div style="display: flex; justify-content: center; gap: 30px; margin-top: 25px; flex-wrap: wrap;">
                    <div style="background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 15px;">
                        <span style="font-size: 1.5em;">üë•</span>
                        <p style="color: white; margin: 5px 0 0 0; font-weight: 600;">4-6 Equipos</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 15px;">
                        <span style="font-size: 1.5em;">‚è±Ô∏è</span>
                        <p style="color: white; margin: 5px 0 0 0; font-weight: 600;">30-40 min</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 15px;">
                        <span style="font-size: 1.5em;">üéØ</span>
                        <p style="color: white; margin: 5px 0 0 0; font-weight: 600;">Nivel: B√°sico-Medio</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- OBJETIVO DEL JUEGO -->
        <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 35px; border-radius: 25px; margin: 30px 0; border-left: 10px solid #4CAF50; box-shadow: 0 10px 30px rgba(76, 175, 80, 0.2);">
            <h3 style="color: #2E7D32; font-size: 1.8em; margin-bottom: 20px;">üéØ Objetivo del Juego</h3>
            <p style="font-size: 1.25em; line-height: 1.9; color: #1B5E20;">
                Los equipos compiten para <strong>"armar pizzas"</strong> correctamente respondiendo preguntas sobre fracciones. 
                Cada respuesta correcta les da un <strong>"pedazo de pizza"</strong>. 
                El primer equipo en completar su pizza (8 pedazos) o el que tenga m√°s pedazos al final, ¬°GANA! üèÜ
            </p>
        </div>

        <!-- MATERIALES NECESARIOS -->
        <h3 style="color: #E65100; font-size: 2em; text-align: center; margin: 50px 0 30px 0;">üì¶ Materiales Necesarios</h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 30px 0;">
            <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 25px; border-radius: 20px; border: 3px solid #FF9800; box-shadow: 0 8px 25px rgba(255, 152, 0, 0.2); transition: transform 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div style="text-align: center; margin-bottom: 15px;">
                    <span style="font-size: 3em;">üìÑ</span>
                </div>
                <h4 style="color: #E65100; font-size: 1.3em; text-align: center; margin-bottom: 10px;">Pizzas de Cartulina</h4>
                <p style="color: #BF360C; font-size: 1.05em; line-height: 1.7; text-align: center;">
                    6 c√≠rculos grandes de cartulina (uno por equipo) divididos en <strong>8 partes iguales</strong> con l√≠neas
                </p>
            </div>
            
            <div style="background: linear-gradient(135deg, #FFEBEE, #FFCDD2); padding: 25px; border-radius: 20px; border: 3px solid #F44336; box-shadow: 0 8px 25px rgba(244, 67, 54, 0.2); transition: transform 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div style="text-align: center; margin-bottom: 15px;">
                    <span style="font-size: 3em;">üçï</span>
                </div>
                <h4 style="color: #C62828; font-size: 1.3em; text-align: center; margin-bottom: 10px;">Pedazos de Pizza</h4>
                <p style="color: #B71C1C; font-size: 1.05em; line-height: 1.7; text-align: center;">
                    48 tri√°ngulos de cartulina de colores (8 por equipo) que encajen en las pizzas
                </p>
            </div>
            
            <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 25px; border-radius: 20px; border: 3px solid #2196F3; box-shadow: 0 8px 25px rgba(33, 150, 243, 0.2); transition: transform 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div style="text-align: center; margin-bottom: 15px;">
                    <span style="font-size: 3em;">üé¥</span>
                </div>
                <h4 style="color: #1565C0; font-size: 1.3em; text-align: center; margin-bottom: 10px;">Tarjetas de Preguntas</h4>
                <p style="color: #0D47A1; font-size: 1.05em; line-height: 1.7; text-align: center;">
                    30-40 tarjetas con preguntas de fracciones (ver banco de preguntas abajo)
                </p>
            </div>
            
            <div style="background: linear-gradient(135deg, #F3E5F5, #E1BEE7); padding: 25px; border-radius: 20px; border: 3px solid #9C27B0; box-shadow: 0 8px 25px rgba(156, 39, 176, 0.2); transition: transform 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div style="text-align: center; margin-bottom: 15px;">
                    <span style="font-size: 3em;">üé≤</span>
                </div>
                <h4 style="color: #7B1FA2; font-size: 1.3em; text-align: center; margin-bottom: 10px;">Dado Grande</h4>
                <p style="color: #6A1B9A; font-size: 1.05em; line-height: 1.7; text-align: center;">
                    Un dado para determinar el nivel de dificultad de la pregunta (1-2: f√°cil, 3-4: medio, 5-6: dif√≠cil)
                </p>
            </div>
            
            <div style="background: linear-gradient(135deg, #FFF9C4, #FFF59D); padding: 25px; border-radius: 20px; border: 3px solid #FBC02D; box-shadow: 0 8px 25px rgba(251, 192, 45, 0.2); transition: transform 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div style="text-align: center; margin-bottom: 15px;">
                    <span style="font-size: 3em;">‚è±Ô∏è</span>
                </div>
                <h4 style="color: #F57F17; font-size: 1.3em; text-align: center; margin-bottom: 10px;">Cron√≥metro</h4>
                <p style="color: #E65100; font-size: 1.05em; line-height: 1.7; text-align: center;">
                    Para controlar el tiempo de respuesta (30-60 segundos seg√∫n dificultad)
                </p>
            </div>
            
            <div style="background: linear-gradient(135deg, #E0F2F1, #B2DFDB); padding: 25px; border-radius: 20px; border: 3px solid #00897B; box-shadow: 0 8px 25px rgba(0, 137, 123, 0.2); transition: transform 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div style="text-align: center; margin-bottom: 15px;">
                    <span style="font-size: 3em;">üìã</span>
                </div>
                <h4 style="color: #00695C; font-size: 1.3em; text-align: center; margin-bottom: 10px;">Tabla de Puntuaci√≥n</h4>
                <p style="color: #004D40; font-size: 1.05em; line-height: 1.7; text-align: center;">
                    Pizarra o papel√≥grafo para llevar el conteo de pedazos por equipo
                </p>
            </div>
        </div>

        <!-- REGLAS DEL JUEGO -->
        <h3 style="color: #1565C0; font-size: 2em; text-align: center; margin: 50px 0 30px 0;">üìú Reglas del Juego</h3>
        
        <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 40px; border-radius: 25px; margin: 30px 0; border: 4px solid #2196F3; box-shadow: 0 15px 40px rgba(33, 150, 243, 0.25);">
            <div style="display: grid; gap: 20px;">
                
                <div style="background: white; padding: 25px; border-radius: 15px; display: flex; align-items: flex-start; gap: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); transition: transform 0.3s;" onmouseover="this.style.transform='translateX(10px)'" onmouseout="this.style.transform='translateX(0)'">
                    <span style="background: linear-gradient(135deg, #2196F3, #1976D2); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em; font-weight: 700; flex-shrink: 0;">1</span>
                    <div>
                        <h4 style="color: #1565C0; font-size: 1.3em; margin: 0 0 10px 0;">Formar Equipos</h4>
                        <p style="color: #0D47A1; font-size: 1.1em; line-height: 1.7; margin: 0;">
                            Divide la clase en <strong>4-6 equipos</strong> de 4-6 estudiantes. Cada equipo recibe una "pizza base" (c√≠rculo de cartulina) y elige un nombre creativo (ej: "Los Pepperonis", "Pizza Masters", etc.)
                        </p>
                    </div>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 15px; display: flex; align-items: flex-start; gap: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); transition: transform 0.3s;" onmouseover="this.style.transform='translateX(10px)'" onmouseout="this.style.transform='translateX(0)'">
                    <span style="background: linear-gradient(135deg, #2196F3, #1976D2); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em; font-weight: 700; flex-shrink: 0;">2</span>
                    <div>
                        <h4 style="color: #1565C0; font-size: 1.3em; margin: 0 0 10px 0;">Lanzar el Dado</h4>
                        <p style="color: #0D47A1; font-size: 1.1em; line-height: 1.7; margin: 0;">
                            El equipo en turno lanza el dado para determinar la dificultad:<br>
                            <strong style="color: #4CAF50;">üü¢ 1-2:</strong> Pregunta f√°cil (30 seg) ‚Üí 1 pedazo<br>
                            <strong style="color: #FF9800;">üü° 3-4:</strong> Pregunta media (45 seg) ‚Üí 2 pedazos<br>
                            <strong style="color: #F44336;">üî¥ 5-6:</strong> Pregunta dif√≠cil (60 seg) ‚Üí 3 pedazos
                        </p>
                    </div>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 15px; display: flex; align-items: flex-start; gap: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); transition: transform 0.3s;" onmouseover="this.style.transform='translateX(10px)'" onmouseout="this.style.transform='translateX(0)'">
                    <span style="background: linear-gradient(135deg, #2196F3, #1976D2); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em; font-weight: 700; flex-shrink: 0;">3</span>
                    <div>
                        <h4 style="color: #1565C0; font-size: 1.3em; margin: 0 0 10px 0;">Responder la Pregunta</h4>
                        <p style="color: #0D47A1; font-size: 1.1em; line-height: 1.7; margin: 0;">
                            El docente lee la pregunta. El equipo debe <strong>discutir en voz baja</strong> y dar UNA respuesta final antes de que termine el tiempo. ¬°Trabajo en equipo!
                        </p>
                    </div>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 15px; display: flex; align-items: flex-start; gap: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); transition: transform 0.3s;" onmouseover="this.style.transform='translateX(10px)'" onmouseout="this.style.transform='translateX(0)'">
                    <span style="background: linear-gradient(135deg, #2196F3, #1976D2); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em; font-weight: 700; flex-shrink: 0;">4</span>
                    <div>
                        <h4 style="color: #1565C0; font-size: 1.3em; margin: 0 0 10px 0;">Ganar Pedazos</h4>
                        <p style="color: #0D47A1; font-size: 1.1em; line-height: 1.7; margin: 0;">
                            ‚úÖ <strong>Respuesta correcta:</strong> El equipo gana los pedazos correspondientes y los coloca en su pizza.<br>
                            ‚ùå <strong>Respuesta incorrecta:</strong> No ganan pedazos, pero el docente explica la respuesta correcta.
                        </p>
                    </div>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 15px; display: flex; align-items: flex-start; gap: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); transition: transform 0.3s;" onmouseover="this.style.transform='translateX(10px)'" onmouseout="this.style.transform='translateX(0)'">
                    <span style="background: linear-gradient(135deg, #2196F3, #1976D2); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em; font-weight: 700; flex-shrink: 0;">5</span>
                    <div>
                        <h4 style="color: #1565C0; font-size: 1.3em; margin: 0 0 10px 0;">¬°Victoria!</h4>
                        <p style="color: #0D47A1; font-size: 1.1em; line-height: 1.7; margin: 0;">
                            üèÜ <strong>Gana el primer equipo en completar su pizza</strong> (8 pedazos) O el equipo con m√°s pedazos cuando se acaben las preguntas o el tiempo de clase.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- BANCO DE PREGUNTAS -->
        <h3 style="color: #7B1FA2; font-size: 2em; text-align: center; margin: 50px 0 30px 0;">üé¥ Banco de Preguntas</h3>
        
        <div style="background: linear-gradient(135deg, #F3E5F5, #E1BEE7); padding: 40px; border-radius: 25px; margin: 30px 0; border: 4px solid #9C27B0; box-shadow: 0 15px 40px rgba(156, 39, 176, 0.25);">
            
            <!-- NIVEL F√ÅCIL -->
            <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 30px; border-radius: 20px; margin-bottom: 25px; border-left: 8px solid #4CAF50;">
                <h4 style="color: #2E7D32; font-size: 1.5em; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span style="background: #4CAF50; color: white; padding: 5px 15px; border-radius: 20px;">üü¢ F√ÅCIL</span>
                    (1 pedazo - 30 segundos)
                </h4>
                <div style="display: grid; gap: 12px;">
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #1B5E20;">
                        1. En la fracci√≥n ‚Åµ‚ÅÑ‚Çà, ¬øcu√°l es el numerador? <strong style="color: #4CAF50;">(R: 5)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #1B5E20;">
                        2. En la fracci√≥n ¬≥‚ÅÑ‚Çá, ¬øcu√°l es el denominador? <strong style="color: #4CAF50;">(R: 7)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #1B5E20;">
                        3. Si una pizza tiene 4 pedazos y comes 1, ¬øqu√© fracci√≥n comiste? <strong style="color: #4CAF50;">(R: ¬º)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #1B5E20;">
                        4. ¬øC√≥mo se lee la fracci√≥n ¬Ω? <strong style="color: #4CAF50;">(R: Un medio)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #1B5E20;">
                        5. ¬ø¬≤‚ÅÑ‚ÇÖ es una fracci√≥n propia o impropia? <strong style="color: #4CAF50;">(R: Propia)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #1B5E20;">
                        6. ¬øQu√© indica el denominador? <strong style="color: #4CAF50;">(R: Las partes totales/en que se divide)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #1B5E20;">
                        7. ¬ø‚Å∑‚ÅÑ‚ÇÑ es propia o impropia? <strong style="color: #4CAF50;">(R: Impropia)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #1B5E20;">
                        8. ¬øCu√°ntos cuartos hay en un entero? <strong style="color: #4CAF50;">(R: 4)</strong>
                    </div>
                </div>
            </div>
            
            <!-- NIVEL MEDIO -->
            <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 30px; border-radius: 20px; margin-bottom: 25px; border-left: 8px solid #FF9800;">
                <h4 style="color: #E65100; font-size: 1.5em; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span style="background: #FF9800; color: white; padding: 5px 15px; border-radius: 20px;">üü° MEDIO</span>
                    (2 pedazos - 45 segundos)
                </h4>
                <div style="display: grid; gap: 12px;">
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #E65100;">
                        1. ¬øCu√°l es una fracci√≥n equivalente a ¬Ω? <strong style="color: #FF9800;">(R: ¬≤‚ÅÑ‚ÇÑ, ¬≥‚ÅÑ‚ÇÜ, ‚Å¥‚ÅÑ‚Çà, etc.)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #E65100;">
                        2. Simplifica ‚Å¥‚ÅÑ‚Çà a su forma irreducible. <strong style="color: #FF9800;">(R: ¬Ω)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #E65100;">
                        3. Amplifica ¬≤‚ÅÑ‚ÇÉ por 4. <strong style="color: #FF9800;">(R: ‚Å∏‚ÅÑ‚ÇÅ‚ÇÇ)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #E65100;">
                        4. ¬ø‚Å∂‚ÅÑ‚Çâ es equivalente a ¬≤‚ÅÑ‚ÇÉ? <strong style="color: #FF9800;">(R: S√≠)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #E65100;">
                        5. Convierte ‚Åµ‚ÅÑ‚ÇÑ a n√∫mero mixto. <strong style="color: #FF9800;">(R: 1¬º)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #E65100;">
                        6. Simplifica ‚Åπ‚ÅÑ‚ÇÅ‚ÇÇ. <strong style="color: #FF9800;">(R: ¬æ)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #E65100;">
                        7. ¬øCu√°l es mayor: ¬Ω o ‚Öì? <strong style="color: #FF9800;">(R: ¬Ω)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #E65100;">
                        8. ¬ø¬≥‚ÅÑ‚ÇÖ est√° en su forma irreducible? <strong style="color: #FF9800;">(R: S√≠)</strong>
                    </div>
                </div>
            </div>
            
            <!-- NIVEL DIF√çCIL -->
            <div style="background: linear-gradient(135deg, #FFEBEE, #FFCDD2); padding: 30px; border-radius: 20px; border-left: 8px solid #F44336;">
                <h4 style="color: #C62828; font-size: 1.5em; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span style="background: #F44336; color: white; padding: 5px 15px; border-radius: 20px;">üî¥ DIF√çCIL</span>
                    (3 pedazos - 60 segundos)
                </h4>
                <div style="display: grid; gap: 12px;">
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #C62828;">
                        1. Simplifica ¬≤‚Å¥‚ÅÑ‚ÇÉ‚ÇÜ hasta su forma irreducible. <strong style="color: #F44336;">(R: ¬≤‚ÅÑ‚ÇÉ)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #C62828;">
                        2. ¬øCu√°l es el MCD de 84 y 126? <strong style="color: #F44336;">(R: 42)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #C62828;">
                        3. Convierte 2¬≥‚ÅÑ‚ÇÖ a fracci√≥n impropia. <strong style="color: #F44336;">(R: ¬π¬≥‚ÅÑ‚ÇÖ)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #C62828;">
                        4. Encuentra 3 fracciones equivalentes a ¬≥‚ÅÑ‚ÇÑ. <strong style="color: #F44336;">(R: ‚Å∂‚ÅÑ‚Çà, ‚Åπ‚ÅÑ‚ÇÅ‚ÇÇ, ¬π¬≤‚ÅÑ‚ÇÅ‚ÇÜ)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #C62828;">
                        5. Si ‚Åø‚ÅÑ‚ÇÅ‚ÇÇ = ¬≤‚ÅÑ‚ÇÉ, ¬øcu√°nto vale n? <strong style="color: #F44336;">(R: 8)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #C62828;">
                        6. ¬ø¬π‚Åµ‚ÅÑ‚ÇÇ‚ÇÄ es equivalente a ‚Åπ‚ÅÑ‚ÇÅ‚ÇÇ? <strong style="color: #F44336;">(R: S√≠, ambas = ¬æ)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #C62828;">
                        7. Simplifica ‚Å¥¬≤‚ÅÑ‚ÇÖ‚ÇÜ. <strong style="color: #F44336;">(R: ¬æ)</strong>
                    </div>
                    <div style="background: white; padding: 15px 20px; border-radius: 10px; font-size: 1.1em; color: #C62828;">
                        8. ¬øPor qu√© ‚Å∏‚ÅÑ‚ÇÅ‚ÇÇ y ‚Å∂‚ÅÑ‚Çâ son equivalentes? <strong style="color: #F44336;">(R: Ambas = ¬≤‚ÅÑ‚ÇÉ)</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- VARIANTES DEL JUEGO -->
        <h3 style="color: #00695C; font-size: 2em; text-align: center; margin: 50px 0 30px 0;">üîÑ Variantes y Power-Ups</h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin: 30px 0;">
            <div style="background: linear-gradient(135deg, #E0F7FA, #B2EBF2); padding: 30px; border-radius: 20px; border: 3px solid #00BCD4; box-shadow: 0 10px 30px rgba(0, 188, 212, 0.25);">
                <div style="text-align: center; margin-bottom: 15px;">
                    <span style="font-size: 3em;">‚ö°</span>
                </div>
                <h4 style="color: #00838F; font-size: 1.3em; text-align: center; margin-bottom: 15px;">Pregunta Rel√°mpago</h4>
                <p style="color: #006064; font-size: 1.05em; line-height: 1.7;">
                    Cada 5 rondas, todos los equipos responden la misma pregunta. El primero en responder correctamente gana 2 pedazos extra.
                </p>
            </div>
            
            <div style="background: linear-gradient(135deg, #FFF8E1, #FFECB3); padding: 30px; border-radius: 20px; border: 3px solid #FFC107; box-shadow: 0 10px 30px rgba(255, 193, 7, 0.25);">
                <div style="text-align: center; margin-bottom: 15px;">
                    <span style="font-size: 3em;">üé≠</span>
                </div>
                <h4 style="color: #FF8F00; font-size: 1.3em; text-align: center; margin-bottom: 15px;">Robar Pedazo</h4>
                <p style="color: #E65100; font-size: 1.05em; line-height: 1.7;">
                    Si un equipo falla, otro equipo puede "robar" respondiendo correctamente y ganando 1 pedazo.
                </p>
            </div>
            
            <div style="background: linear-gradient(135deg, #FCE4EC, #F8BBD9); padding: 30px; border-radius: 20px; border: 3px solid #E91E63; box-shadow: 0 10px 30px rgba(233, 30, 99, 0.25);">
                <div style="text-align: center; margin-bottom: 15px;">
                    <span style="font-size: 3em;">üÉè</span>
                </div>
                <h4 style="color: #C2185B; font-size: 1.3em; text-align: center; margin-bottom: 15px;">Carta Comod√≠n</h4>
                <p style="color: #880E4F; font-size: 1.05em; line-height: 1.7;">
                    Cada equipo tiene UN comod√≠n: pueden pedir una pista o cambiar la pregunta (solo una vez por juego).
                </p>
            </div>
        </div>

        <!-- SISTEMA DE RECOMPENSAS -->
        <div style="background: linear-gradient(135deg, #FFF9C4, #FFF59D); padding: 40px; border-radius: 25px; margin: 40px 0; border: 5px solid #FBC02D; box-shadow: 0 15px 40px rgba(251, 192, 45, 0.4);">
            <h3 style="color: #F57F17; font-size: 1.8em; text-align: center; margin-bottom: 25px;">üèÜ Sistema de Recompensas</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div style="background: white; padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <span style="font-size: 3em;">ü•á</span>
                    <h4 style="color: #FF8F00; font-size: 1.2em; margin: 10px 0;">1er Lugar</h4>
                    <p style="color: #6D4C41; font-size: 1em;">+1.0 en la nota del per√≠odo</p>
                </div>
                <div style="background: white; padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <span style="font-size: 3em;">ü•à</span>
                    <h4 style="color: #78909C; font-size: 1.2em; margin: 10px 0;">2do Lugar</h4>
                    <p style="color: #6D4C41; font-size: 1em;">+0.7 en la nota del per√≠odo</p>
                </div>
                <div style="background: white; padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <span style="font-size: 3em;">ü•â</span>
                    <h4 style="color: #A1887F; font-size: 1.2em; margin: 10px 0;">3er Lugar</h4>
                    <p style="color: #6D4C41; font-size: 1em;">+0.5 en la nota del per√≠odo</p>
                </div>
                <div style="background: white; padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <span style="font-size: 3em;">‚≠ê</span>
                    <h4 style="color: #7B1FA2; font-size: 1.2em; margin: 10px 0;">Participaci√≥n</h4>
                    <p style="color: #6D4C41; font-size: 1em;">+0.3 para todos</p>
                </div>
            </div>
        </div>

        <!-- CONSEJOS PARA EL DOCENTE -->
        <div style="background: linear-gradient(135deg, #ECEFF1, #CFD8DC); padding: 35px; border-radius: 25px; margin: 40px 0; border: 4px solid #607D8B; box-shadow: 0 15px 40px rgba(96, 125, 139, 0.25);">
            <h3 style="color: #37474F; font-size: 1.8em; margin-bottom: 20px;">üë®‚Äçüè´ Consejos para el Docente</h3>
            <ul style="font-size: 1.15em; color: #455A64; line-height: 2; list-style: none; padding: 0;">
                <li style="padding: 10px 0; border-bottom: 1px solid #B0BEC5;">‚úÖ Prepara los materiales con anticipaci√≥n (pizzas y pedazos de cartulina)</li>
                <li style="padding: 10px 0; border-bottom: 1px solid #B0BEC5;">‚úÖ Asigna roles dentro de cada equipo (capit√°n, vocero, verificador)</li>
                <li style="padding: 10px 0; border-bottom: 1px solid #B0BEC5;">‚úÖ Despu√©s de cada respuesta incorrecta, explica brevemente el procedimiento correcto</li>
                <li style="padding: 10px 0; border-bottom: 1px solid #B0BEC5;">‚úÖ Mant√©n un ambiente de competencia sana y respeto</li>
                <li style="padding: 10px 0; border-bottom: 1px solid #B0BEC5;">‚úÖ Ajusta la dificultad seg√∫n el nivel del grupo</li>
                <li style="padding: 10px 0;">‚úÖ ¬°Celebra todos los aciertos con entusiasmo! üéâ</li>
            </ul>
        </div>

        <!-- TIEMPO Y BOT√ìN DE CONTINUAR -->
        <p style="margin-top: 35px; font-size: 1.15em; color: #2E7D32; text-align: center;">
            ‚è±Ô∏è Tiempo del Juego: <strong>30-40 minutos</strong>
        </p>

        <div style="text-align: center; margin-top: 40px;">
            <button class="back-button" onclick="completeSubActivity(4, 3); showScreen('session4ActivityScreen');" style="background: linear-gradient(135deg, #4CAF50, #388E3C); font-size: 1.4em; padding: 20px 50px; box-shadow: 0 10px 30px rgba(76, 175, 80, 0.5);">
                ¬°Continuar a la Actividad Gamificada! üèÜ ‚Üí
            </button>
        </div>
    </div>
</div>

<!-- ========== ACTIVIDAD GAMIFICADA: CONQUISTA FRACCIONARIA ========== -->
<div class="screen" id="session4ActivityScreen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(33,150,243,0.05) 0%, rgba(3,169,244,0.08) 100%);">
        <button class="back-button" onclick="showScreen('session4Screen')"> ‚Üê Volver a Sesi√≥n 4 </button>
        
        <!-- Encabezado animado -->
        <div style="position: relative; text-align: center; margin-bottom: 40px;">
            <div class="math-symbol-wrapper" style="position: absolute; top: -40px; left: 0; width: 100%; height: 150px; pointer-events: none; z-index: 0;">
                <span class="math-symbol" style="position: absolute; left: 8%; top: 20%; font-size: 2.5em; animation: floatMath 6s ease-in-out infinite;">üèÜ</span>
                <span class="math-symbol" style="position: absolute; left: 88%; top: 25%; font-size: 2.2em; animation: floatMath 7s ease-in-out infinite; animation-delay: 0.5s;">‚≠ê</span>
                <span class="math-symbol" style="position: absolute; left: 12%; top: 60%; font-size: 2em; animation: floatMath 8s ease-in-out infinite; animation-delay: 1s;">üéØ</span>
                <span class="math-symbol" style="position: absolute; left: 85%; top: 65%; font-size: 2.3em; animation: floatMath 7.5s ease-in-out infinite; animation-delay: 1.5s;">üçï</span>
            </div>
            <h2 style="position: relative; z-index: 1; color: #1565C0; font-size: 2.5em; text-shadow: 0 3px 15px rgba(21, 101, 192, 0.3);">üèÜ Conquista Fraccionaria</h2>
            <p style="font-size: 1.3em; color: #1976D2; font-weight: 500;">¬°Demuestra tu dominio de las fracciones!</p>
        </div>

        <!-- BANNER INTRODUCTORIO -->
        <div style="background: linear-gradient(135deg, #1976D2, #2196F3, #03A9F4); padding: 40px; border-radius: 30px; margin: 30px 0; box-shadow: 0 20px 50px rgba(33, 150, 243, 0.4); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -50px; right: -50px; font-size: 12em; opacity: 0.1;">üèÜ</div>
            <div style="position: relative; z-index: 1; text-align: center;">
                <h3 style="color: white; font-size: 1.8em; text-shadow: 0 3px 10px rgba(0,0,0,0.3); margin-bottom: 15px;">üéÆ ¬°Desaf√≠o de 15 Preguntas!</h3>
                <p style="color: rgba(255,255,255,0.95); font-size: 1.2em; max-width: 700px; margin: 0 auto; line-height: 1.7;">
                    Responde correctamente para avanzar por los 3 niveles de dificultad. 
                    Necesitas <strong>al menos 10 respuestas correctas</strong> para completar la actividad.
                </p>
                <div style="display: flex; justify-content: center; gap: 20px; margin-top: 25px; flex-wrap: wrap;">
                    <div style="background: rgba(255,255,255,0.2); padding: 12px 20px; border-radius: 12px;">
                        <span style="color: #A5D6A7; font-weight: 700;">üü¢ Nivel 1:</span>
                        <span style="color: white;"> Preguntas 1-5</span>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 12px 20px; border-radius: 12px;">
                        <span style="color: #FFE082; font-weight: 700;">üü° Nivel 2:</span>
                        <span style="color: white;"> Preguntas 6-10</span>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 12px 20px; border-radius: 12px;">
                        <span style="color: #EF9A9A; font-weight: 700;">üî¥ Nivel 3:</span>
                        <span style="color: white;"> Preguntas 11-15</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- INSTRUCCIONES -->
        <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 25px; border-radius: 20px; margin: 30px 0; border-left: 8px solid #2196F3; display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
            <span style="font-size: 3em;">üìù</span>
            <div style="flex: 1; min-width: 250px;">
                <h4 style="color: #1565C0; font-size: 1.3em; margin-bottom: 10px;">Instrucciones</h4>
                <p style="color: #0D47A1; font-size: 1.1em; line-height: 1.7; margin: 0;">
                    Escribe tu respuesta en cada casilla. Para fracciones usa el formato <strong>a/b</strong> (ejemplo: 3/4). 
                    Al terminar, haz clic en "Verificar Respuestas".
                </p>
            </div>
        </div>

        <!-- BARRA DE PROGRESO -->
        <div style="background: linear-gradient(135deg, #f5f5f5, #e0e0e0); padding: 20px; border-radius: 20px; margin-bottom: 40px; border: 3px solid #9e9e9e; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
            <p style="font-size: 1.2em; font-weight: 700; color: #424242; margin-bottom: 15px; text-align: center;">üìä Tu Progreso</p>
            <div style="background: #bdbdbd; height: 30px; border-radius: 15px; overflow: hidden; box-shadow: 0 3px 8px rgba(0,0,0,0.2) inset; position: relative;">
                <div id="session4ProgressFill" style="background: linear-gradient(90deg, #4CAF50, #8BC34A, #CDDC39); height: 100%; width: 0%; transition: width 0.8s cubic-bezier(0.4, 0.0, 0.2, 1); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.1em; box-shadow: 0 0 20px rgba(76, 175, 80, 0.6);"></div>
            </div>
        </div>

        <!-- CONTENEDOR DE PREGUNTAS -->
        <div class="quiz-container" style="background: linear-gradient(135deg, #fafafa, #f5f5f5); padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
            
            <!-- ========== NIVEL 1: B√ÅSICO ========== -->
            <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 20px; border-radius: 15px; margin-bottom: 25px; border-left: 8px solid #4CAF50;">
                <h3 style="color: #2E7D32; font-size: 1.6em; margin-bottom: 5px; display: flex; align-items: center; gap: 10px;">
                    <span style="background: #4CAF50; color: white; padding: 8px 18px; border-radius: 10px;">üü¢ NIVEL 1</span>
                    Calentamiento
                </h3>
                <p style="color: #388E3C; font-size: 1.1em; margin: 0;">Conceptos b√°sicos de fracciones</p>
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f1f8e9); border-left: 5px solid #8bc34a; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <label style="font-size: 1.15em; color: #33691E; font-weight: 600; display: block; margin-bottom: 12px;">
                    1. üçï Una pizza se divide en 8 pedazos iguales. Si comes 3 pedazos, ¬øqu√© fracci√≥n de la pizza comiste?
                </label>
                <input type="text" class="quiz-input session4-input" data-correct="3/8" placeholder="Escribe la fracci√≥n (ej: 3/8)" style="width: 100%; max-width: 300px; padding: 12px 15px; font-size: 1.1em; border: 2px solid #8bc34a; border-radius: 10px;" />
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f1f8e9); border-left: 5px solid #8bc34a; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <label style="font-size: 1.15em; color: #33691E; font-weight: 600; display: block; margin-bottom: 12px;">
                    2. En la fracci√≥n ‚Å∑‚ÅÑ‚ÇÅ‚ÇÇ, ¬øcu√°l es el NUMERADOR?
                </label>
                <input type="text" class="quiz-input session4-input" data-correct="7" placeholder="Escribe el n√∫mero" style="width: 100%; max-width: 300px; padding: 12px 15px; font-size: 1.1em; border: 2px solid #8bc34a; border-radius: 10px;" />
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f1f8e9); border-left: 5px solid #8bc34a; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <label style="font-size: 1.15em; color: #33691E; font-weight: 600; display: block; margin-bottom: 12px;">
                    3. En la fracci√≥n ‚Åµ‚ÅÑ‚Çâ, ¬øcu√°l es el DENOMINADOR?
                </label>
                <input type="text" class="quiz-input session4-input" data-correct="9" placeholder="Escribe el n√∫mero" style="width: 100%; max-width: 300px; padding: 12px 15px; font-size: 1.1em; border: 2px solid #8bc34a; border-radius: 10px;" />
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f1f8e9); border-left: 5px solid #8bc34a; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <label style="font-size: 1.15em; color: #33691E; font-weight: 600; display: block; margin-bottom: 12px;">
                    4. ¬øLa fracci√≥n ¬≥‚ÅÑ‚ÇÖ es PROPIA o IMPROPIA? (Escribe "propia" o "impropia")
                </label>
                <input type="text" class="quiz-input session4-input" data-correct="propia" placeholder="propia / impropia" style="width: 100%; max-width: 300px; padding: 12px 15px; font-size: 1.1em; border: 2px solid #8bc34a; border-radius: 10px;" />
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #f1f8e9); border-left: 5px solid #8bc34a; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <label style="font-size: 1.15em; color: #33691E; font-weight: 600; display: block; margin-bottom: 12px;">
                    5. ¬øLa fracci√≥n ‚Åπ‚ÅÑ‚ÇÑ es PROPIA o IMPROPIA? (Escribe "propia" o "impropia")
                </label>
                <input type="text" class="quiz-input session4-input" data-correct="impropia" placeholder="propia / impropia" style="width: 100%; max-width: 300px; padding: 12px 15px; font-size: 1.1em; border: 2px solid #8bc34a; border-radius: 10px;" />
            </div>

            <!-- ========== NIVEL 2: INTERMEDIO ========== -->
            <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 20px; border-radius: 15px; margin: 30px 0 25px 0; border-left: 8px solid #FF9800;">
                <h3 style="color: #E65100; font-size: 1.6em; margin-bottom: 5px; display: flex; align-items: center; gap: 10px;">
                    <span style="background: #FF9800; color: white; padding: 8px 18px; border-radius: 10px;">üü° NIVEL 2</span>
                    Equivalencia
                </h3>
                <p style="color: #EF6C00; font-size: 1.1em; margin: 0;">Fracciones equivalentes y amplificaci√≥n</p>
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #fff8e1); border-left: 5px solid #ffa726; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <label style="font-size: 1.15em; color: #E65100; font-weight: 600; display: block; margin-bottom: 12px;">
                    6. ¬øCu√°l es una fracci√≥n equivalente a ¬Ω? (Amplifica por 3)
                </label>
                <input type="text" class="quiz-input session4-input" data-correct="3/6" placeholder="Escribe la fracci√≥n" style="width: 100%; max-width: 300px; padding: 12px 15px; font-size: 1.1em; border: 2px solid #ffa726; border-radius: 10px;" />
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #fff8e1); border-left: 5px solid #ffa726; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <label style="font-size: 1.15em; color: #E65100; font-weight: 600; display: block; margin-bottom: 12px;">
                    7. Amplifica la fracci√≥n ¬≤‚ÅÑ‚ÇÖ por 4. ¬øCu√°l es el resultado?
                </label>
                <input type="text" class="quiz-input session4-input" data-correct="8/20" placeholder="Escribe la fracci√≥n" style="width: 100%; max-width: 300px; padding: 12px 15px; font-size: 1.1em; border: 2px solid #ffa726; border-radius: 10px;" />
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #fff8e1); border-left: 5px solid #ffa726; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <label style="font-size: 1.15em; color: #E65100; font-weight: 600; display: block; margin-bottom: 12px;">
                    8. ¬ø¬≤‚ÅÑ‚ÇÑ y ¬≥‚ÅÑ‚ÇÜ son equivalentes? (Escribe "si" o "no")
                </label>
                <input type="text" class="quiz-input session4-input" data-correct="si" placeholder="si / no" style="width: 100%; max-width: 300px; padding: 12px 15px; font-size: 1.1em; border: 2px solid #ffa726; border-radius: 10px;" />
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #fff8e1); border-left: 5px solid #ffa726; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <label style="font-size: 1.15em; color: #E65100; font-weight: 600; display: block; margin-bottom: 12px;">
                    9. Si ‚Åø‚ÅÑ‚Çà es equivalente a ¬Ω, ¬øcu√°nto vale n?
                </label>
                <input type="text" class="quiz-input session4-input" data-correct="4" placeholder="Escribe el n√∫mero" style="width: 100%; max-width: 300px; padding: 12px 15px; font-size: 1.1em; border: 2px solid #ffa726; border-radius: 10px;" />
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #fff8e1); border-left: 5px solid #ffa726; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <label style="font-size: 1.15em; color: #E65100; font-weight: 600; display: block; margin-bottom: 12px;">
                    10. ¬ø‚Å¥‚ÅÑ‚ÇÜ y ¬≤‚ÅÑ‚ÇÉ son equivalentes? (Escribe "si" o "no")
                </label>
                <input type="text" class="quiz-input session4-input" data-correct="si" placeholder="si / no" style="width: 100%; max-width: 300px; padding: 12px 15px; font-size: 1.1em; border: 2px solid #ffa726; border-radius: 10px;" />
            </div>

            <!-- ========== NIVEL 3: AVANZADO ========== -->
            <div style="background: linear-gradient(135deg, #FFEBEE, #FFCDD2); padding: 20px; border-radius: 15px; margin: 30px 0 25px 0; border-left: 8px solid #F44336;">
                <h3 style="color: #C62828; font-size: 1.6em; margin-bottom: 5px; display: flex; align-items: center; gap: 10px;">
                    <span style="background: #F44336; color: white; padding: 8px 18px; border-radius: 10px;">üî¥ NIVEL 3</span>
                    Simplificaci√≥n
                </h3>
                <p style="color: #D32F2F; font-size: 1.1em; margin: 0;">Simplifica hasta la fracci√≥n irreducible</p>
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #ffebee); border-left: 5px solid #ef5350; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <label style="font-size: 1.15em; color: #C62828; font-weight: 600; display: block; margin-bottom: 12px;">
                    11. Simplifica ‚Å∂‚ÅÑ‚Çà a su forma irreducible.
                </label>
                <input type="text" class="quiz-input session4-input" data-correct="3/4" placeholder="Escribe la fracci√≥n simplificada" style="width: 100%; max-width: 300px; padding: 12px 15px; font-size: 1.1em; border: 2px solid #ef5350; border-radius: 10px;" />
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #ffebee); border-left: 5px solid #ef5350; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <label style="font-size: 1.15em; color: #C62828; font-weight: 600; display: block; margin-bottom: 12px;">
                    12. Simplifica ¬π‚Å∞‚ÅÑ‚ÇÅ‚ÇÖ a su forma irreducible.
                </label>
                <input type="text" class="quiz-input session4-input" data-correct="2/3" placeholder="Escribe la fracci√≥n simplificada" style="width: 100%; max-width: 300px; padding: 12px 15px; font-size: 1.1em; border: 2px solid #ef5350; border-radius: 10px;" />
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #ffebee); border-left: 5px solid #ef5350; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <label style="font-size: 1.15em; color: #C62828; font-weight: 600; display: block; margin-bottom: 12px;">
                    13. Simplifica ¬π¬≤‚ÅÑ‚ÇÅ‚Çà a su forma irreducible.
                </label>
                <input type="text" class="quiz-input session4-input" data-correct="2/3" placeholder="Escribe la fracci√≥n simplificada" style="width: 100%; max-width: 300px; padding: 12px 15px; font-size: 1.1em; border: 2px solid #ef5350; border-radius: 10px;" />
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #ffebee); border-left: 5px solid #ef5350; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <label style="font-size: 1.15em; color: #C62828; font-weight: 600; display: block; margin-bottom: 12px;">
                    14. Simplifica ¬≤‚Å∞‚ÅÑ‚ÇÇ‚ÇÖ a su forma irreducible.
                </label>
                <input type="text" class="quiz-input session4-input" data-correct="4/5" placeholder="Escribe la fracci√≥n simplificada" style="width: 100%; max-width: 300px; padding: 12px 15px; font-size: 1.1em; border: 2px solid #ef5350; border-radius: 10px;" />
            </div>

            <div class="quiz-item" style="background: linear-gradient(135deg, #ffffff, #ffebee); border-left: 5px solid #ef5350; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                <label style="font-size: 1.15em; color: #C62828; font-weight: 600; display: block; margin-bottom: 12px;">
                    15. üèÜ RETO FINAL: Simplifica ¬≤‚Å¥‚ÅÑ‚ÇÉ‚ÇÜ a su forma irreducible.
                </label>
                <input type="text" class="quiz-input session4-input" data-correct="2/3" placeholder="Escribe la fracci√≥n simplificada" style="width: 100%; max-width: 300px; padding: 12px 15px; font-size: 1.1em; border: 2px solid #ef5350; border-radius: 10px;" />
            </div>
        </div>

        <!-- BOT√ìN DE VERIFICAR -->
        <div style="text-align: center; margin: 40px 0;">
            <button onclick="submitSession4Quiz()" class="back-button" style="background: linear-gradient(135deg, #2196F3, #1976D2); font-size: 1.5em; padding: 20px 60px; box-shadow: 0 10px 30px rgba(33, 150, 243, 0.5); border: none; cursor: pointer;">
                ‚úÖ Verificar Respuestas
            </button>
        </div>

        <!-- RESULTADOS (oculto inicialmente) -->
        <div id="session4QuizResults" class="quiz-results" style="display: none; background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 40px; border-radius: 25px; margin: 30px 0; border: 4px solid #4CAF50; box-shadow: 0 15px 40px rgba(76, 175, 80, 0.3);">
            <h3 style="color: #2E7D32; font-size: 2em; text-align: center; margin-bottom: 20px;">üìä Resultados</h3>
            <p style="font-size: 1.5em; text-align: center; color: #1B5E20; margin-bottom: 30px;">
                Puntuaci√≥n: <strong id="session4QuizScore" style="font-size: 1.3em; color: #4CAF50;">0/15</strong>
            </p>
            <ul class="result-list" id="session4ResultList" style="list-style: none; padding: 0; max-height: 400px; overflow-y: auto;"></ul>
        </div>

        <!-- BOT√ìN DE COMPLETAR (oculto inicialmente) -->
        <div id="session4CompleteButton" style="display: none; text-align: center; margin-top: 40px; animation: fadeInScale 1s ease-out;">
            <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(139, 195, 74, 0.2)); padding: 30px; border-radius: 25px; border: 3px solid #4CAF50; box-shadow: 0 0 30px rgba(76, 175, 80, 0.5);">
                <h3 style="color: #2E7D32; font-size: 2em; margin-bottom: 20px;">üéâ ¬°Felicidades! Actividad Completada</h3>
                <button class="back-button" onclick="completeSession4(); showScreen('session4Screen');" style="background: linear-gradient(135deg, #4CAF50, #8BC34A); font-size: 1.5em; padding: 25px 60px; box-shadow: 0 15px 40px rgba(76, 175, 80, 0.6), 0 0 25px #4CAF50;">
                    üèÜ ¬°Volver al Men√∫ de Sesi√≥n 4!
                </button>
            </div>
        </div>

        <!-- TIEMPO SUGERIDO -->
        <p style="margin-top: 35px; font-size: 1.15em; color: #1565C0; text-align: center;">
            ‚è±Ô∏è Tiempo Sugerido: <strong>15-20 minutos</strong>
        </p>
    </div>
</div>


<!-- ========== JUEGO ARCADE: CULEBRITA FRACCIONARIA ========== -->
<div class="screen" id="session4ArcadeScreen">
    <div class="content-screen" style="background: linear-gradient(180deg, rgba(156,39,176,0.05) 0%, rgba(171,71,188,0.08) 100%); padding: 15px;">
        <button class="back-button" onclick="exitSnakeGame(); showScreen('session4Screen')"> ‚Üê Volver a Sesi√≥n 4 </button>
        
        <!-- ========== PANTALLA DE INICIO DEL JUEGO ========== -->
        <div id="snakeStartScreen" style="text-align: center; padding: 30px 15px;">
            <!-- T√≠tulo animado -->
            <div style="margin-bottom: 20px;">
                <span style="font-size: 4em; display: inline-block; animation: snakeBounce 1s infinite;">üêç</span>
            </div>
            <h2 style="font-family: 'Segoe UI', sans-serif; font-size: 2.2em; font-weight: 900; background: linear-gradient(135deg, #9C27B0, #E91E63, #FF5722); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 10px; text-shadow: none;">
                CULEBRITA FRACCIONARIA
            </h2>
            <p style="font-size: 1.1em; color: #7B1FA2; margin-bottom: 25px;">¬°Domina las fracciones mientras juegas!</p>
            
            <!-- Instrucciones -->
            <div style="background: linear-gradient(135deg, #F3E5F5, #E1BEE7); padding: 25px; border-radius: 20px; max-width: 500px; margin: 0 auto 25px auto; border: 3px solid #9C27B0; box-shadow: 0 10px 30px rgba(156, 39, 176, 0.25);">
                <h3 style="color: #6A1B9A; font-size: 1.3em; margin-bottom: 15px;">üìã ¬øC√≥mo jugar?</h3>
                <div style="text-align: left; font-size: 1em; color: #4A148C; line-height: 1.8;">
                    <p style="margin-bottom: 10px;">üéØ <strong>Objetivo:</strong> Come la respuesta CORRECTA a cada operaci√≥n de fracciones</p>
                    <p style="margin-bottom: 10px;">‚úÖ <strong>Correcto:</strong> Tu culebra crece y avanzas</p>
                    <p style="margin-bottom: 10px;">‚ùå <strong>Incorrecto/Choque:</strong> Pierdes una vida</p>
                    <p style="margin-bottom: 10px;">üíÄ <strong>5 vidas:</strong> Si las pierdes todas, ¬°Game Over!</p>
                    <p>üèÜ <strong>Meta:</strong> ¬°Completa los 8 niveles!</p>
                </div>
            </div>
            
            <!-- Controles -->
            <!-- Controles -->
<div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 20px; border-radius: 15px; max-width: 500px; margin: 0 auto 25px auto; border: 3px solid #4CAF50;">
    <h4 style="color: #2E7D32; margin-bottom: 10px;">üéÆ Controles</h4>
    <p style="color: #1B5E20; font-size: 0.95em;">
        <strong>PC:</strong> Flechas del teclado ‚Üë‚Üì‚Üê‚Üí<br>
        <strong>Celular:</strong> Gira horizontal + desliza el dedo üëÜüì±
    </p>
</div>
            
            <!-- Tip para grupos -->
            <div style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 15px 20px; border-radius: 15px; max-width: 500px; margin: 0 auto 30px auto; border: 3px solid #FF9800;">
                <p style="color: #E65100; font-size: 1em;">
                    üí° <strong>Tip de equipo:</strong> ¬°Uno controla la culebra mientras los dem√°s calculan la respuesta correcta!
                </p>
            </div>
            
            <!-- Bot√≥n de inicio -->
            <button onclick="startSnakeGame()" style="background: linear-gradient(135deg, #9C27B0, #E91E63); color: white; border: none; padding: 20px 50px; font-size: 1.5em; font-weight: 700; border-radius: 50px; cursor: pointer; box-shadow: 0 8px 25px rgba(156, 39, 176, 0.4); transition: all 0.3s; animation: pulseSnakeBtn 2s infinite;">
                üéÆ ¬°JUGAR!
            </button>
        </div>
        
        <!-- ========== PANTALLA DEL JUEGO ========== -->
        <div id="snakeGameScreen" style="display: none; text-align: center; padding: 10px;">
            
            <!-- HUD Superior -->
            <div id="snakeHUD" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; margin-bottom: 10px; padding: 15px; background: linear-gradient(135deg, #4A148C, #7B1FA2); border-radius: 15px; box-shadow: 0 5px 20px rgba(74, 20, 140, 0.4);">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 1.3em;">üèÜ</span>
                    <span style="color: #FFD700; font-weight: 700; font-size: 1.1em;">Nivel: <span id="snakeLevel">1</span>/8</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 1.3em;">‚≠ê</span>
                    <span style="color: #00E5FF; font-weight: 700; font-size: 1.1em;">Puntos: <span id="snakeScore">0</span></span>
                </div>
                <div id="snakeLives" style="display: flex; gap: 5px;">
                    <span class="snakeHeart">‚ù§Ô∏è</span>
                    <span class="snakeHeart">‚ù§Ô∏è</span>
                    <span class="snakeHeart">‚ù§Ô∏è</span>
                    <span class="snakeHeart">‚ù§Ô∏è</span>
                    <span class="snakeHeart">‚ù§Ô∏è</span>
                </div>
            </div>
            
          
            
            <!-- Canvas del juego -->
            <div style="position: relative; display: inline-block;">
                <canvas id="snakeCanvas" style="background: linear-gradient(135deg, #1a1a2e, #16213e); border-radius: 15px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), inset 0 0 60px rgba(156, 39, 176, 0.2); border: 4px solid #9C27B0;"></canvas>
                
                <!-- Overlay de pausa/mensajes -->
                <div id="snakeOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); border-radius: 15px; display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 10;">
                    <div id="snakeOverlayContent"></div>
                </div>
            </div>
            
           <!-- Indicador de controles t√°ctiles para m√≥vil -->
<div id="snakeTouchControls" style="margin-top: 10px; display: none;">
    <p style="color: #9C27B0; font-size: 1em; text-align: center;">üëÜ Desliza sobre el juego para mover</p>
</div>
            
               </div>
        
        <!-- ========== PANTALLA DE VICTORIA ========== -->
        <div id="snakeWinScreen" style="display: none; text-align: center; padding: 40px 20px;">
            <div style="font-size: 5em; margin-bottom: 20px; animation: snakeBounce 0.5s infinite;">üèÜ</div>
            <h2 style="font-size: 2.5em; color: #FFD700; text-shadow: 0 0 20px rgba(255, 215, 0, 0.5); margin-bottom: 15px;">¬°VICTORIA!</h2>
            <p style="font-size: 1.3em; color: #4CAF50; margin-bottom: 10px;">¬°Completaste los 8 niveles!</p>
            <p style="font-size: 1.5em; color: #00E5FF; margin-bottom: 30px;">Puntuaci√≥n final: <span id="snakeFinalScore" style="font-weight: 700;">0</span></p>
            
            <div style="background: linear-gradient(135deg, #E8F5E9, #C8E6C9); padding: 25px; border-radius: 20px; max-width: 400px; margin: 0 auto 30px auto; border: 3px solid #4CAF50;">
                <p style="color: #2E7D32; font-size: 1.1em; line-height: 1.6;">
                    üéâ ¬°Excelente trabajo!<br>
                    Demostraste que dominas las fracciones.
                </p>
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button onclick="resetSnakeGame()" style="background: linear-gradient(135deg, #9C27B0, #E91E63); color: white; border: none; padding: 15px 35px; font-size: 1.2em; font-weight: 700; border-radius: 30px; cursor: pointer; box-shadow: 0 5px 20px rgba(156, 39, 176, 0.4);">
                    üîÑ Jugar de Nuevo
                </button>
                <button onclick="exitSnakeGame(); showScreen('session4Screen')" style="background: linear-gradient(135deg, #607D8B, #455A64); color: white; border: none; padding: 15px 35px; font-size: 1.2em; font-weight: 700; border-radius: 30px; cursor: pointer; box-shadow: 0 5px 20px rgba(96, 125, 139, 0.4);">
                    ‚Üê Volver
                </button>
            </div>
        </div>
        
        <!-- ========== PANTALLA DE GAME OVER ========== -->
        <div id="snakeGameOverScreen" style="display: none; text-align: center; padding: 40px 20px;">
            <div style="font-size: 5em; margin-bottom: 20px; animation: snakeShake 0.5s;">üíÄ</div>
            <h2 style="font-size: 2.5em; color: #F44336; text-shadow: 0 0 20px rgba(244, 67, 54, 0.5); margin-bottom: 15px;">GAME OVER</h2>
            <p style="font-size: 1.2em; color: #FFCDD2; margin-bottom: 10px;">Llegaste al nivel <span id="snakeGameOverLevel" style="font-weight: 700; color: #FFD700;">1</span></p>
            <p style="font-size: 1.3em; color: #00E5FF; margin-bottom: 30px;">Puntuaci√≥n: <span id="snakeGameOverScore" style="font-weight: 700;">0</span></p>
            
            <div style="background: linear-gradient(135deg, #FFEBEE, #FFCDD2); padding: 25px; border-radius: 20px; max-width: 400px; margin: 0 auto 30px auto; border: 3px solid #F44336;">
                <p style="color: #C62828; font-size: 1.1em; line-height: 1.6;">
                    üí™ ¬°No te rindas!<br>
                    Las fracciones se dominan con pr√°ctica.
                </p>
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button onclick="resetSnakeGame()" style="background: linear-gradient(135deg, #4CAF50, #8BC34A); color: white; border: none; padding: 15px 35px; font-size: 1.2em; font-weight: 700; border-radius: 30px; cursor: pointer; box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);">
                    üîÑ Intentar de Nuevo
                </button>
                <button onclick="exitSnakeGame(); showScreen('session4Screen')" style="background: linear-gradient(135deg, #607D8B, #455A64); color: white; border: none; padding: 15px 35px; font-size: 1.2em; font-weight: 700; border-radius: 30px; cursor: pointer; box-shadow: 0 5px 20px rgba(96, 125, 139, 0.4);">
                    ‚Üê Volver
                </button>
            </div>
        </div>
    </div>
</div>


</div>

<!-- ========== CONTENEDOR FULLSCREEN PARA EL JUEGO (M√ìVIL) ========== -->
<div id="snakeFullscreenContainer" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #1a1a2e, #16213e); z-index: 9999; overflow: hidden;">
    <button onclick="exitSnakeFullscreen()" style="position: absolute; top: 10px; right: 10px; z-index: 10001; background: rgba(244, 67, 54, 0.9); color: white; border: none; padding: 8px 15px; border-radius: 20px; font-size: 1em; font-weight: 700; cursor: pointer;">‚úï Salir</button>
    <div style="position: absolute; top: 0; left: 0; right: 0; display: flex; justify-content: space-around; align-items: center; padding: 8px 15px; background: linear-gradient(135deg, rgba(74, 20, 140, 0.95), rgba(123, 31, 162, 0.95)); z-index: 10000;">
        <div><span>üèÜ</span><span style="color: #FFD700; font-weight: 700; font-size: 0.95em;">Nv: <span id="snakeLevelFS">1</span>/8</span></div>
        <div><span>‚≠ê</span><span style="color: #00E5FF; font-weight: 700; font-size: 0.95em;"><span id="snakeScoreFS">0</span></span></div>
        <div id="snakeLivesFS" style="display: flex; gap: 3px;"><span class="snakeHeartFS">‚ù§Ô∏è</span><span class="snakeHeartFS">‚ù§Ô∏è</span><span class="snakeHeartFS">‚ù§Ô∏è</span><span class="snakeHeartFS">‚ù§Ô∏è</span><span class="snakeHeartFS">‚ù§Ô∏è</span></div>
    </div>
    <canvas id="snakeCanvasFS" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"></canvas>
    <div id="snakeOverlayFS" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 10002;">
        <div id="snakeOverlayContentFS" style="text-align: center; padding: 20px;"></div>
    </div>
</div>

    <div class="screen" id="session5Screen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('sectionsScreen')">‚Üê Volver al mapa</button>
            <h2>üé® Sesi√≥n 5: Fracciones (II)</h2>
            <p>Contenido de la Sesi√≥n 5 estar√° disponible despu√©s de completar la Sesi√≥n 4.</p>
        </div>
    </div>

    <div class="screen" id="session6Screen">
        <div class="content-screen">
            <button class="back-button" onclick="showScreen('sectionsScreen')">‚Üê Volver al mapa</button>
            <h2>üèÜ Sesi√≥n 6: Fracciones (III)</h2>
            <p>Contenido de la Sesi√≥n 6 estar√° disponible despu√©s de completar la Sesi√≥n 5.</p>
        </div>
    </div>

    <div class="footer">
        <div class="footer-info">
            <p>Unidad Did√°ctica Gamificada - Misi√≥n Z</p>
            <p>¬© 2026 | Proyecto de Investigaci√≥n-Acci√≥n Educativa</p>
            <p>Matem√°ticas 8¬∞</p>
            <p style="margin-top: 10px; font-weight: 300;">Tu participaci√≥n es invaluable.</p>
        </div>
    </div>

</div> <script>
        // === DATOS DE JUEGO ===
        let completedSections = JSON.parse(localStorage.getItem('completedSections')) || [];
        const TOTAL_SECTIONS = 6;
// === NUEVO: Progreso interno de sub-retos (activityProgress) ===
// Estructura: { sesion1: 5, sesion2: 2, ... }
let activityProgress = JSON.parse(localStorage.getItem('activityProgress')) || {
    sesion1: 0, 
    sesion2: 0,
    sesion3: 0,
    sesion4: 0,
    sesion5: 0,
    sesion6: 0
};


       // N√∫meros para el juego de Drag & Drop
    const DRAG_NUMBERS = ['+5', '-12', '0', '+25', '-8', '-1', '+1', '-50', '+100', '-3', '+4', '-9', '6', '-7', '15',
                            '‚àö9', '-6/3', '4.0', '7.00', '8/4', '-3/1', // Enteros
                            '‚àö2', '1/2', '-3/4', '0.5', '4.75', '-2.5','-5.485784']; // No Enteros
    const CORRECT_DRAG_COUNT = DRAG_NUMBERS.length;
        let correctDrops = 0;
        
        // =================================================
        // === EFECTOS VISUALES Y ANIMACIONES ===
        // =================================================

        // === CREAR ESTRELLAS QUE CAEN (Aumentado a 40) ===
        function createStars() {
            const starsContainer = document.getElementById('stars-container');
            const starEmojis = ['‚≠ê', '‚ú®', 'üåü', '‚òÑÔ∏è'];
            const isMobile = window.innerWidth <= 768;
            const starCount = isMobile ? 20 : 40;

            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.textContent = starEmojis[Math.floor(Math.random() * starEmojis.length)];
                
                // Posici√≥n inicial aleatoria
                star.style.left = Math.random() * 100 + '%';
                star.style.top = -100 + 'px'; // Inicia fuera de la vista
                
                // Propiedades de la animaci√≥n
                star.style.animationDuration = (5 + Math.random() * 5) + 's';
                star.style.animationDelay = (Math.random() * 10) + 's';
                star.style.fontSize = (15 + Math.random() * 15) + 'px';
                starsContainer.appendChild(star);
                
                // Remover despu√©s de la duraci√≥n de la animaci√≥n
                setTimeout(() => star.remove(), 10000); 
            }
        }

        // === CREAR PART√çCULAS FLOTANTES (Aumentado a 60) ===
        function createParticles() {
            const particles = document.getElementById('particles');
            const isMobile = window.innerWidth <= 768;
            const particleCount = isMobile ? 30 : 60;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 15) + 's';
                particles.appendChild(particle);
            }
        }

        // === REGLA 2: GENERAR S√çMBOLOS MATEM√ÅTICOS FLOTANTES ===
        function createMathSymbols() {
            const wrapper = document.getElementById('mathSymbolsWrapper');
            if (!wrapper) return; // Asegurar que el contenedor existe
            
            const symbols = ['‚àë', '‚àö', 'œÄ', '‚àû', 'Œî', 'Œ∏', '√ó', '√∑', '‚à´', '‚â†'];
            const numSymbols = symbols.length;

            for (let i = 0; i < numSymbols; i++) {
                const symbol = document.createElement('span');
                symbol.className = 'math-symbol';
                symbol.textContent = symbols[i];
                
                // Posicionamiento alrededor del control (relativo al logo-container)
                const angle = (i / numSymbols) * 2 * Math.PI;
                const radius = 120; // Distancia desde el centro del logo
                const x = radius * Math.cos(angle);
                const y = radius * Math.sin(angle);
                
                symbol.style.left = `calc(50% + ${x}px)`;
                symbol.style.top = `calc(50% + ${y}px)`;
                
                // Animaci√≥n personalizada
                symbol.style.animationDelay = (i * 0.8) + 's';
                symbol.style.animationDuration = (7 + Math.random() * 3) + 's'; // Variaci√≥n de 7s a 10s
                symbol.style.transform = `translate(-50%, -50%)`;
                symbol.style.fontSize = (1.5 + Math.random() * 1) + 'em'; // Tama√±os variados (1.5em a 2.5em)
                
                wrapper.appendChild(symbol);
            }
        }

        // === CREAR CONFETI AL COMPLETAR SESI√ìN ===
        function createConfetti() {
            const colors = ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#00f2fe', '#FFD700', '#FF69B4'];
            const isMobile = window.innerWidth <= 768;
            const confettiCount = isMobile ? 30 : 50;

            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = (Math.random() * 0.5) + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }


        // =================================================
        // === L√ìGICA DE NAVEGACI√ìN Y PROGRESO ===
        // =================================================

       // === CAMBIAR DE PANTALLA ===
function showScreen(screenId) {
    // SIEMPRE ocultar el contenedor fullscreen del snake al cambiar de pantalla
    const snakeFS = document.getElementById('snakeFullscreenContainer');
    if (snakeFS) {
        snakeFS.style.display = 'none';
    }
    
    document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
    });
    document.getElementById(screenId).classList.add('active');

    // Scroll al inicio
    window.scrollTo({ top: 0, behavior: 'smooth' });

    // Mostrar badge de progreso solo en pantalla de secciones
    if (screenId === 'sectionsScreen') {
        document.getElementById('progressBadge').style.display = 'block';
        updateProgress();
    } else {
        document.getElementById('progressBadge').style.display = 'none';
    }

   // Inicializar el juego de Drag & Drop si se entra a esa pantalla
    if (screenId === 'session1DragScreen') {
        initDragGame();
    }

    // === NUEVO: Actualizar estado de los sub-retos al entrar a una sesi√≥n ===
    if (screenId.includes('session1')) {
        updateSession1Nav();
    }
    if (screenId.includes('session2')) {
        updateSession2Nav();
    }
    if (screenId.includes('session3')) {
        updateSession3Nav();
    }
    if (screenId === 'session4Screen') {
        updateSession4LockState();
    }
    // =====================================================================
}
// === NUEVO: L√ìGICA DE BLOQUEO INTERNO PARA SESI√ìN 1 ===
// [nombre de la pantalla de sub-reto] : [√≠ndice del sub-reto]
const session1Map = {
    'session1TheoryScreen': 1,
    'session1DragScreen': 2,
    'session1ChallengeScreen': 3,
    'session1OperationsScreen': 4,
    'session1QuizScreen': 5 
};

function updateSession1Nav() {
    const currentProgress = activityProgress.sesion1;
    
    // Tarjetas de navegaci√≥n del fondo (session1-nav-grid)
    document.querySelectorAll('#session1Screen .session-nav-card').forEach(card => {
        const targetScreen = card.getAttribute('onclick').match(/showScreen\('([^']+)'/)[1];
        const requiredIndex = session1Map[targetScreen]; // El n√∫mero de reto (1, 2, 3...)
        
        // Bloqueo: El reto debe ser igual o menor que el progreso actual + 1
        const isAvailable = requiredIndex <= currentProgress + 1;
        const isCompleted = requiredIndex <= currentProgress;
        
        card.classList.remove('locked', 'unlocked');
        card.onclick = null; // Quitar el onclick original para reasignar la l√≥gica

        if (isCompleted) {
            card.classList.add('unlocked');
            card.onclick = () => showScreen(targetScreen);
         let h4 = card.querySelector('h4');
            h4.textContent = h4.textContent.replace(' ‚úÖ', ''); // ‚¨ÖÔ∏è LIMPIA (QUITA) el chulo existente
            h4.textContent += ' ‚úÖ';                               // ‚¨ÖÔ∏è AGREGA (PONE) un √∫nico chulo
            // ==================================================

        } else if (isAvailable) {
            card.classList.add('unlocked'); // Usamos 'unlocked' para que no tenga el efecto de bloqueo visual
            card.onclick = () => showScreen(targetScreen);
        } else {
            card.classList.add('locked');
            card.onclick = () => alert(`üîí Debes completar el paso anterior (${requiredIndex - 1}) antes de acceder a este.`);
        }
    });
    
    // Actualizar tambi√©n la lista de la ruta de aprendizaje
    document.querySelectorAll('#session1Screen .learning-list-item').forEach(item => {
        const targetScreen = item.getAttribute('onclick').match(/showScreen\('([^']+)'/)[1];
        const requiredIndex = session1Map[targetScreen];
        const isAvailable = requiredIndex <= currentProgress + 1;
        
        item.classList.remove('locked-item');
        if (!isAvailable) {
            item.classList.add('locked-item');
            item.onclick = () => alert(`üîí Debes completar el paso anterior (${requiredIndex - 1}) antes de acceder a este.`);
        }
    });
}

// === L√ìGICA DE BLOQUEO INTERNO PARA SESI√ìN 2 ===
const session2Map = {
    'session2TheoryScreen': 1,
    'session2GameClassScreen': 2,
    'session2ArcadeScreen': 3,
    'session2HierarchyScreen': 4,
    'session2PracticeScreen': 5 
};

function updateSession2Nav() {
    const currentProgress = activityProgress.sesion2;
    
    // Tarjetas de navegaci√≥n del fondo (session1-nav-grid)
    document.querySelectorAll('#session2Screen .session-nav-card').forEach(card => {
        const targetScreen = card.getAttribute('onclick').match(/showScreen\('([^']+)'/)[1];
        const requiredIndex = session2Map[targetScreen];
        
        const isAvailable = requiredIndex <= currentProgress + 1;
        const isCompleted = requiredIndex <= currentProgress;
        
        card.classList.remove('locked', 'unlocked');
        card.onclick = null; // Quitar el onclick original para reasignar la l√≥gica

        if (isCompleted) {
            card.classList.add('unlocked');
            card.onclick = () => showScreen(targetScreen);
            
// üõë C√ìDIGO CORREGIDO PARA EVITAR CHULOS DUPLICADOS üõë
            let h4 = card.querySelector('h4');
            h4.textContent = h4.textContent.replace(' ‚úÖ', ''); // ‚¨ÖÔ∏è LIMPIA (QUITA) el chulo existente
            h4.textContent += ' ‚úÖ';                               // ‚¨ÖÔ∏è AGREGA (PONE) un √∫nico chulo
            // ==================================================
        


        } else if (isAvailable) {
            card.classList.add('unlocked');
            card.onclick = () => showScreen(targetScreen);
        } else {
            card.classList.add('locked');
            card.onclick = () => alert(`üîí Debes completar el paso anterior (${requiredIndex - 1}) antes de acceder a este.`);
        }
    });
    
    // Actualizar tambi√©n la lista de la ruta de aprendizaje
    document.querySelectorAll('#session2Screen .learning-list-item').forEach(item => {
        const targetScreen = item.getAttribute('onclick').match(/showScreen\('([^']+)'/)[1];
        const requiredIndex = session2Map[targetScreen];
        const isAvailable = requiredIndex <= currentProgress + 1;
        
        item.classList.remove('locked-item');
        if (!isAvailable) {
            item.classList.add('locked-item');
            item.onclick = () => alert(`üîí Debes completar el paso anterior (${requiredIndex - 1}) antes de acceder a este.`);
        }
    });
}

// === NUEVO: MARCADOR GENERAL DE SUB-RETO COMPLETADO ===
function completeSubActivity(sessionNum, activityIndex) {
    const sessionKey = `sesion${sessionNum}`;
    
    // Solo actualiza si el √≠ndice que se intenta completar es mayor al progreso actual
    if (activityProgress[sessionKey] < activityIndex) {
        activityProgress[sessionKey] = activityIndex;
        localStorage.setItem('activityProgress', JSON.stringify(activityProgress));
        console.log(`‚úÖ Actividad ${activityIndex} de Sesi√≥n ${sessionNum} marcada como completada.`);
        
        // Recarga el estado de navegaci√≥n para reflejar el desbloqueo
        if (sessionNum === 1) updateSession1Nav();
        if (sessionNum === 2) updateSession2Nav();
        if (sessionNum === 3) updateSession3LockState();
        if (sessionNum === 4) updateSession4LockState();
    }
}
        // === ACTUALIZAR PROGRESO ===
        function updateProgress() {
            const total = TOTAL_SECTIONS;
            const completed = completedSections.length;
            const percentage = Math.round((completed / total) * 100);

            document.getElementById('progressText').textContent = `${completed}/${total} Completadas (${percentage}%)`;
            document.getElementById('progressBarFill').style.width = `${percentage}%`;

            // === BLOQUE DE C√ìDIGO ACTUALIZADO PARA updateProgress() ===

            // Actualizar estado visual de las tarjetas de sesi√≥n
            document.querySelectorAll('.section-card').forEach(card => {
                const sectionNum = parseInt(card.dataset.section);
                const isCompleted = completedSections.includes(sectionNum);
                const isAvailable = sectionNum === 1 || completedSections.includes(sectionNum - 1);
                const statusDiv = card.querySelector('.section-status'); // Contenedor del estado completo
                const titleDiv = card.querySelector('.section-title');
                const lockIcon = card.querySelector('.lock-icon');

                card.classList.remove('locked', 'unlocked');
                card.onclick = null;
                titleDiv.style.opacity = 1;

                if (isCompleted) {
                    card.classList.add('unlocked');
                    // Reemplazamos el HTML del status para que diga COMPLETADA
                    statusDiv.innerHTML = '<span style="color: #2ecc71;">‚úÖ</span> Completada';
                    statusDiv.style.color = '#2ecc71'; 
                    lockIcon && lockIcon.remove();
                    card.onclick = () => enterSection(sectionNum);
                } else if (isAvailable) {
                    // Reemplazamos el HTML del status para que diga DISPONIBLE
                    statusDiv.innerHTML = '<span style="color: #FFD700;">‚óè</span> Disponible - ¬°Comienza ahora!';
                    statusDiv.style.color = '#FFD700';
                    lockIcon && lockIcon.remove();
                    card.onclick = () => enterSection(sectionNum);
                } else {
                    card.classList.add('locked');
                    // Reemplazamos el HTML del status para que diga BLOQUEADA
                    statusDiv.innerHTML = '<span style="color: #e74c3c;">üîí</span> Bloqueada - Completa la sesi√≥n anterior.';
                    statusDiv.style.color = '#e74c3c';
                    if (!lockIcon) { 
                        const newLock = document.createElement('div');
                        newLock.className = 'lock-icon';
                        newLock.textContent = 'üîí';
                        card.appendChild(newLock);
                    }
                }
            });


// üëá AGREGA ESTO AQU√ç üëá



// Actualizar estado del Postest
            const postestCard = document.getElementById('postestCard');
            if (postestCard) {
                if (completedSections.length === TOTAL_SECTIONS) {
                    postestCard.classList.remove('postest-locked');
                    postestCard.querySelector('.card-description').textContent = '‚úÖ ¬°Todas las sesiones completadas! Realiza tu evaluaci√≥n final.';
                } else {
                    postestCard.classList.add('postest-locked');
                    const remaining = TOTAL_SECTIONS - completedSections.length;
                    if (remaining === TOTAL_SECTIONS) {
                        // Si no ha completado ninguna sesi√≥n
                        postestCard.querySelector('.card-description').textContent = `üîí Bloqueado - Completa las ${TOTAL_SECTIONS} sesiones para desbloquear.`;
                    } else if (remaining === 1) {
                        // Si falta solo 1 sesi√≥n
                        postestCard.querySelector('.card-description').textContent = 'üîí Bloqueado - Completa la √∫ltima sesi√≥n para desbloquear.';
                    } else {
                        // Si faltan 2 o m√°s sesiones
                        postestCard.querySelector('.card-description').textContent = `üîí Bloqueado - Completa las ${remaining} sesiones restantes.`;
                    }
                }
            }  }

      // === ENTRAR A SESI√ìN (Corregido) ===
function enterSection(sectionNum) {
    // Sesi√≥n 1
    if (sectionNum === 1) {
        showScreen('session1Screen');
        return;
    }
    
    // Sesi√≥n 2
    if (sectionNum === 2) {
        showScreen('session2Screen');
        return;
    }
    
    // Sesi√≥n 3
    if (sectionNum === 3) {
        showScreen('session3Screen');
        return;
    }
    
    // Sesi√≥n 4
    if (sectionNum === 4) {
        showScreen('session4Screen');
        return;
    }
    
    // Si la sesi√≥n est√° completada, permitir entrar
    if (completedSections.includes(sectionNum)) {
        showScreen(`session${sectionNum}Screen`); 
        return;
    }

    // Comportamiento por defecto para sesiones 5 y 6 (a√∫n no implementadas)
    alert(`¬°Entrando a la Sesi√≥n ${sectionNum}! ‚ú®\n\n(Esta sesi√≥n estar√° disponible pr√≥ximamente.)`);

    // Simulaci√≥n de completado para testear
    if (confirm('¬øMarcar esta sesi√≥n como completada? üéâ')) {
        if (!completedSections.includes(sectionNum)) {
            completedSections.push(sectionNum);
            localStorage.setItem('completedSections', JSON.stringify(completedSections));
            createConfetti();
            updateProgress();
        }
    }
}


        // =================================================
        // === L√ìGICA DEL DRAG & DROP ===
        // =================================================

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function initDragGame() {
            const pool = document.getElementById('dragPool');
            pool.innerHTML = '';
            correctDrops = 0;
            document.getElementById('completionMessage').style.display = 'none';

            // Mezclar y crear tokens
            const shuffledNumbers = shuffleArray([...DRAG_NUMBERS]);
            shuffledNumbers.forEach(num => {
                const token = document.createElement('div');
                token.className = 'token';
                token.textContent = num;
                token.id = 'token-' + num;
                token.draggable = true;
                token.setAttribute('data-value', num);
                token.addEventListener('dragstart', dragStart);
                pool.appendChild(token);
            });

            // Restablecer dropzones
            document.getElementById('dropPositivos').innerHTML = '<h3>Enteros Positivos (‚Ñ§‚Å∫)</h3><p style="color: #27ae60; font-weight: 700;">(N√∫meros mayores que 0)</p>';
            document.getElementById('dropNegativos').innerHTML = '<h3>Enteros Negativos (‚Ñ§‚Åª)</h3><p style="color: #e74c3c; font-weight: 700;">(N√∫meros menores que 0)</p>';
            document.getElementById('dropPositivos').classList.remove('drag-over', 'correct-zone');
            document.getElementById('dropNegativos').classList.remove('drag-over', 'correct-zone');
        }

        function dragStart(event) {
            event.dataTransfer.setData('text/plain', event.target.id);
            setTimeout(() => {
                event.target.classList.add('dragging');
            }, 0);
        }

        function dragOver(event) {
            event.preventDefault();
            const dropzone = event.target.closest('.dropzone');
            if (dropzone) {
                dropzone.classList.add('drag-over');
            }
        }

        function dragLeave(event) {
            const dropzone = event.target.closest('.dropzone');
            if (dropzone) {
                dropzone.classList.remove('drag-over');
            }
        }
// === CONSTANTES PARA CLASIFICACI√ìN DE N√öMEROS ===
const PI_SYMBOL = 'œÄ';
// Identifica cualquier patr√≥n que termine en '...' como peri√≥dico/no peri√≥dico
const RE_PERIODIC_DECIMAL = /^\-?\d+(\.\d+\.\.\.)$/; 
const RE_PI = /œÄ/;
// =================================================

// Helper para evaluar si un token (expresi√≥n) resulta en un n√∫mero entero
function isTokenInteger(tokenText) {
    const text = tokenText.replace(/\s/g, '');

    // 1. **NUEVO BLOQUE DE RECHAZO:** Si es Pi, Decimal Peri√≥dico, o la ra√≠z de 2, NO es entero.
    if (RE_PI.test(text) || RE_PERIODIC_DECIMAL.test(text) || text === '‚àö2') {
        return false;
    }

    // 2. Ra√≠z Cuadrada (e.g., ‚àö9, ‚àö2)
    const sqrtMatch = text.match(/‚àö(\-?\d+(\.\d+)?)/);
    if (sqrtMatch) {
        const number = parseFloat(sqrtMatch[1]);
        if (number < 0) return false;
        const sqrtResult = Math.sqrt(number);
        return Number.isInteger(sqrtResult);
    }

    // 3. Fracci√≥n (e.g., -6/3, 1/2)
    const fractionMatch = text.match(/^(-?\d+)\/(-?\d+)$/);
    if (fractionMatch) {
        const numerator = parseInt(fractionMatch[1]);
        const denominator = parseInt(fractionMatch[2]);
        if (denominator === 0) return false;
        const divisionResult = numerator / denominator;
        return Number.isInteger(divisionResult);
    }

    // 4. Decimal/Entero Simple
    const numberValue = parseFloat(text);
    // Maneja NaN (ej: texto no num√©rico) y verifica si es un entero exacto
    return !isNaN(numberValue) && Number.isInteger(numberValue);
}

// Helper para calcular el valor num√©rico para la verificaci√≥n de signo
function getTokenValue(tokenText) {
    const text = tokenText.replace(/\s/g, '');
    const sqrtMatch = text.match(/‚àö(\-?\d+(\.\d+)?)/);
    const fractionMatch = text.match(/^(-?\d+)\/(-?\d+)$/);

    // [NUEVO] Si es Pi
    if (RE_PI.test(text)) return Math.PI; 
    
    if (sqrtMatch) return Math.sqrt(parseFloat(sqrtMatch[1]));
    if (fractionMatch) return parseInt(fractionMatch[1]) / parseInt(fractionMatch[2]);
    
    // [NUEVO] Para decimales que terminan en '...'
    const periodicMatch = text.match(RE_PERIODIC_DECIMAL);
    if (periodicMatch) {
        return parseFloat(text.replace('...', '')); 
    }
    
    return parseFloat(text);
}

function drop(event) {
    event.preventDefault();
    const data = event.dataTransfer.getData('text/plain');
    const token = document.getElementById(data);
    const dropzone = event.target.closest('.dropzone');

    if (!dropzone) return;

    dropzone.classList.remove('drag-over');

    const tokenValueText = token.getAttribute('data-value');
    
    // Paso 1: Usar los helpers para evaluar el valor real y el tipo
    const tokenValue = getTokenValue(tokenValueText);
    const isInteger = isTokenInteger(tokenValueText);

    let isCorrect = false;
    const targetId = dropzone.id;

    // L√≥gica de Clasificaci√≥n ESTRICTA
    if (targetId === 'dropPositivos') {
        // Correcto si: Es Entero Y Positivo
        if (isInteger && tokenValue > 0) {
            isCorrect = true;
        }
    } else if (targetId === 'dropNegativos') {
        // Correcto si: Es Entero Y Negativo
        if (isInteger && tokenValue < 0) {
            isCorrect = true;
        }
    } else if (targetId === 'dropNoEnteros') {
        // Correcto si: NO es Entero
        if (!isInteger) {
            isCorrect = true;
        }
    } else {
        // Bloquear drop en zonas que no son dropzone
        return;
    }

    // L√≥gica de movimiento y puntuaci√≥n
    if (isCorrect) {
        if (token.parentNode !== dropzone) { // Solo contar si se mueve a una nueva zona
            if (token.parentNode.id !== 'dragPool') {
                // Si viene de otra dropzone, lo devolvemos al pool para evitar errores
                document.getElementById('dragPool').appendChild(token);
                // El contador de correctas se ajustar√° al devolverlo al pool y luego contarlo.
            }
            
            // Proceso de movimiento final
            dropzone.appendChild(token);
            token.classList.add('correct');
            token.setAttribute('draggable', 'false');
            
            // Conteo de aciertos
            correctDrops++;
            
            // Animaci√≥n y mensaje
            showCorrectFeedback(dropzone);
            
            if (correctDrops === totalTokens) {
                showCompletionMessage();
            }
        }
    } else {
        // Si es incorrecto, lo devuelve al dragPool
        showErrorFeedback(dropzone);
        document.getElementById('dragPool').appendChild(token);
        token.classList.remove('correct');
        token.setAttribute('draggable', 'true');
    }
    
    token.classList.remove('dragging');
}

        function checkDragCompletion() {
            const message = document.getElementById('completionMessage');

            if (correctDrops >= CORRECT_DRAG_COUNT) {
                // Mensaje de finalizaci√≥n con 150 puntos
                message.innerHTML = 'üéâ <strong>¬°Clasificaci√≥n completada!</strong> Puntos obtenidos: 150. Tus puntos se acumulan en la Misi√≥n Z.';
                message.style.display = 'block';
                createConfetti();
            }
        }

        // CSS Keyframe para la vibraci√≥n (A√±adido din√°micamente)
        const style = document.createElement('style');
        style.type = 'text/css';
        style.innerHTML += '@keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }';
        document.getElementsByTagName('head')[0].appendChild(style);

        // =================================================
        // === L√ìGICA DEL QUIZ ===
        // =================================================
        function submitQuiz(sectionNum) {
            const inputs = document.querySelectorAll('#session1QuizScreen .quiz-input');
            const resultList = document.getElementById('resultList');
            const resultsDiv = document.getElementById('quizResults');
            let correctCount = 0;
            let totalQuestions = 0;

            resultList.innerHTML = '';
            
            inputs.forEach((input, index) => {
                const userAnswer = input.value.trim();
                // Normaliza la respuesta correcta (ej: elimina el '+' de '+10')
                const correctAnswer = input.getAttribute('data-correct').trim();
                const questionNumber = index + 1;
                
                // Normaliza la respuesta del usuario para coincidir con la data-correct
                const normalizedUserAnswer = userAnswer.startsWith('+') ? userAnswer.substring(1) : userAnswer;
                
                const isCorrect = normalizedUserAnswer === correctAnswer;

                if (isCorrect) {
                    correctCount++;
                    resultList.innerHTML += `<li class="correct-text">Pregunta ${questionNumber}: Correcto (Respuesta: ${correctAnswer})</li>`;
                    input.style.border = '2px solid #2ecc71';
                } else {
                    resultList.innerHTML += `<li class="incorrect-text">Pregunta ${questionNumber}: Incorrecto (Tu: ${userAnswer} | Corr: ${correctAnswer})</li>`;
                    input.style.border = '2px solid #e74c3c';
                }
                totalQuestions++;
            });

            document.getElementById('quizScore').textContent = `${correctCount}/${totalQuestions}`;
            resultsDiv.style.display = 'block';

            // Marcar Sesi√≥n 1 como completada si se obtiene un 75% o m√°s (6/8)
             if (correctCount >= 6) {
		// === AGREGAR: MARCAR RETO 5 DE SESI√ìN 1 ===
 							   completeSubActivity(1, 5);
    					// ==========================================
                if (!completedSections.includes(1)) {
                    completedSections.push(1);
                    localStorage.setItem('completedSections', JSON.stringify(completedSections));
                    updateProgress();
                    createConfetti();
                    alert('‚ú® ¬°Sesi√≥n 1 Completada con Honores! Has desbloqueado la Sesi√≥n 2.');
                }
                // Mostrar el bot√≥n siempre que tenga 6 o m√°s correctas
                document.getElementById('nextSessionButton').style.display = 'block';
            } else {
                alert('Sigue practicando. Necesitas al menos 6/8 correctas para desbloquear la siguiente sesi√≥n.');
            }
            }
        


        // === INICIALIZAR TODO ===
    document.addEventListener('DOMContentLoaded', function() {
        createStars();
        createParticles();
        createMathSymbols();
        updateProgress();
        showScreen('homeScreen');

showScreen('homeScreen');
        
        // üëá AGREGA ESTO AQU√ç üëá
        // Inicializar estado del Postest al cargar
        const postestCard = document.getElementById('postestCard');
        if (postestCard) {
            if (completedSections.length === TOTAL_SECTIONS) {
                postestCard.classList.remove('postest-locked');
            } else {
                postestCard.classList.add('postest-locked');
            }
        }
        
        // Inicializar juego arcade cuando se active la pantalla
        
        // Inicializar juego arcade cuando se active la pantalla
        const arcadeScreen = document.getElementById('session2ArcadeScreen');
        if (arcadeScreen) {
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.target.classList.contains('active')) {
                        setTimeout(() => initArcadeGame(), 100);
                    }
                });
            });
            observer.observe(arcadeScreen, { attributes: true, attributeFilter: ['class'] });
        }
    });

        // === FUNCI√ìN PARA REINICIAR PROGRESO (SOLO PARA PRUEBAS) ===
        function resetProgress() {
            if (confirm('‚ö†Ô∏è ¬øEst√°s seguro de que quieres reiniciar todo el progreso?')) {
                localStorage.removeItem('completedSections');
                completedSections = [];
                alert('‚úÖ Progreso reiniciado. Recarga la p√°gina.');
                location.reload();
            }
        }

        // === OPTIMIZACI√ìN M√ìVIL: Reducir animaciones si es necesario ===
        if (window.innerWidth <= 768) {
            console.log('Modo m√≥vil activado - Efectos optimizados');
        }
// === FUNCI√ìN PARA ABRIR EL POSTEST ===
        function openPostest() {
            if (completedSections.length === TOTAL_SECTIONS) {
                window.open('https://andres5050-sudo.github.io/Pretest-Octavo2/', '_blank');
            } else {
                const remaining = TOTAL_SECTIONS - completedSections.length;
                alert(`üîí El Postest estar√° disponible cuando completes todas las sesiones.\n\nüìä Progreso actual: ${completedSections.length}/${TOTAL_SECTIONS} sesiones completadas.\n\‚ö†Ô∏è Te faltan ${remaining} sesi√≥n${remaining > 1 ? 'es' : ''}.`);
            }
        }
// =================================================
// =================================================
// === JUEGO ARCADE MEJORADO: OPERACIONES CAYENDO ===
// =================================================
// =================================================
// === JUEGO ARCADE MEJORADO: OPERACIONES CAYENDO - C√ìDIGO FINAL CORREGIDO ===
// =================================================


// =================================================
    // === JUEGO ARCADE MEJORADO (DEL INDEX.HTML) - C√ìDIGO CORREGIDO ===
    // =================================================

    let arcadeCanvas, arcadeCtx;
    let arcadePlayer = { x: 430, y: 420, width: 40, height: 40, speed: 8 };
    let arcadeObstacles = [];
    let arcadeStars = [];
    let arcadeEnergy = 100;
    let arcadeScore = 0;
    let arcadeQuestionsAnswered = 0;
    let arcadeQuestionResults = []; // <--- AGREGAR ESTA L√çNEA
    let arcadeGameActive = false;
    let arcadeWaitingForMovement = true;
    let arcadeGameCompleted = false;
    let arcadeKeys = {};
    let arcadeLeftPressed = false;
    let arcadeRightPressed = false;
    let arcadeObstacleSpeed = 4;
    let arcadeObstacleFrequency = 70;
    let arcadeFrameCount = 0;
    let arcadeDifficultyLevel = 1;
    let arcadeEnergyDecayRate = 0.09;
    let arcadeRoundStartTime = 0;
    
    // TIEMPO M√ÅXIMO POR RONDA EN MILISEGUNDOS (8 minutos)
    const MAX_ROUND_TIME = 8 * 60 * 1000; 
    const REQUIRED_CORRECT_QUESTIONS = 10; // L√≠mite de 10 preguntas

    // REESTRUCTURACI√ìN DE PREGUNTAS CON RESPUESTAS FIJAS, SIN √çNDICE DE CORRECCI√ìN
    // El √≠ndice se generar√° din√°micamente.
    const arcadeQuestionsPool = [
        // PREGUNTAS B√ÅSICAS (5)
        { q: "¬øCu√°nto es (+5) √ó (+3)?", correct_answer: "+15", incorrect_options: ["‚àí15", "+8", "+2"] },
        { q: "¬øCu√°nto es (‚àí4) √ó (+6)?", correct_answer: "‚àí24", incorrect_options: ["+24", "‚àí10", "+10"] },
        { q: "¬øCu√°nto es (+12) √∑ (‚àí4)?", correct_answer: "‚àí3", incorrect_options: ["+3", "+8", "+16"] },
        { q: "¬øCu√°nto es (‚àí7) √ó (‚àí7)?", correct_answer: "+49", incorrect_options: ["0", "‚àí49", "‚àí14"] },
        { q: "¬øCu√°nto es (+8) √ó (‚àí2)?", correct_answer: "‚àí16", incorrect_options: ["+16", "‚àí10", "+6"] },
        
        // PREGUNTAS INTERMEDIAS (5)
        { q: "¬øCu√°nto es (‚àí20) √∑ (‚àí4)?", correct_answer: "+5", incorrect_options: ["‚àí5", "‚àí16", "+16"] },
        { q: "¬øCu√°nto es (‚àí3) √ó (+5)?", correct_answer: "‚àí15", incorrect_options: ["+15", "‚àí8", "+8"] },
        { q: "¬øCu√°nto es (+6) √ó (‚àí3)?", correct_answer: "‚àí18", incorrect_options: ["+18", "‚àí9", "+3"] },
        { q: "¬øCu√°nto es (‚àí15) √∑ (+3)?", correct_answer: "‚àí5", incorrect_options: ["+5", "‚àí12", "+12"] },
        { q: "¬øCu√°nto es (+9) √ó (+2)?", correct_answer: "+18", incorrect_options: ["‚àí18", "+11", "+7"] },

        // PREGUNTAS COMPUESTAS (5 - 3 o 4 t√©rminos)
        { q: "¬øCu√°nto es (‚àí2) √ó (+3) √ó (‚àí4)?", correct_answer: "+24", incorrect_options: ["‚àí24", "‚àí5", "+5"] },
        { q: "¬øCu√°nto es (+10) √ó (‚àí5) √∑ (+2)?", correct_answer: "‚àí25", incorrect_options: ["+25", "‚àí15", "+15"] },
        { q: "¬øCu√°nto es (‚àí8) √∑ (+2) √ó (‚àí3)?", correct_answer: "+12", incorrect_options: ["‚àí12", "‚àí10", "+10"] },
        { q: "¬øCu√°nto es (+7) √ó (‚àí2) √∑ (‚àí1)?", correct_answer: "+14", incorrect_options: ["‚àí14", "‚àí9", "+5"] },
        { q: "¬øCu√°nto es (‚àí12) √ó (‚àí3) √∑ (‚àí6)?", correct_answer: "‚àí6", incorrect_options: ["+6", "‚àí9", "+9"] }
    ];

    // Array para almacenar las 10 preguntas seleccionadas para el juego
    let currentArcadeQuestions = [];
    
    // Funci√≥n de ayuda para mezclar arrays
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // Funci√≥n para obtener las 10 preguntas de forma aleatoria y estructurada
    function getShuffledArcadeQuestions() {
        const basics = arcadeQuestionsPool.slice(0, 10); // Primeras 10 son b√°sicas/intermedias
        const compounds = arcadeQuestionsPool.slice(10, 15); // Las siguientes 5 son compuestas

        // 1. Selecciona 5 preguntas b√°sicas de forma aleatoria
        const basicQuestions = shuffleArray(basics).slice(0, 5);
        
        // 2. Selecciona 5 preguntas compuestas de forma aleatoria
        const compoundQuestions = shuffleArray(compounds).slice(0, 5);
        
        // 3. Combina y mezcla para que no siempre sea (B√°sica... Compuesta)
        const finalQuestions = shuffleArray([...basicQuestions, ...compoundQuestions]);
        
        return finalQuestions;
    }


    function startArcadeNewRound() {
        if (arcadeQuestionsAnswered === 0) {
            // Inicializar las preguntas solo al inicio
            currentArcadeQuestions = getShuffledArcadeQuestions();
            arcadeQuestionResults = []; // Limpiar resultados al iniciar un juego nuevo
        }
        
        arcadeObstacles = [];
        arcadeStars = [];
        arcadeEnergy = 100;
        arcadeFrameCount = 0;
        arcadeWaitingForMovement = true;
        arcadeGameActive = false;
        arcadeRoundStartTime = Date.now();

        document.getElementById('arcadeGameMessage').textContent = 'üéÆ Pulsa CUALQUIER FLECHA o BOT√ìN para comenzar';
        document.getElementById('arcadeStartRoundButton').style.display = 'none';
        arcadeDrawGame();
    }

    function arcadeHandleKeyDown(e) {
        if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
            arcadeKeys[e.key] = true;
            if (arcadeWaitingForMovement) {
                arcadeWaitingForMovement = false;
                arcadeGameActive = true;
                document.getElementById('arcadeGameMessage').textContent = 'üéÆ ¬°Esquiva obst√°culos rojos y recoge estrellas verdes!';
                arcadeGameLoop();
            }
        }
    }

    function arcadeHandleKeyUp(e) {
        arcadeKeys[e.key] = false;
    }

    function arcadeGameLoop() {
        if (!arcadeGameActive || arcadeGameCompleted) return;

        arcadeFrameCount++;

        // Mover jugador
        if (arcadeKeys['ArrowLeft'] || arcadeLeftPressed) {
            arcadePlayer.x -= arcadePlayer.speed;
        }
        if (arcadeKeys['ArrowRight'] || arcadeRightPressed) {
            arcadePlayer.x += arcadePlayer.speed;
        }

        arcadePlayer.x = Math.max(0, Math.min(arcadeCanvas.width - arcadePlayer.width, arcadePlayer.x));

        // Generar obst√°culos
        if (arcadeFrameCount % arcadeObstacleFrequency === 0) {
            const obstacleX = Math.random() * (arcadeCanvas.width - 60);
            arcadeObstacles.push({ x: obstacleX, y: -60, width: 60, height: 60 });
        }

        // Generar estrellas
        if (arcadeFrameCount % 120 === 0) {
            const starX = Math.random() * (arcadeCanvas.width - 40);
            arcadeStars.push({ x: starX, y: -40, width: 40, height: 40 });
        }

        // Mover obst√°culos
        for (let i = arcadeObstacles.length - 1; i >= 0; i--) {
            arcadeObstacles[i].y += arcadeObstacleSpeed;
            
            if (arcadeCheckCollision(arcadePlayer, arcadeObstacles[i])) {
                arcadeHandleLoss('¬°Chocaste con un obst√°culo rojo!');
                return;
            }
            
            if (arcadeObstacles[i].y > arcadeCanvas.height) {
                arcadeObstacles.splice(i, 1);
                arcadeScore += 10;
            }
        }

        // Mover estrellas
        for (let i = arcadeStars.length - 1; i >= 0; i--) {
            arcadeStars[i].y += arcadeObstacleSpeed * 0.8;
            
            if (arcadeCheckCollision(arcadePlayer, arcadeStars[i])) {
                arcadeStars.splice(i, 1);
                arcadeEnergy = Math.min(100, arcadeEnergy + 30);
                arcadeScore += 50;
            } else if (arcadeStars[i].y > arcadeCanvas.height) {
                arcadeStars.splice(i, 1);
            }
        }

        // Reducir energ√≠a
        arcadeEnergy -= arcadeEnergyDecayRate;

        if (arcadeEnergy <= 0) {
            arcadeHandleLoss('¬°Te quedaste sin energ√≠a!');
            return;
        }

       
        // Aumentar dificultad progresivamente
        if (arcadeFrameCount % 600 === 0) {
            arcadeDifficultyLevel++;
            arcadeObstacleSpeed += 0.5;
            arcadeObstacleFrequency = Math.max(50, arcadeObstacleFrequency - 8);
            arcadeEnergyDecayRate += 0.03;
        }

        // Verificar tiempo y activar DIFICULTAD M√ÅXIMA en el √∫ltimo minuto
        const elapsedTime = Date.now() - arcadeRoundStartTime;

        // TIEMPO L√çMITE: 8 MINUTOS
        if (elapsedTime >= MAX_ROUND_TIME) {
            arcadeHandleLoss('‚è±Ô∏è ¬°Tiempo agotado! M√°ximo 8 minutos por ronda');
            return;
        }

        // √öLTIMO MINUTO = MODO BRUTAL (para el √∫ltimo minuto de los 8, si se llega)
        if (elapsedTime >= MAX_ROUND_TIME - 60000) { // Si quedan 60 segundos
            arcadeObstacleSpeed = 8;
            arcadeObstacleFrequency = 20;
            arcadeEnergyDecayRate = 0.25;
            
            // Mostrar advertencia visual
            arcadeCtx.fillStyle = 'rgba(231, 76, 60, 0.3)';
            arcadeCtx.fillRect(0, 0, arcadeCanvas.width, arcadeCanvas.height);
            arcadeCtx.fillStyle = '#fff';
            arcadeCtx.font = 'bold 24px Arial';
            arcadeCtx.textAlign = 'center';
            arcadeCtx.fillText('‚ö†Ô∏è ¬°√öLTIMO MINUTO! ‚ö†Ô∏è', arcadeCanvas.width/2, 250);
            arcadeCtx.textAlign = 'left';
        }

        arcadeDrawGame();
        requestAnimationFrame(arcadeGameLoop);
    }


    function arcadeDrawGame() {
        // ... (el c√≥digo de dibujo permanece igual)
        // Fondo negro
        arcadeCtx.fillStyle = '#0a0e27';
        arcadeCtx.fillRect(0, 0, arcadeCanvas.width, arcadeCanvas.height);

        // CUADRO DE INFORMACI√ìN ARRIBA (dentro del juego)
        arcadeCtx.fillStyle = 'rgba(0, 0, 0, 0.7)';
        arcadeCtx.fillRect(10, 10, arcadeCanvas.width - 20, 80);
        arcadeCtx.strokeStyle = '#3498db';
        arcadeCtx.lineWidth = 3;
        arcadeCtx.strokeRect(10, 10, arcadeCanvas.width - 20, 80);

        // Texto "ENERG√çA"
        arcadeCtx.fillStyle = '#fff';
        arcadeCtx.font = 'bold 16px Arial';
        arcadeCtx.fillText('‚ö° ENERG√çA:', 20, 35);
        
        // Barra de energ√≠a - fondo gris
        arcadeCtx.fillStyle = '#34495e';
        arcadeCtx.fillRect(120, 20, 200, 20);
        
        // Barra de energ√≠a - relleno de color
        const energyWidth = (arcadeEnergy / 100) * 200;
        const energyColor = arcadeEnergy > 60 ? '#2ecc71' : arcadeEnergy > 30 ? '#f39c12' : '#e74c3c';
        arcadeCtx.fillStyle = energyColor;
        arcadeCtx.fillRect(120, 20, energyWidth, 20);
        
        // Borde blanco de la barra
        arcadeCtx.strokeStyle = '#fff';
        arcadeCtx.lineWidth = 2;
        arcadeCtx.strokeRect(120, 20, 200, 20);
        
        // Porcentaje de energ√≠a
        arcadeCtx.fillStyle = '#fff';
        arcadeCtx.fillText(`${Math.round(arcadeEnergy)}%`, 330, 35);

        // Pregunta actual (L√çMITE A 10)
        arcadeCtx.fillStyle = '#fff';
        arcadeCtx.fillText(`‚≠ê PREGUNTA: ${arcadeQuestionsAnswered + 1}/${REQUIRED_CORRECT_QUESTIONS}`, 420, 35);

        // Puntos
        arcadeCtx.fillStyle = '#fff';
        arcadeCtx.fillText(`üèÜ PUNTOS: ${arcadeScore}`, 20, 65);

        // Nivel
        arcadeCtx.fillStyle = '#fff';
        arcadeCtx.fillText(`üìä NIVEL: ${arcadeDifficultyLevel}`, 420, 65);

        // DIBUJAR JUGADOR (cuadro azul)
        arcadeCtx.fillStyle = '#3498db';
        arcadeCtx.fillRect(arcadePlayer.x, arcadePlayer.y, arcadePlayer.width, arcadePlayer.height);
        arcadeCtx.strokeStyle = '#fff';
        arcadeCtx.lineWidth = 3;
        arcadeCtx.strokeRect(arcadePlayer.x, arcadePlayer.y, arcadePlayer.width, arcadePlayer.height);

        // DIBUJAR OBST√ÅCULOS ROJOS
        arcadeObstacles.forEach(obs => {
            arcadeCtx.fillStyle = '#e74c3c';
            arcadeCtx.fillRect(obs.x, obs.y, obs.width, obs.height);
            arcadeCtx.strokeStyle = '#c0392b';
            arcadeCtx.lineWidth = 2;
            arcadeCtx.strokeRect(obs.x, obs.y, obs.width, obs.height);
        });

        // DIBUJAR ESTRELLAS VERDES (forma de estrella de verdad)
        arcadeStars.forEach(star => {
            arcadeCtx.save();
            arcadeCtx.translate(star.x + star.width/2, star.y + star.height/2);
            
            arcadeCtx.fillStyle = '#2ecc71';
            arcadeCtx.strokeStyle = '#27ae60';
            arcadeCtx.lineWidth = 2;
            
            arcadeCtx.beginPath();
            for (let i = 0; i < 5; i++) {
                const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
                const x = Math.cos(angle) * 15;
                const y = Math.sin(angle) * 15;
                if (i === 0) arcadeCtx.moveTo(x, y);
                else arcadeCtx.lineTo(x, y);
                
                const angle2 = (Math.PI * 2 * (i + 0.5)) / 5 - Math.PI / 2;
                const x2 = Math.cos(angle2) * 7;
                const y2 = Math.sin(angle2) * 7;
                arcadeCtx.lineTo(x2, y2);
            }
            arcadeCtx.closePath();
            arcadeCtx.fill();
            arcadeCtx.stroke();
            
            arcadeCtx.restore();
        });
    }

    function arcadeCheckCollision(rect1, rect2) {
        return rect1.x < rect2.x + rect2.width &&
               rect1.x + rect1.width > rect2.x &&
               rect1.y < rect2.y + rect2.height &&
               rect1.y + rect1.height > rect2.y;
    }

    function arcadeHandleLoss(reason) {
        arcadeGameActive = false;
        document.getElementById('arcadeLossReason').textContent = reason;
        document.getElementById('arcadeLossModal').style.display = 'flex';
    }

    function showArcadeQuestionAfterLoss() {
        document.getElementById('arcadeLossModal').style.display = 'none';
        
        if (arcadeQuestionsAnswered >= REQUIRED_CORRECT_QUESTIONS) {
            arcadeEndGame();
            return;
        }

        // Obtener la pregunta del array `currentArcadeQuestions`
        const qData = currentArcadeQuestions[arcadeQuestionsAnswered];
        document.getElementById('arcadeQuestionText').textContent = qData.q;
        
        const optionsContainer = document.getElementById('arcadeAnswerOptions');
        optionsContainer.innerHTML = '';
        
        // --- L√ìGICA DE ALEATORIZACI√ìN DE OPCIONES ---
        const allOptions = [qData.correct_answer, ...qData.incorrect_options];
        const shuffledOptions = shuffleArray(allOptions);
        
        // Encontrar el √≠ndice de la respuesta correcta en el array mezclado
        const correctIndex = shuffledOptions.indexOf(qData.correct_answer);
        
        // Crear las opciones
        shuffledOptions.forEach((option, index) => {
            const btn = document.createElement('button');
            btn.textContent = option;
            btn.className = 'back-button';
            btn.style.fontSize = '1.3em';
            btn.style.padding = '18px 30px';
            btn.style.width = '100%';
            // Se pasa el √≠ndice de la opci√≥n correcta DENTRO del array mezclado
            btn.onclick = () => arcadeCheckAnswer(index, correctIndex); 
            optionsContainer.appendChild(btn);
        });
        
        document.getElementById('arcadeQuestionModal').style.display = 'flex';
    }

    function arcadeCheckAnswer(selected, correct) {
        // Obtener la pregunta actual (necesitamos qData para el texto)
        const qData = currentArcadeQuestions[arcadeQuestionsAnswered]; 
        const selectedOption = document.getElementById('arcadeAnswerOptions').children[selected].textContent;
        
        if (selected === correct) {
            arcadeQuestionsAnswered++;
            arcadeScore += 100;
            
            document.getElementById('arcadeQuestionModal').style.display = 'none';
            
            // Si la respuesta es correcta, guarda el resultado
            arcadeQuestionResults.push({
                question: qData.q,
                correct: true,
                answer: qData.correct_answer // Guardamos la respuesta correcta para referencia
            });
            
            if (arcadeQuestionsAnswered >= REQUIRED_CORRECT_QUESTIONS) {
                arcadeEndGame();
            } else {
                document.getElementById('arcadeStartRoundButton').style.display = 'block';
                // Actualizar el n√∫mero de la siguiente pregunta en el texto del juego
                document.getElementById('arcadeGameTitle').textContent = `üéÆ Evaluaci√≥n en Curso (Pregunta ${arcadeQuestionsAnswered + 1}/${REQUIRED_CORRECT_QUESTIONS})`;
                document.getElementById('arcadeGameMessage').textContent = '‚úÖ ¬°Correcto! Pulsa el bot√≥n para la siguiente ronda';
            }
        } else {
            // Si la respuesta es incorrecta, guarda el resultado, pero NO avanzamos el contador de pregunta
            arcadeQuestionResults.push({
                question: qData.q,
                correct: false,
                user_answer: selectedOption, // Guardamos lo que el usuario seleccion√≥
                correct_answer: qData.correct_answer
            });
            
            alert('‚ùå Incorrecto. Int√©ntalo de nuevo.');
        }
    }

    function arcadeEndGame() {
        arcadeGameCompleted = true;
        arcadeGameActive = false;
        
        document.getElementById('arcadeGameOverScore').textContent = `${arcadeQuestionsAnswered}/${REQUIRED_CORRECT_QUESTIONS}`;
        document.getElementById('arcadeGameOverModal').style.display = 'flex';
    }

    // Funci√≥n para mostrar el modal de resultados detallados
    function showArcadeFinalResults() {
        document.getElementById('arcadeGameOverModal').style.display = 'none';
        
        const resultList = document.getElementById('arcadeResultList');
        resultList.innerHTML = ''; // Limpiar resultados anteriores
        
        // Generar la lista de resultados
        arcadeQuestionResults.forEach((result, index) => {
            let listItem = document.createElement('li');
            listItem.style.padding = '15px';
            listItem.style.marginBottom = '10px';
            listItem.style.borderRadius = '10px';
            listItem.style.fontSize = '1.1em';
            listItem.style.borderLeft = '6px solid';
            listItem.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';

            let statusIcon = result.correct ? '‚úÖ' : '‚ùå';
            let statusColor = result.correct ? '#2ecc71' : '#e74c3c';
            let answerDetail = result.correct 
                ? `Respuesta: <strong style="color: #27ae60;">${result.answer}</strong>` 
                : `Tu respuesta: <strong style="color: #c0392b;">${result.user_answer}</strong> | Correcta: <strong style="color: #27ae60;">${result.correct_answer}</strong>`;

            listItem.style.borderColor = statusColor;
            listItem.innerHTML = `
                <span style="font-size: 1.3em; font-weight: 700;">${statusIcon} Pregunta ${index + 1}:</span> 
                <span style="font-weight: 600;">${result.question}</span><br>
                ${answerDetail}
            `;
            resultList.appendChild(listItem);
        });

        // Mostrar el nuevo modal de resultados detallados
        document.getElementById('arcadeFinalResultsModal').style.display = 'flex';
    }

    // Nueva funci√≥n para finalizar la sesi√≥n 2 y avanzar a Jerarqu√≠a
    function finalizeSession2() {
        document.getElementById('arcadeFinalResultsModal').style.display = 'none';
		// === AGREGAR: MARCAR RETO 3 DE SESI√ìN 2 (Juego Arcade) ===
  					  completeSubActivity(2, 3);
   					 // =========================================================
        
        if (!completedSections.includes(2)) {
            completedSections.push(2);
            localStorage.setItem('completedSections', JSON.stringify(completedSections));
            updateProgress();
            createConfetti();
        }
// Actualiza la visualizaci√≥n del mapa para que el cambio sea visible
    updateProgress();
        
        showScreen('session2HierarchyScreen');
    }

    function initArcadeGame() {
        arcadeCanvas = document.getElementById('arcadeGameCanvas');
        if (!arcadeCanvas) return;
        
        arcadeCtx = arcadeCanvas.getContext('2d');
        
        arcadeObstacles = [];
        arcadeStars = [];
        arcadeEnergy = 100;
        arcadeScore = 0;
        arcadeQuestionsAnswered = 0;
        arcadeQuestionResults = []; // <--- Limpiar resultados al inicializar el juego
        arcadeGameActive = false;
        arcadeWaitingForMovement = true;
        arcadeGameCompleted = false;
        arcadeKeys = {};
        arcadeLeftPressed = false;
        arcadeRightPressed = false;
        arcadeObstacleSpeed = 3;
        arcadeObstacleFrequency = 80;
        arcadeFrameCount = 0;
        arcadeDifficultyLevel = 1;
        arcadeEnergyDecayRate = 0.09;
        arcadePlayer.x = arcadeCanvas.width / 2 - 20;
        arcadePlayer.y = 420;
        currentArcadeQuestions = []; // Resetear el array de preguntas para que se inicialice al comenzar la primera ronda

        document.removeEventListener('keydown', arcadeHandleKeyDown);
        document.removeEventListener('keyup', arcadeHandleKeyUp);
        document.addEventListener('keydown', arcadeHandleKeyDown);
        document.addEventListener('keyup', arcadeHandleKeyUp);

        const leftBtn = document.getElementById('arcadeLeftBtn');
        const rightBtn = document.getElementById('arcadeRightBtn');
        const startBtn = document.getElementById('arcadeStartRoundButton');

        // Eliminar y re-a√±adir listeners para evitar duplicados
        leftBtn.replaceWith(leftBtn.cloneNode(true));
        rightBtn.replaceWith(rightBtn.cloneNode(true));
        startBtn.replaceWith(startBtn.cloneNode(true));

        const newLeftBtn = document.getElementById('arcadeLeftBtn');
        const newRightBtn = document.getElementById('arcadeRightBtn');
        const newStartBtn = document.getElementById('arcadeStartRoundButton');

        newLeftBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            arcadeLeftPressed = true;
            arcadeKeys['ArrowLeft'] = true;
            if (arcadeWaitingForMovement) {
                arcadeWaitingForMovement = false;
                arcadeGameActive = true;
                document.getElementById('arcadeGameMessage').textContent = 'üéÆ ¬°Esquiva y recoge estrellas!';
                arcadeGameLoop();
            }
        }, {passive: false});

        newLeftBtn.addEventListener('touchend', function(e) {
            e.preventDefault();
            arcadeLeftPressed = false;
            arcadeKeys['ArrowLeft'] = false;
        }, {passive: false});

        newLeftBtn.addEventListener('mousedown', function(e) {
            e.preventDefault();
            arcadeLeftPressed = true;
            arcadeKeys['ArrowLeft'] = true;
            if (arcadeWaitingForMovement) {
                arcadeWaitingForMovement = false;
                arcadeGameActive = true;
                document.getElementById('arcadeGameMessage').textContent = 'üéÆ ¬°Esquiva y recoge estrellas!';
                arcadeGameLoop();
            }
        });

        newLeftBtn.addEventListener('mouseup', function(e) {
            e.preventDefault();
            arcadeLeftPressed = false;
            arcadeKeys['ArrowLeft'] = false;
        });

        newRightBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            arcadeRightPressed = true;
            arcadeKeys['ArrowRight'] = true;
            if (arcadeWaitingForMovement) {
                arcadeWaitingForMovement = false;
                arcadeGameActive = true;
                document.getElementById('arcadeGameMessage').textContent = 'üéÆ ¬°Esquiva y recoge estrellas!';
                arcadeGameLoop();
            }
        }, {passive: false});

        newRightBtn.addEventListener('touchend', function(e) {
            e.preventDefault();
            arcadeRightPressed = false;
            arcadeKeys['ArrowRight'] = false;
        }, {passive: false});

        newRightBtn.addEventListener('mousedown', function(e) {
            e.preventDefault();
            arcadeRightPressed = true;
            arcadeKeys['ArrowRight'] = true;
            if (arcadeWaitingForMovement) {
                arcadeWaitingForMovement = false;
                arcadeGameActive = true;
                document.getElementById('arcadeGameMessage').textContent = 'üéÆ ¬°Esquiva y recoge estrellas!';
                arcadeGameLoop();
            }
        });

        newRightBtn.addEventListener('mouseup', function(e) {
            e.preventDefault();
            arcadeRightPressed = false;
            arcadeKeys['ArrowRight'] = false;
        });

        if (newStartBtn) {
            newStartBtn.onclick = startArcadeNewRound;
            newStartBtn.style.display = 'block';
        }

        arcadeDrawGame();
    }
    
    // Funci√≥n de ayuda para mezclar arrays
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }
// === NUEVA L√ìGICA DEL QUIZ DE PR√ÅCTICA (Jerarqu√≠a) ===
function submitPracticeQuiz(sectionNum) {
    const inputs = document.querySelectorAll('#session2PracticeScreen .quiz-input');
    const resultList = document.getElementById('practiceResultList');
    const resultsDiv = document.getElementById('practiceResults');
    let correctCount = 0;
    let totalQuestions = 0;

    resultList.innerHTML = '';
    
    inputs.forEach((input, index) => {
        const userAnswer = input.value.trim();
        // Nota: Aseg√∫rate de que las respuestas correctas en el data-correct del HTML son strings (ej: "24", "-6")
        const correctAnswer = input.getAttribute('data-correct').trim();
        const questionNumber = index + 1;
        
        // La comparaci√≥n debe ser estricta, incluyendo el signo negativo si aplica
        const isCorrect = userAnswer === correctAnswer; 

        let listItem = document.createElement('li');
        listItem.style.padding = '10px 0';
        listItem.style.borderBottom = '1px dashed #ccc';

        if (isCorrect) {
            correctCount++;
            listItem.className = 'correct-text';
            listItem.style.color = '#2ecc71';
            listItem.innerHTML = `‚úÖ Pregunta ${questionNumber}: Correcto (Respuesta: ${correctAnswer})`;
            input.style.border = '2px solid #2ecc71';
        } else {
            listItem.className = 'incorrect-text';
            listItem.style.color = '#e74c3c';
            listItem.innerHTML = `‚ùå Pregunta ${questionNumber}: Incorrecto (Tu respuesta: ${userAnswer} | Respuesta Correcta: ${correctAnswer})`;
            input.style.border = '2px solid #e74c3c';
        }
        resultList.appendChild(listItem);
        totalQuestions++;
    });

    document.getElementById('practiceScore').textContent = `${correctCount}/${totalQuestions}`;
    resultsDiv.style.display = 'block';

// Se requiere un m√≠nimo de 6/7 (aproximadamente 85%) para considerar la pr√°ctica superada y finalizar la Sesi√≥n 2
    if (correctCount >= 6) { 
        document.getElementById('completeSession2Button').style.display = 'block';

// === AGREGAR: MARCAR RETO 5 DE SESI√ìN 2 ===
        completeSubActivity(2, 5);
        // ==========================================
        // Marcar la sesi√≥n como completada DEBE hacerse al final
        if (!completedSections.includes(sectionNum)) {
             completedSections.push(sectionNum);
             localStorage.setItem('completedSections', JSON.stringify(completedSections));
             // Esto actualiza el mapa para desbloquear la Sesi√≥n 3 y asegurar el reingreso a la Sesi√≥n 2
             updateProgress(); 
             createConfetti();
        }
    } else {
        document.getElementById('completeSession2Button').style.display = 'none';
        alert('Necesitas al menos 6/7 correctas para superar el Reto de Jerarqu√≠a. ¬°Sigue practicando!');
    }
}
// =================================================
// === L√ìGICA DE SESI√ìN 3: JERARQU√çA COMPLETA ===
// =================================================

// Mapa de bloqueo interno para Sesi√≥n 3
const session3Map = {
    'session3TheoryScreen': 1,
    'session3PracticeScreen': 2,
    'session3EscapeRoomScreen': 3  // ‚Üê CAMBIO AQU√ç
};

function updateSession3Nav() {
    const currentProgress = activityProgress.sesion3;
    
    // Tarjetas de navegaci√≥n
    document.querySelectorAll('#session3Screen .session-nav-card').forEach(card => {
        const onclickAttr = card.getAttribute('onclick');
        if (!onclickAttr) return;
        
        // Manejar el caso especial del Escape Room
        if (onclickAttr.includes('openEscapeRoom')) {
            const requiredIndex = 3;
            const isAvailable = requiredIndex <= currentProgress + 1;
            const isCompleted = requiredIndex <= currentProgress;
            
            card.classList.remove('locked', 'unlocked');
            
            if (isCompleted) {
                card.classList.add('unlocked');
                let h4 = card.querySelector('h4');
                h4.textContent = h4.textContent.replace(' ‚úÖ', '');
                h4.textContent += ' ‚úÖ';
            } else if (isAvailable) {
                card.classList.add('unlocked');
            } else {
                card.classList.add('locked');
                card.onclick = () => alert(`üîí Debes completar la Pr√°ctica Progresiva (paso 2) antes de acceder al Escape Room.`);
            }
            return;
        }
        
        const targetScreen = onclickAttr.match(/showScreen\('([^']+)'/)?.[1];
        if (!targetScreen) return;
        
        const requiredIndex = session3Map[targetScreen];
        if (!requiredIndex) return;
        
        const isAvailable = requiredIndex <= currentProgress + 1;
        const isCompleted = requiredIndex <= currentProgress;
        
        card.classList.remove('locked', 'unlocked');
        card.onclick = null;

        if (isCompleted) {
            card.classList.add('unlocked');
            card.onclick = () => showScreen(targetScreen);
            let h4 = card.querySelector('h4');
            h4.textContent = h4.textContent.replace(' ‚úÖ', '');
            h4.textContent += ' ‚úÖ';
        } else if (isAvailable) {
            card.classList.add('unlocked');
            card.onclick = () => showScreen(targetScreen);
        } else {
            card.classList.add('locked');
            card.onclick = () => alert(`üîí Debes completar el paso anterior (${requiredIndex - 1}) antes de acceder a este.`);
        }
    });
    
    // Actualizar lista de ruta de aprendizaje
    document.querySelectorAll('#session3Screen .learning-list-item').forEach(item => {
        const onclickAttr = item.getAttribute('onclick');
        if (!onclickAttr) return;
        
        // Escape Room case
        if (onclickAttr.includes('openEscapeRoom')) {
            const requiredIndex = 3;
            const isAvailable = requiredIndex <= currentProgress + 1;
            
            item.classList.remove('locked-item');
            if (!isAvailable) {
                item.classList.add('locked-item');
                item.onclick = () => alert(`üîí Debes completar la Pr√°ctica Progresiva antes de acceder al Escape Room.`);
            }
            return;
        }
        
        const targetScreen = onclickAttr.match(/showScreen\('([^']+)'/)?.[1];
        if (!targetScreen) return;
        
        const requiredIndex = session3Map[targetScreen];
        if (!requiredIndex) return;
        
        const isAvailable = requiredIndex <= currentProgress + 1;
        
        item.classList.remove('locked-item');
        if (!isAvailable) {
            item.classList.add('locked-item');
            item.onclick = () => alert(`üîí Debes completar el paso anterior (${requiredIndex - 1}) antes de acceder a este.`);
        }
    });
}

// Funci√≥n para verificar las 15 respuestas de la pr√°ctica
function submitSession3Practice() {
    const inputs = document.querySelectorAll('#session3PracticeScreen .quiz-input');
    const resultList = document.getElementById('session3PracticeResultList');
    const resultsDiv = document.getElementById('session3PracticeResults');
    const progressFill = document.getElementById('session3ProgressFill');
    
    let correctCount = 0;
    let totalQuestions = 15; // CAMBIO: 15 ejercicios

    resultList.innerHTML = '';
    
    inputs.forEach((input, index) => {
        const userAnswer = input.value.trim();
        const correctAnswer = input.getAttribute('data-correct').trim();
        const questionNumber = index + 1;
        
        // Comparaci√≥n flexible para decimales
        const userNum = parseFloat(userAnswer);
        const correctNum = parseFloat(correctAnswer);
        const isCorrect = Math.abs(userNum - correctNum) < 0.01 || userAnswer === correctAnswer;

        let listItem = document.createElement('li');
        listItem.style.padding = '15px 20px';
        listItem.style.marginBottom = '12px';
        listItem.style.borderRadius = '12px';
        listItem.style.fontSize = '1.15em';
        listItem.style.borderLeft = '8px solid';
        listItem.style.boxShadow = '0 3px 10px rgba(0,0,0,0.15)';
        listItem.style.transition = 'transform 0.3s';

        if (isCorrect) {
            correctCount++;
            listItem.style.borderColor = '#2ecc71';
            listItem.style.background = 'linear-gradient(135deg, #d4edda, #f3fff5)';
            listItem.innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 2em;">‚úÖ</span>
                    <div style="flex: 1;">
                        <span style="font-size: 1.3em; font-weight: 700; color: #27ae60;">Pregunta ${questionNumber}:</span> 
                        <span style="font-weight: 600; color: #1e8449;">¬°Correcto!</span><br>
                        <span style="color: #27ae60;">Respuesta: <strong>${correctAnswer}</strong></span>
                    </div>
                </div>
            `;
            input.style.border = '3px solid #2ecc71';
            input.style.background = '#d4edda';
        } else {
            listItem.style.borderColor = '#e74c3c';
            listItem.style.background = 'linear-gradient(135deg, #f8d7da, #fff7f7)';
            listItem.innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 2em;">‚ùå</span>
                    <div style="flex: 1;">
                        <span style="font-size: 1.3em; font-weight: 700; color: #c0392b;">Pregunta ${questionNumber}:</span> 
                        <span style="font-weight: 600; color: #a93226;">Incorrecto</span><br>
                        <span style="color: #c0392b;">Tu respuesta: <strong>${userAnswer || '(vac√≠o)'}</strong></span><br>
                        <span style="color: #27ae60;">Respuesta correcta: <strong>${correctAnswer}</strong></span>
                    </div>
                </div>
            `;
            input.style.border = '3px solid #e74c3c';
            input.style.background = '#f8d7da';
        }
        
        listItem.onmouseover = () => { listItem.style.transform = 'translateX(5px)'; };
        listItem.onmouseout = () => { listItem.style.transform = 'translateX(0)'; };
        
        resultList.appendChild(listItem);
    });

    // Actualizar barra de progreso
    const percentage = (correctCount / totalQuestions) * 100;
    progressFill.style.width = `${percentage}%`;
    progressFill.textContent = `${correctCount}/${totalQuestions} (${Math.round(percentage)}%)`;

    // Mostrar resultados
    document.getElementById('session3PracticeScore').textContent = `${correctCount}/${totalQuestions}`;
    resultsDiv.style.display = 'block';

    // Scroll hacia resultados
    resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

    // Verificar si aprob√≥ (necesita 10/15 = 67%)
    if (correctCount >= 10) {
        // Marcar actividad 2 de sesi√≥n 3 como completada
        completeSubActivity(3, 2);
        
        // Mostrar bot√≥n de avance
        document.getElementById('session3CompleteButton').style.display = 'block';
        
        // Marcar sesi√≥n como completada
        if (!completedSections.includes(3)) {
            completedSections.push(3);
            localStorage.setItem('completedSections', JSON.stringify(completedSections));
            updateProgress();
            createConfetti();
            
            setTimeout(() => {
                alert(`üéâ ¬°FELICIDADES! Has completado la Sesi√≥n 3 con ${correctCount}/15 correctas.\n\n‚úÖ Sesi√≥n 4 desbloqueada\nüîê Escape Room disponible`);
            }, 500);
        }
    } else {
        document.getElementById('session3CompleteButton').style.display = 'none';
        alert(`üìö Necesitas al menos 10/15 correctas para avanzar.\n\nüìä Tu puntuaci√≥n: ${correctCount}/15\nüí™ Revisa los ejercicios incorrectos y vuelve a intentarlo.`);
    }
}


// Funci√≥n para abrir la pantalla informativa del Escape Room
function openEscapeRoom() {
    // Verificar que haya completado la pr√°ctica
    if (activityProgress.sesion3 < 2) {
        alert('üîí Debes completar la Pr√°ctica Progresiva antes de acceder al Escape Room.');
        return;
    }
    
    // Mostrar la pantalla del Escape Room
    showScreen('session3EscapeRoomScreen');
}

// Funci√≥n para lanzar el Escape Room (link de Genially)
// Funci√≥n para lanzar el Escape Room (link de Genially)
function launchEscapeRoom() {
    const escapeRoomLink = 'https://view.genially.com/68cc2448564a4e8d8e2f9308/interactive-content-numeros-enteros';
    
    // Marcar el escape room como completado (actividad 3 de sesi√≥n 3)
    completeSubActivity(3, 3);
    
    // Detectar si es m√≥vil para mejor compatibilidad
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    
    if (isMobile) {
        // En m√≥vil, redirigir directamente es m√°s confiable
        location.href = escapeRoomLink;
    } else {
        // En PC, abrir en nueva pesta√±a
        window.open(escapeRoomLink, '_blank');
        setTimeout(() => {
            if (confirm('üéâ ¬°El Escape Room se ha abierto en una nueva pesta√±a!\n\n‚úÖ Una vez que completes los 4 niveles del Escape Room, la Sesi√≥n 4 se desbloquear√° autom√°ticamente.\n\n¬øDeseas volver al mapa de sesiones ahora?')) {
                showScreen('sectionsScreen');
            }
        }, 1000);
    }
}





// ========== FUNCIONES PARA SESI√ìN 4 ==========

// Funci√≥n para verificar mini-retos interactivos
function checkMiniAnswer(button, isCorrect) {
    const allButtons = button.parentElement.querySelectorAll('button');
    allButtons.forEach(btn => {
        btn.disabled = true;
        btn.style.opacity = '0.6';
    });
    
    if (isCorrect) {
        button.style.background = 'linear-gradient(135deg, #4CAF50, #8BC34A)';
        button.style.color = 'white';
        button.style.transform = 'scale(1.1)';
        button.style.border = '3px solid #2E7D32';
    } else {
        button.style.background = 'linear-gradient(135deg, #F44336, #E53935)';
        button.style.color = 'white';
        button.style.border = '3px solid #C62828';
        // Mostrar la correcta
        allButtons.forEach(btn => {
            if (btn.onclick.toString().includes('true')) {
                btn.style.background = 'linear-gradient(135deg, #4CAF50, #8BC34A)';
                btn.style.color = 'white';
                btn.style.border = '3px solid #2E7D32';
                btn.style.opacity = '1';
            }
        });
    }
}

// Funci√≥n para verificar el quiz de Sesi√≥n 4
function submitSession4Quiz() {
    const inputs = document.querySelectorAll('.session4-input');
    const resultList = document.getElementById('session4ResultList');
    const resultsDiv = document.getElementById('session4QuizResults');
    const progressFill = document.getElementById('session4ProgressFill');
    
    let correctCount = 0;
    const totalQuestions = 15;

    resultList.innerHTML = '';
    
    inputs.forEach((input, index) => {
        const userAnswer = input.value.trim().toLowerCase().replace(/\s/g, '');
        const correctAnswer = input.getAttribute('data-correct').toLowerCase().replace(/\s/g, '');
        const questionNumber = index + 1;
        
        // Comparaci√≥n flexible
        let isCorrect = userAnswer === correctAnswer;
        
        // Comparaci√≥n alternativa para fracciones (ej: 3/4 vs 3/4)
        if (!isCorrect && userAnswer.includes('/') && correctAnswer.includes('/')) {
            const userParts = userAnswer.split('/').map(Number);
            const correctParts = correctAnswer.split('/').map(Number);
            if (userParts.length === 2 && correctParts.length === 2) {
                isCorrect = (userParts[0] / userParts[1]) === (correctParts[0] / correctParts[1]);
            }
        }
        
        // Aceptar "s√≠" con tilde tambi√©n
        if (!isCorrect && (correctAnswer === 'si' && (userAnswer === 's√≠' || userAnswer === 'si'))) {
            isCorrect = true;
        }

        let listItem = document.createElement('li');
        listItem.style.padding = '15px 20px';
        listItem.style.marginBottom = '12px';
        listItem.style.borderRadius = '12px';
        listItem.style.fontSize = '1.1em';
        listItem.style.borderLeft = '8px solid';
        listItem.style.boxShadow = '0 3px 10px rgba(0,0,0,0.1)';

        if (isCorrect) {
            correctCount++;
            listItem.style.borderColor = '#4CAF50';
            listItem.style.background = 'linear-gradient(135deg, #E8F5E9, #C8E6C9)';
            listItem.innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 1.8em;">‚úÖ</span>
                    <div>
                        <span style="font-weight: 700; color: #2E7D32;">Pregunta ${questionNumber}:</span> 
                        <span style="color: #388E3C;">¬°Correcto!</span>
                    </div>
                </div>
            `;
            input.style.border = '3px solid #4CAF50';
            input.style.background = '#E8F5E9';
        } else {
            listItem.style.borderColor = '#F44336';
            listItem.style.background = 'linear-gradient(135deg, #FFEBEE, #FFCDD2)';
            listItem.innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 1.8em;">‚ùå</span>
                    <div>
                        <span style="font-weight: 700; color: #C62828;">Pregunta ${questionNumber}:</span> 
                        <span style="color: #D32F2F;">Tu respuesta: ${input.value || '(vac√≠o)'}</span><br>
                        <span style="color: #388E3C;">Respuesta correcta: <strong>${input.getAttribute('data-correct')}</strong></span>
                    </div>
                </div>
            `;
            input.style.border = '3px solid #F44336';
            input.style.background = '#FFEBEE';
        }
        
        resultList.appendChild(listItem);
    });

    // Actualizar barra de progreso
    const percentage = (correctCount / totalQuestions) * 100;
    progressFill.style.width = `${percentage}%`;
    progressFill.textContent = `${correctCount}/${totalQuestions} (${Math.round(percentage)}%)`;
    
    // Cambiar color seg√∫n puntaje
    if (percentage >= 67) {
        progressFill.style.background = 'linear-gradient(90deg, #4CAF50, #8BC34A)';
    } else if (percentage >= 40) {
        progressFill.style.background = 'linear-gradient(90deg, #FF9800, #FFC107)';
    } else {
        progressFill.style.background = 'linear-gradient(90deg, #F44336, #E57373)';
    }

    // Mostrar resultados
    document.getElementById('session4QuizScore').textContent = `${correctCount}/${totalQuestions}`;
    resultsDiv.style.display = 'block';

    // Scroll hacia resultados
    resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });

    // Verificar si aprob√≥ (10/15 = 67%)
    if (correctCount >= 10) {
        completeSubActivity(4, 4);
        document.getElementById('session4CompleteButton').style.display = 'block';
        
        if (!completedSections.includes(4)) {
            completedSections.push(4);
            localStorage.setItem('completedSections', JSON.stringify(completedSections));
            updateProgress();
            createConfetti();
            
            setTimeout(() => {
                alert(`üéâ ¬°FELICIDADES! Has completado la Sesi√≥n 4 con ${correctCount}/15 correctas.\n\n‚úÖ ¬°Eres un Maestro de las Fracciones!\nüîì Sesi√≥n 5 desbloqueada`);
            }, 500);
        }
    } else {
        document.getElementById('session4CompleteButton').style.display = 'none';
        alert(`üìö Necesitas al menos 10/15 correctas para completar.\n\nüìä Tu puntuaci√≥n: ${correctCount}/15\nüí™ ¬°Revisa los conceptos y vuelve a intentarlo!`);
    }
}

// Funci√≥n para completar la sesi√≥n 4
function completeSession4() {
    if (!completedSections.includes(4)) {
        completedSections.push(4);
        localStorage.setItem('completedSections', JSON.stringify(completedSections));
        updateProgress();
    }
}
// ========== SISTEMA DE BLOQUEO SESI√ìN 4 ==========

// Mapa de pantallas de Sesi√≥n 4 y su orden
const session4Map = {
    'session4Theory1Screen': 1,
    'session4Theory2Screen': 2,
    'session4GameClassScreen': 3,
    'session4ActivityScreen': 4,
    'session4ArcadeScreen': 5
};

// Funci√≥n para actualizar el estado de bloqueo en Sesi√≥n 4
function updateSession4LockState() {
    const currentProgress = activityProgress.sesion4 || 0;
    
    // Actualizar tarjetas de navegaci√≥n
    document.querySelectorAll('#session4Screen .session4-card').forEach(card => {
        const onclickAttr = card.getAttribute('onclick');
        if (!onclickAttr) return;
        
        const targetScreen = onclickAttr.match(/showScreen\('([^']+)'/)?.[1];
        if (!targetScreen) return;
        
        const requiredIndex = session4Map[targetScreen];
        if (!requiredIndex) return;
        
        const isAvailable = requiredIndex <= currentProgress + 1;
        const isCompleted = requiredIndex <= currentProgress;
        
        // Resetear estilos
        card.classList.remove('locked', 'unlocked');
        card.style.opacity = '';
        card.style.cursor = '';
        card.onclick = null;
        
        // Obtener el h4 dentro de la tarjeta
        let h4 = card.querySelector('h4');
        if (h4) {
            h4.textContent = h4.textContent.replace(' ‚úÖ', '').replace(' üîí', '');
        }

        if (isCompleted) {
            card.classList.add('unlocked');
            card.style.opacity = '1';
            card.style.cursor = 'pointer';
            card.onclick = () => showScreen(targetScreen);
            if (h4) h4.textContent += ' ‚úÖ';
        } else if (isAvailable) {
            card.classList.add('unlocked');
            card.style.opacity = '1';
            card.style.cursor = 'pointer';
            card.onclick = () => showScreen(targetScreen);
        } else {
            card.classList.add('locked');
            card.style.opacity = '0.5';
            card.style.cursor = 'not-allowed';
          card.onclick = () => alert(`üîí Debes completar el paso ${requiredIndex - 1} antes de acceder a este contenido.`);
            if (h4) h4.textContent += ' üîí';
        }
    });
    
    // Actualizar lista de ruta de aprendizaje
    document.querySelectorAll('#session4Screen .learning-list-item').forEach(item => {
        const onclickAttr = item.getAttribute('onclick');
        if (!onclickAttr) return;
        
        const targetScreen = onclickAttr.match(/showScreen\('([^']+)'/)?.[1];
        if (!targetScreen) return;
        
        const requiredIndex = session4Map[targetScreen];
        if (!requiredIndex) return;
        
        const isAvailable = requiredIndex <= currentProgress + 1;
        
        item.classList.remove('locked-item');
        item.style.opacity = '';
        item.style.cursor = '';
        
        if (!isAvailable) {
            item.classList.add('locked-item');
            item.style.opacity = '0.5';
            item.style.cursor = 'not-allowed';
            item.onclick = (e) => {
                e.preventDefault();
                alert(`üîí Debes completar el paso ${requiredIndex - 1} antes de acceder a este contenido.`);
            };
        } else {
            item.onclick = () => showScreen(targetScreen);
        }
    });
}

// ==========================================
// CULEBRITA FRACCIONARIA - JUEGO COMPLETO
// ==========================================

// === VARIABLES GLOBALES DEL JUEGO ===
let snakeCanvas, snakeCtx;
let snakeGameLoop = null;
let snakeGame = {
    snake: [],
    direction: 'right',
    nextDirection: 'right',
    foods: [],
    correctFoodIndex: 0,
    gridSize: 20,
    canvasWidth: 400,
    canvasHeight: 300,
    score: 0,
    level: 1,
    lives: 5,
    speed: 150,
    isRunning: false,
    currentQuestion: null,
    questionsAnswered: 0,
    questionsPerLevel: 3,
    isFullscreen: false,
    isMobile: false
};

// Variable para guardar la √∫ltima respuesta incorrecta
let lastWrongAnswer = null;

// === BANCO DE PREGUNTAS POR NIVEL ===

// === BANCO DE PREGUNTAS POR NIVEL (AMPLIADO - SIN REPETIR) ===
const snakeQuestions = {
    // Nivel 1-2: Identificar fracciones b√°sicas
    easy: [
        { question: "¬øCu√°l representa UN MEDIO?", correct: "1/2", wrong: ["1/3", "2/1", "1/4"] },
        { question: "¬øCu√°l representa UN TERCIO?", correct: "1/3", wrong: ["1/2", "3/1", "1/4"] },
        { question: "¬øCu√°l representa UN CUARTO?", correct: "1/4", wrong: ["1/2", "4/1", "1/3"] },
        { question: "¬øCu√°l representa DOS TERCIOS?", correct: "2/3", wrong: ["3/2", "2/4", "1/3"] },
        { question: "¬øCu√°l representa TRES CUARTOS?", correct: "3/4", wrong: ["4/3", "3/5", "1/4"] },
        { question: "¬øCu√°l es el NUMERADOR de 5/8?", correct: "5", wrong: ["8", "3", "13"] },
        { question: "¬øCu√°l es el DENOMINADOR de 3/7?", correct: "7", wrong: ["3", "10", "4"] },
        { question: "¬øCu√°l representa DOS QUINTOS?", correct: "2/5", wrong: ["5/2", "2/3", "1/5"] },
        { question: "En 4/9, ¬øcu√°l es el numerador?", correct: "4", wrong: ["9", "5", "13"] },
        { question: "En 7/10, ¬øcu√°l es el denominador?", correct: "10", wrong: ["7", "17", "3"] },
        { question: "¬øCu√°l representa CINCO SEXTOS?", correct: "5/6", wrong: ["6/5", "5/5", "1/6"] },
        { question: "¬øCu√°l representa UN QUINTO?", correct: "1/5", wrong: ["5/1", "1/4", "2/5"] },
        { question: "¬øCu√°l es el NUMERADOR de 9/11?", correct: "9", wrong: ["11", "2", "20"] },
        { question: "¬øCu√°l representa CUATRO QUINTOS?", correct: "4/5", wrong: ["5/4", "4/4", "3/5"] },
        { question: "En 6/7, ¬øcu√°l es el denominador?", correct: "7", wrong: ["6", "13", "1"] },
        { question: "¬øCu√°l representa TRES QUINTOS?", correct: "3/5", wrong: ["5/3", "3/3", "2/5"] },
        { question: "¬øCu√°l es el NUMERADOR de 2/9?", correct: "2", wrong: ["9", "7", "11"] },
        { question: "¬øCu√°l representa UN SEXTO?", correct: "1/6", wrong: ["6/1", "1/5", "2/6"] },
        { question: "En 8/9, ¬øcu√°l es el numerador?", correct: "8", wrong: ["9", "1", "17"] },
        { question: "¬øCu√°l representa SIETE OCTAVOS?", correct: "7/8", wrong: ["8/7", "7/7", "6/8"] }
    ],
    // Nivel 3-4: Fracciones equivalentes
    medium: [
        { question: "¬øCu√°l es equivalente a 1/2?", correct: "2/4", wrong: ["1/4", "2/3", "3/4"] },
        { question: "¬øCu√°l es equivalente a 1/2?", correct: "3/6", wrong: ["2/3", "1/3", "4/5"] },
        { question: "¬øCu√°l es equivalente a 2/3?", correct: "4/6", wrong: ["3/4", "2/4", "3/6"] },
        { question: "¬øCu√°l es equivalente a 1/4?", correct: "2/8", wrong: ["1/2", "4/8", "1/8"] },
        { question: "¬øCu√°l es equivalente a 3/4?", correct: "6/8", wrong: ["4/6", "3/8", "4/8"] },
        { question: "¬øCu√°l es equivalente a 1/3?", correct: "2/6", wrong: ["1/6", "3/6", "2/3"] },
        { question: "¬øCu√°l es equivalente a 2/5?", correct: "4/10", wrong: ["2/10", "5/10", "3/5"] },
        { question: "¬øCu√°l es equivalente a 1/5?", correct: "2/10", wrong: ["5/10", "1/10", "2/5"] },
        { question: "¬øCu√°l es equivalente a 4/8?", correct: "1/2", wrong: ["2/3", "1/4", "3/4"] },
        { question: "¬øCu√°l es equivalente a 6/9?", correct: "2/3", wrong: ["3/4", "1/3", "3/6"] },
        { question: "¬øCu√°l es equivalente a 1/2?", correct: "5/10", wrong: ["3/10", "2/10", "1/5"] },
        { question: "¬øCu√°l es equivalente a 3/5?", correct: "6/10", wrong: ["5/10", "3/10", "9/10"] },
        { question: "¬øCu√°l es equivalente a 2/4?", correct: "1/2", wrong: ["1/4", "3/4", "2/3"] },
        { question: "¬øCu√°l es equivalente a 4/5?", correct: "8/10", wrong: ["4/10", "5/10", "6/10"] },
        { question: "¬øCu√°l es equivalente a 1/3?", correct: "3/9", wrong: ["2/9", "1/9", "4/9"] },
        { question: "¬øCu√°l es equivalente a 2/3?", correct: "6/9", wrong: ["3/9", "4/9", "5/9"] },
        { question: "¬øCu√°l es equivalente a 3/6?", correct: "1/2", wrong: ["2/6", "1/3", "1/6"] },
        { question: "¬øCu√°l es equivalente a 1/4?", correct: "3/12", wrong: ["4/12", "2/12", "6/12"] },
        { question: "¬øCu√°l es equivalente a 5/10?", correct: "1/2", wrong: ["1/5", "2/5", "1/10"] },
        { question: "¬øCu√°l es equivalente a 2/6?", correct: "1/3", wrong: ["2/3", "1/6", "3/6"] }
    ],
    // Nivel 5-6: Simplificaci√≥n
    hard: [
        { question: "Simplifica 4/8", correct: "1/2", wrong: ["2/4", "1/4", "2/8"] },
        { question: "Simplifica 6/9", correct: "2/3", wrong: ["3/4", "1/3", "3/6"] },
        { question: "Simplifica 8/12", correct: "2/3", wrong: ["4/6", "1/2", "3/4"] },
        { question: "Simplifica 10/15", correct: "2/3", wrong: ["5/7", "1/3", "2/5"] },
        { question: "Simplifica 6/8", correct: "3/4", wrong: ["2/4", "1/2", "2/3"] },
        { question: "Simplifica 9/12", correct: "3/4", wrong: ["1/2", "2/3", "4/6"] },
        { question: "Simplifica 4/6", correct: "2/3", wrong: ["1/3", "1/2", "3/4"] },
        { question: "Simplifica 15/20", correct: "3/4", wrong: ["5/10", "1/2", "2/3"] },
        { question: "Simplifica 12/16", correct: "3/4", wrong: ["6/8", "1/2", "2/3"] },
        { question: "Simplifica 5/10", correct: "1/2", wrong: ["1/5", "2/5", "1/4"] },
        { question: "Simplifica 3/9", correct: "1/3", wrong: ["1/9", "3/3", "2/3"] },
        { question: "Simplifica 6/10", correct: "3/5", wrong: ["2/5", "1/5", "6/5"] },
        { question: "Simplifica 8/10", correct: "4/5", wrong: ["2/5", "8/5", "3/5"] },
        { question: "Simplifica 4/12", correct: "1/3", wrong: ["2/6", "1/4", "2/3"] },
        { question: "Simplifica 6/12", correct: "1/2", wrong: ["3/6", "2/4", "1/6"] },
        { question: "Simplifica 9/15", correct: "3/5", wrong: ["1/5", "9/5", "2/5"] },
        { question: "Simplifica 10/12", correct: "5/6", wrong: ["2/3", "5/12", "1/2"] },
        { question: "Simplifica 14/21", correct: "2/3", wrong: ["7/21", "1/3", "14/7"] },
        { question: "Simplifica 8/20", correct: "2/5", wrong: ["4/10", "1/5", "4/5"] },
        { question: "Simplifica 12/18", correct: "2/3", wrong: ["6/9", "4/6", "1/3"] }
    ],
    // Nivel 7-8: Amplificaci√≥n y MCD
    expert: [
        { question: "Amplifica 1/2 por 3", correct: "3/6", wrong: ["1/6", "2/6", "3/2"] },
        { question: "Amplifica 2/3 por 4", correct: "8/12", wrong: ["6/12", "2/12", "4/6"] },
        { question: "Amplifica 1/4 por 5", correct: "5/20", wrong: ["4/20", "1/20", "5/4"] },
        { question: "Amplifica 3/5 por 2", correct: "6/10", wrong: ["3/10", "5/10", "6/5"] },
        { question: "¬øCu√°l es el MCD de 8 y 12?", correct: "4", wrong: ["2", "6", "8"] },
        { question: "¬øCu√°l es el MCD de 6 y 9?", correct: "3", wrong: ["6", "2", "9"] },
        { question: "¬øCu√°l es el MCD de 10 y 15?", correct: "5", wrong: ["10", "3", "15"] },
        { question: "Amplifica 1/3 por 4", correct: "4/12", wrong: ["3/12", "1/12", "4/3"] },
        { question: "¬øCu√°l es el MCD de 12 y 18?", correct: "6", wrong: ["3", "12", "9"] },
        { question: "Amplifica 2/5 por 3", correct: "6/15", wrong: ["2/15", "5/15", "6/5"] },
        { question: "Amplifica 1/2 por 5", correct: "5/10", wrong: ["2/10", "1/10", "5/2"] },
        { question: "Amplifica 3/4 por 3", correct: "9/12", wrong: ["3/12", "6/12", "9/4"] },
        { question: "¬øCu√°l es el MCD de 9 y 12?", correct: "3", wrong: ["9", "6", "12"] },
        { question: "¬øCu√°l es el MCD de 14 y 21?", correct: "7", wrong: ["14", "3", "21"] },
        { question: "Amplifica 2/3 por 5", correct: "10/15", wrong: ["5/15", "2/15", "10/3"] },
        { question: "¬øCu√°l es el MCD de 16 y 24?", correct: "8", wrong: ["4", "16", "6"] },
        { question: "Amplifica 1/5 por 4", correct: "4/20", wrong: ["1/20", "5/20", "4/5"] },
        { question: "¬øCu√°l es el MCD de 15 y 20?", correct: "5", wrong: ["10", "15", "4"] },
        { question: "Amplifica 4/5 por 2", correct: "8/10", wrong: ["4/10", "2/10", "8/5"] },
        { question: "¬øCu√°l es el MCD de 18 y 24?", correct: "6", wrong: ["3", "12", "18"] }
    ]
};

// Variable para controlar preguntas ya usadas
let usedQuestions = { easy: [], medium: [], hard: [], expert: [] };

// === INICIALIZACI√ìN DEL JUEGO ===
let swipeControlsInitialized = false;

function initSnakeGame() {
    snakeGame.isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent) || ('ontouchstart' in window && window.innerWidth < 1024);
    
    if (snakeGame.isMobile) {
        snakeGame.isFullscreen = true;
        const container = document.getElementById('snakeFullscreenContainer');
        container.style.display = 'block';
        document.getElementById('session4ArcadeScreen').style.display = 'none';
        snakeCanvas = document.getElementById('snakeCanvasFS');
        snakeCtx = snakeCanvas.getContext('2d');
        
        if (window.innerHeight > window.innerWidth) {
            document.getElementById('snakeOverlayFS').style.display = 'flex';
            document.getElementById('snakeOverlayContentFS').innerHTML = `
                <p style="font-size: 3em; margin-bottom: 20px;">üì±</p>
                <p style="font-size: 1.5em; color: #FFD700; font-weight: 700; margin-bottom: 15px;">¬°Gira tu celular!</p>
                <p style="font-size: 1.1em; color: #B3E5FC; margin-bottom: 25px;">Pon el celular en horizontal para mejor experiencia</p>
                <button onclick="forceStartSnakeGame()" style="background: linear-gradient(135deg, #4CAF50, #8BC34A); color: white; border: none; padding: 15px 40px; font-size: 1.2em; font-weight: 700; border-radius: 30px; cursor: pointer;">Continuar de todos modos ‚Üí</button>
            `;
            return;
        }
        setupFullscreenCanvas();
        if (!swipeControlsInitialized) {
            setupSwipeControls();
            swipeControlsInitialized = true;
        }
    } else {
        snakeGame.isFullscreen = false;
        snakeCanvas = document.getElementById('snakeCanvas');
        snakeCtx = snakeCanvas.getContext('2d');
        const maxSize = Math.min(window.innerWidth - 30, 600);
        snakeGame.canvasWidth = Math.floor(maxSize / snakeGame.gridSize) * snakeGame.gridSize;
        snakeGame.canvasHeight = snakeGame.canvasWidth;
        snakeCanvas.width = snakeGame.canvasWidth;
        snakeCanvas.height = snakeGame.canvasHeight;
    }
    document.addEventListener('keydown', handleSnakeKeydown);
}

function setupFullscreenCanvas() {
    const availableHeight = window.innerHeight - 50; // Solo el HUD superior
    const availableWidth = window.innerWidth - 10;
    snakeGame.canvasWidth = Math.floor(availableWidth / snakeGame.gridSize) * snakeGame.gridSize;
    snakeGame.canvasHeight = Math.floor(availableHeight / snakeGame.gridSize) * snakeGame.gridSize;
    snakeCanvas.width = snakeGame.canvasWidth;
    snakeCanvas.height = snakeGame.canvasHeight;
}

function setupSwipeControls() {
    let touchStartX = 0, touchStartY = 0;
    const canvas = document.getElementById('snakeCanvasFS');
    
    // Solo capturar swipes en el canvas, no en toda la pantalla
    canvas.addEventListener('touchstart', function(e) {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
        e.preventDefault();
    }, { passive: false });
    
    canvas.addEventListener('touchmove', function(e) { 
        e.preventDefault(); 
    }, { passive: false });
    
    canvas.addEventListener('touchend', function(e) {
        if (!snakeGame.isRunning) return;
        const diffX = e.changedTouches[0].clientX - touchStartX;
        const diffY = e.changedTouches[0].clientY - touchStartY;
        if (Math.abs(diffX) > Math.abs(diffY)) {
            if (diffX > 30 && snakeGame.direction !== 'left') snakeGame.nextDirection = 'right';
            else if (diffX < -30 && snakeGame.direction !== 'right') snakeGame.nextDirection = 'left';
        } else {
            if (diffY > 30 && snakeGame.direction !== 'up') snakeGame.nextDirection = 'down';
            else if (diffY < -30 && snakeGame.direction !== 'down') snakeGame.nextDirection = 'up';
        }
    }, { passive: false });
}

function forceStartSnakeGame() {
    document.getElementById('snakeOverlayFS').style.display = 'none';
    setupFullscreenCanvas();
    if (!swipeControlsInitialized) {
        setupSwipeControls();
        swipeControlsInitialized = true;
    }
    resetSnakeState();
    generateNewQuestion();
    showReadyOverlay();
}

function exitSnakeFullscreen() {
    snakeGame.isRunning = false;
    clearTimeout(snakeGameLoop);
    
    const container = document.getElementById('snakeFullscreenContainer');
    if (container) {
        container.style.display = 'none';
    }
    
    // Resetear estados para que la pr√≥xima vez funcione bien
    snakeGame.isFullscreen = false;
    snakeGame.isMobile = false;
    
    showScreen('session4Screen');
}

function showReadyOverlay() {
    const overlay = snakeGame.isFullscreen ? document.getElementById('snakeOverlayFS') : document.getElementById('snakeOverlay');
    const content = snakeGame.isFullscreen ? document.getElementById('snakeOverlayContentFS') : document.getElementById('snakeOverlayContent');
    content.innerHTML = `
        <p style="font-size: 2em; color: #FFD700; font-weight: 700; margin-bottom: 15px;">üêç ¬øListo?</p>
        <p style="font-size: 1.1em; color: #B3E5FC; margin-bottom: 25px;">Come la respuesta correcta<br>¬°Cuidado con las paredes y tu cola!</p>
        <button onclick="beginSnakeGame()" style="background: linear-gradient(135deg, #4CAF50, #8BC34A); color: white; border: none; padding: 18px 50px; font-size: 1.3em; font-weight: 700; border-radius: 30px; cursor: pointer; -webkit-tap-highlight-color: transparent;">üéÆ ¬°INICIAR!</button>
    `;
    overlay.style.display = 'flex';
}

// === INICIAR PARTIDA ===
function startSnakeGame() {
    usedQuestions = { easy: [], medium: [], hard: [], expert: [] };
    initSnakeGame();
    
    // Si se mostr√≥ el mensaje de girar celular, salir y esperar
    if (snakeGame.isMobile && document.getElementById('snakeOverlayFS').style.display === 'flex') {
        return;
    }
    
    if (snakeGame.isFullscreen) {
        resetSnakeState();
        generateNewQuestion();
        drawSnakeGame();
        showReadyOverlay();
    } else {
        document.getElementById('snakeStartScreen').style.display = 'none';
        document.getElementById('snakeGameScreen').style.display = 'block';
        document.getElementById('snakeWinScreen').style.display = 'none';
        document.getElementById('snakeGameOverScreen').style.display = 'none';
        resetSnakeState();
        generateNewQuestion();
        drawSnakeGame();
        showReadyOverlay();
    }
}

// === COMENZAR EL JUEGO DESPU√âS DEL BOT√ìN ===
function beginSnakeGame() {
    const overlay = snakeGame.isFullscreen ? document.getElementById('snakeOverlayFS') : document.getElementById('snakeOverlay');
    overlay.style.display = 'none';
    
    snakeGame.isRunning = true;
    drawSnakeGame();
    snakeGameMainLoop();
}

// === RESETEAR ESTADO DEL JUEGO ===
function resetSnakeState() {
    const startX = Math.floor(snakeGame.canvasWidth / snakeGame.gridSize / 4) * snakeGame.gridSize;
    const startY = Math.floor(snakeGame.canvasHeight / snakeGame.gridSize / 2) * snakeGame.gridSize;
    
    snakeGame.snake = [
        { x: startX, y: startY },
        { x: startX - snakeGame.gridSize, y: startY },
        { x: startX - snakeGame.gridSize * 2, y: startY }
    ];
    snakeGame.direction = 'right';
    snakeGame.nextDirection = 'right';
    snakeGame.score = 0;
    snakeGame.level = 1;
    snakeGame.lives = 5;
    snakeGame.speed = 150;
    snakeGame.questionsAnswered = 0;
    
    updateSnakeHUD();
    updateLivesDisplay();
}

// === GENERAR NUEVA PREGUNTA ===


// === GENERAR NUEVA PREGUNTA ===
function generateNewQuestion() {
    let questionPool;
    let poolName;
    if (snakeGame.level <= 2) {
        questionPool = snakeQuestions.easy;
        poolName = 'easy';
    } else if (snakeGame.level <= 4) {
        questionPool = snakeQuestions.medium;
        poolName = 'medium';
    } else if (snakeGame.level <= 6) {
        questionPool = snakeQuestions.hard;
        poolName = 'hard';
    } else {
        questionPool = snakeQuestions.expert;
        poolName = 'expert';
    }
    
    // Obtener preguntas disponibles (no usadas)
    let availableIndices = [];
    for (let i = 0; i < questionPool.length; i++) {
        if (!usedQuestions[poolName].includes(i)) {
            availableIndices.push(i);
        }
    }
    
    // Si ya usamos todas, reiniciar el pool
    if (availableIndices.length === 0) {
        usedQuestions[poolName] = [];
        for (let i = 0; i < questionPool.length; i++) {
            availableIndices.push(i);
        }
    }
    
    // Seleccionar pregunta aleatoria de las disponibles
    const randomIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
    usedQuestions[poolName].push(randomIndex);
    const question = questionPool[randomIndex];
    snakeGame.currentQuestion = question;
        
    // Crear las 4 opciones de comida
    const allOptions = [question.correct, ...question.wrong];
    shuffleSnakeArray(allOptions);
    
    snakeGame.correctFoodIndex = allOptions.indexOf(question.correct);
    snakeGame.foods = [];
    
    // Colores para las opciones
    const colors = ['#FF5722', '#2196F3', '#4CAF50', '#FFC107'];
    const emojis = ['üî¥', 'üîµ', 'üü¢', 'üü°'];
    
    // Posicionar comidas aleatoriamente
    for (let i = 0; i < 4; i++) {
        let pos;
        let attempts = 0;
        do {
            pos = getRandomSnakePosition();
            attempts++;
        } while ((isSnakePositionOccupied(pos) || isTooCloseToOtherSnakeFood(pos) || isTooCloseToSnakeHead(pos)) && attempts < 100);
        
        snakeGame.foods.push({
            x: pos.x,
            y: pos.y,
            value: allOptions[i],
            color: colors[i],
            emoji: emojis[i],
            isCorrect: i === snakeGame.correctFoodIndex
        });
    }
    
    }

// === POSICI√ìN ALEATORIA ===
function getRandomSnakePosition() {
    const gridCountX = snakeGame.canvasWidth / snakeGame.gridSize;
    const gridCountY = snakeGame.canvasHeight / snakeGame.gridSize;
    return {
        x: Math.floor(Math.random() * gridCountX) * snakeGame.gridSize,
        y: Math.floor(Math.random() * (gridCountY - 3) + 3) * snakeGame.gridSize
    };
}

// === VERIFICAR SI POSICI√ìN EST√Å OCUPADA ===
function isSnakePositionOccupied(pos) {
    // Verificar contra la serpiente (posici√≥n exacta)
    for (let segment of snakeGame.snake) {
        if (segment.x === pos.x && segment.y === pos.y) return true;
    }
    // Verificar contra otras comidas
    for (let food of snakeGame.foods) {
        if (food.x === pos.x && food.y === pos.y) return true;
    }
    return false;
}

// === VERIFICAR SI EST√Å MUY CERCA DE LA CABEZA ===
function isTooCloseToSnakeHead(pos) {
    const head = snakeGame.snake[0];
    if (!head) return false;
    
    // Distancia m√≠nima: 5 celdas de la cabeza
    const minDistance = snakeGame.gridSize * 5;
    const distX = Math.abs(pos.x - head.x);
    const distY = Math.abs(pos.y - head.y);
    
    return (distX < minDistance && distY < minDistance);
}

// === VERIFICAR SI EST√Å MUY CERCA DE OTRA COMIDA ===
function isTooCloseToOtherSnakeFood(pos) {
    const minDistance = snakeGame.gridSize * 3;
    for (let food of snakeGame.foods) {
        const dist = Math.abs(food.x - pos.x) + Math.abs(food.y - pos.y);
        if (dist < minDistance) return true;
    }
    return false;
}

// === MEZCLAR ARRAY ===
function shuffleSnakeArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}



// === LOOP PRINCIPAL DEL JUEGO ===
function snakeGameMainLoop() {
    if (!snakeGame.isRunning) return;
    
    snakeGame.direction = snakeGame.nextDirection;
    moveSnake();
    
    if (checkSnakeCollision()) {
        loseSnakeLife();
        return;
    }
    
    const eatenFood = checkSnakeFoodCollision();
    if (eatenFood !== null) {
        if (eatenFood.isCorrect) {
            // Respuesta correcta
            snakeGame.score += 100 * snakeGame.level;
            snakeGame.questionsAnswered++;
            
            // Verificar si sube de nivel
            if (snakeGame.questionsAnswered >= snakeGame.questionsPerLevel) {
                snakeLevelUp();
            } else {
                generateNewQuestion();
            }
            
            updateSnakeHUD();
       } else {
        // Respuesta incorrecta
        loseSnakeLife(eatenFood);
        return;
  		  }
    }
    
    drawSnakeGame();
    snakeGameLoop = setTimeout(snakeGameMainLoop, snakeGame.speed);
}

// === MOVER SERPIENTE ===
function moveSnake() {
    const head = { ...snakeGame.snake[0] };
    
    switch (snakeGame.direction) {
        case 'up': head.y -= snakeGame.gridSize; break;
        case 'down': head.y += snakeGame.gridSize; break;
        case 'left': head.x -= snakeGame.gridSize; break;
        case 'right': head.x += snakeGame.gridSize; break;
    }
    
    snakeGame.snake.unshift(head);
    
    // Solo quitar la cola si no comi√≥
    const eatenFood = snakeGame.foods.find(f => f.x === head.x && f.y === head.y);
    if (!eatenFood || !eatenFood.isCorrect) {
        snakeGame.snake.pop();
    }
}

// === VERIFICAR COLISI√ìN CON PAREDES Y CUERPO ===
function checkSnakeCollision() {
    const head = snakeGame.snake[0];
    
    // Colisi√≥n con paredes
    if (head.x < 0 || head.x >= snakeGame.canvasWidth || 
        head.y < 0 || head.y >= snakeGame.canvasHeight) {
        return true;
    }
    
    // Colisi√≥n con el propio cuerpo
    for (let i = 1; i < snakeGame.snake.length; i++) {
        if (head.x === snakeGame.snake[i].x && head.y === snakeGame.snake[i].y) {
            return true;
        }
    }
    
    return false;
}

// === VERIFICAR COLISI√ìN CON COMIDA ===
// === VERIFICAR COLISI√ìN CON COMIDA ===
function checkSnakeFoodCollision() {
    const head = snakeGame.snake[0];
    const headCenterX = head.x + snakeGame.gridSize / 2;
    const headCenterY = head.y + snakeGame.gridSize / 2;
    
    for (let i = 0; i < snakeGame.foods.length; i++) {
        const food = snakeGame.foods[i];
        const foodCenterX = food.x + snakeGame.gridSize / 2;
        const foodCenterY = food.y + snakeGame.gridSize / 2;
        
        // Calcular distancia entre centros
        const distance = Math.sqrt(
            Math.pow(headCenterX - foodCenterX, 2) + 
            Math.pow(headCenterY - foodCenterY, 2)
        );
        
        // Si la distancia es menor al tama√±o de la comida, hay colisi√≥n
        const foodRadius = snakeGame.gridSize * 0.9;
        if (distance < foodRadius) {
            snakeGame.foods.splice(i, 1);
            return food;
        }
    }
    
    return null;
}

// === PERDER VIDA ===
// === PERDER VIDA ===
function loseSnakeLife(wrongFood = null) {
    snakeGame.lives--;
    updateLivesDisplay();
    
    if (snakeGame.lives <= 0) {
        snakeGameOver();
    } else {
        snakeGame.isRunning = false;
        clearTimeout(snakeGameLoop);
        
        // Mostrar retroalimentaci√≥n
        const overlay = snakeGame.isFullscreen ? document.getElementById('snakeOverlayFS') : document.getElementById('snakeOverlay');
        const content = snakeGame.isFullscreen ? document.getElementById('snakeOverlayContentFS') : document.getElementById('snakeOverlayContent');
        
        let mensaje = '';
        if (wrongFood) {
            mensaje = `
                <p style="font-size: 1.5em; color: #F44336; font-weight: 700; margin-bottom: 15px;">üíî ¬°Perdiste una vida!</p>
                <p style="font-size: 1.2em; color: #FFCDD2; margin-bottom: 10px;">Escogiste: <strong style="color: #FF5722;">${wrongFood.value}</strong></p>
                <p style="font-size: 1.2em; color: #A5D6A7; margin-bottom: 20px;">Respuesta correcta: <strong style="color: #4CAF50;">${snakeGame.currentQuestion.correct}</strong></p>
                <p style="font-size: 1em; color: #B3E5FC;">Vidas restantes: ${'‚ù§Ô∏è'.repeat(snakeGame.lives)}${'üñ§'.repeat(5 - snakeGame.lives)}</p>
                <button onclick="continueAfterWrong()" style="margin-top: 20px; background: linear-gradient(135deg, #9C27B0, #E91E63); color: white; border: none; padding: 15px 40px; font-size: 1.2em; font-weight: 700; border-radius: 30px; cursor: pointer; box-shadow: 0 5px 20px rgba(156, 39, 176, 0.4);">
                    ‚ñ∂ Continuar
                </button>
            `;
        } else {
            mensaje = `
                <p style="font-size: 1.5em; color: #F44336; font-weight: 700; margin-bottom: 15px;">üí• ¬°Chocaste!</p>
                <p style="font-size: 1em; color: #B3E5FC; margin-bottom: 20px;">Vidas restantes: ${'‚ù§Ô∏è'.repeat(snakeGame.lives)}${'üñ§'.repeat(5 - snakeGame.lives)}</p>
                <button onclick="continueAfterWrong()" style="margin-top: 20px; background: linear-gradient(135deg, #9C27B0, #E91E63); color: white; border: none; padding: 15px 40px; font-size: 1.2em; font-weight: 700; border-radius: 30px; cursor: pointer; box-shadow: 0 5px 20px rgba(156, 39, 176, 0.4);">
                    ‚ñ∂ Continuar
                </button>
            `;
        }
        
        content.innerHTML = mensaje;
        overlay.style.display = 'flex';
    }
}

// === CONTINUAR DESPU√âS DE ERROR ===
function continueAfterWrong() {
    const overlay = snakeGame.isFullscreen ? document.getElementById('snakeOverlayFS') : document.getElementById('snakeOverlay');
    overlay.style.display = 'none';
    
    // Reiniciar posici√≥n de la serpiente
    const startX = Math.floor(snakeGame.canvasWidth / snakeGame.gridSize / 4) * snakeGame.gridSize;
    const startY = Math.floor(snakeGame.canvasHeight / snakeGame.gridSize / 2) * snakeGame.gridSize;
    
    snakeGame.snake = [
        { x: startX, y: startY },
        { x: startX - snakeGame.gridSize, y: startY },
        { x: startX - snakeGame.gridSize * 2, y: startY }
    ];
    snakeGame.direction = 'right';
    snakeGame.nextDirection = 'right';
    
    generateNewQuestion();
    snakeGame.isRunning = true;
    snakeGameMainLoop();
}

// === SUBIR DE NIVEL ===
function snakeLevelUp() {
    snakeGame.level++;
    snakeGame.questionsAnswered = 0;
    
    // Aumentar velocidad (m√°s r√°pido = menos ms)
    snakeGame.speed = Math.max(80, 150 - (snakeGame.level - 1) * 10);
    
    if (snakeGame.level > 8) {
        // Victoria
        snakeVictory();
    } else {
        showSnakeMessage(`üéâ ¬°NIVEL ${snakeGame.level}!`, '#4CAF50', 2000);
        
        setTimeout(() => {
            generateNewQuestion();
            snakeGame.isRunning = true;
            snakeGameMainLoop();
        }, 2000);
    }
}

// === MOSTRAR MENSAJE EN OVERLAY ===
function showSnakeMessage(text, color, duration) {
    snakeGame.isRunning = false;
    clearTimeout(snakeGameLoop);
    
    const overlay = document.getElementById('snakeOverlay');
    const content = document.getElementById('snakeOverlayContent');
    
    content.innerHTML = `<p style="font-size: 2em; color: ${color}; font-weight: 700; text-shadow: 0 0 20px ${color};">${text}</p>`;
    overlay.style.display = 'flex';
    
    setTimeout(() => {
        overlay.style.display = 'none';
    }, duration);
}

// === GAME OVER ===
function snakeGameOver() {
    snakeGame.isRunning = false;
    clearTimeout(snakeGameLoop);
    
    // Ocultar fullscreen si estaba activo
    const container = document.getElementById('snakeFullscreenContainer');
    if (container) container.style.display = 'none';
    snakeGame.isFullscreen = false;
    snakeGame.isMobile = false;
    
    // Mostrar pantalla de game over
    document.getElementById('snakeStartScreen').style.display = 'none';
    document.getElementById('snakeGameScreen').style.display = 'none';
    document.getElementById('snakeGameOverScreen').style.display = 'block';
    document.getElementById('snakeGameOverLevel').textContent = snakeGame.level;
    document.getElementById('snakeGameOverScore').textContent = snakeGame.score;
}

// === VICTORIA ===
function snakeVictory() {
    snakeGame.isRunning = false;
    clearTimeout(snakeGameLoop);
    
    // Ocultar fullscreen si estaba activo
    const container = document.getElementById('snakeFullscreenContainer');
    if (container) container.style.display = 'none';
    snakeGame.isFullscreen = false;
    snakeGame.isMobile = false;
    
    // Mostrar pantalla de victoria
    document.getElementById('snakeStartScreen').style.display = 'none';
    document.getElementById('snakeGameScreen').style.display = 'none';
    document.getElementById('snakeWinScreen').style.display = 'block';
    document.getElementById('snakeFinalScore').textContent = snakeGame.score;
    
    // Marcar como completado
    if (typeof completeSubActivity === 'function') {
        completeSubActivity(4, 5);
    }
    if (typeof createConfetti === 'function') {
        createConfetti();
    }
}

// === DIBUJAR JUEGO ===
function drawSnakeGame() {
    // Limpiar canvas
    snakeCtx.fillStyle = '#1a1a2e';
    snakeCtx.fillRect(0, 0, snakeGame.canvasWidth, snakeGame.canvasHeight);
    
    // Dibujar grid sutil
    snakeCtx.strokeStyle = 'rgba(156, 39, 176, 0.1)';
    snakeCtx.lineWidth = 1;
    for (let i = 0; i <= snakeGame.canvasWidth; i += snakeGame.gridSize) {
        snakeCtx.beginPath();
        snakeCtx.moveTo(i, 0);
        snakeCtx.lineTo(i, snakeGame.canvasHeight);
        snakeCtx.stroke();
    }
    for (let i = 0; i <= snakeGame.canvasHeight; i += snakeGame.gridSize) {
        snakeCtx.beginPath();
        snakeCtx.moveTo(0, i);
        snakeCtx.lineTo(snakeGame.canvasWidth, i);
        snakeCtx.stroke();
    }
    
    // ====== DIBUJAR PREGUNTA DENTRO DEL CANVAS ======
    const questionText = snakeGame.currentQuestion ? snakeGame.currentQuestion.question : '';
    snakeCtx.fillStyle = 'rgba(26, 35, 126, 0.9)';
    snakeCtx.fillRect(0, 0, snakeGame.canvasWidth, 50);
    
    // Borde inferior de la pregunta
    snakeCtx.strokeStyle = '#9C27B0';
    snakeCtx.lineWidth = 3;
    snakeCtx.beginPath();
    snakeCtx.moveTo(0, 50);
    snakeCtx.lineTo(snakeGame.canvasWidth, 50);
    snakeCtx.stroke();
    
    // Texto de la pregunta
    snakeCtx.fillStyle = '#FFFFFF';
    snakeCtx.font = 'bold 16px Arial';
    snakeCtx.textAlign = 'center';
    snakeCtx.textBaseline = 'middle';
    snakeCtx.fillText(questionText, snakeGame.canvasWidth / 2, 25);
    
    // ====== DIBUJAR COMIDAS M√ÅS GRANDES ======
    const foodSize = snakeGame.gridSize * 1.8; // M√°s grandes
    
    snakeGame.foods.forEach(food => {
        // C√≠rculo de color m√°s grande
        snakeCtx.fillStyle = food.color;
        snakeCtx.beginPath();
        snakeCtx.arc(
            food.x + snakeGame.gridSize / 2,
            food.y + snakeGame.gridSize / 2,
            foodSize / 2,
            0,
            Math.PI * 2
        );
        snakeCtx.fill();
        
        // Borde brillante
        snakeCtx.strokeStyle = 'white';
        snakeCtx.lineWidth = 3;
        snakeCtx.stroke();
        
        // Sombra para resaltar
        snakeCtx.shadowColor = food.color;
        snakeCtx.shadowBlur = 15;
        
        // Texto del valor m√°s grande
        snakeCtx.fillStyle = 'white';
        snakeCtx.font = `bold ${foodSize * 0.4}px Arial`;
        snakeCtx.textAlign = 'center';
        snakeCtx.textBaseline = 'middle';
        snakeCtx.fillText(
            food.value,
            food.x + snakeGame.gridSize / 2,
            food.y + snakeGame.gridSize / 2
        );
        
        // Resetear sombra
        snakeCtx.shadowBlur = 0;
    });
    
    // ====== DIBUJAR SERPIENTE ======
    snakeGame.snake.forEach((segment, index) => {
        // Gradiente de color para el cuerpo
        const hue = 280 + (index * 5) % 60;
        snakeCtx.fillStyle = index === 0 ? '#E91E63' : `hsl(${hue}, 70%, 50%)`;
        
        // Cuerpo redondeado
        snakeCtx.beginPath();
        snakeCtx.roundRect(
            segment.x + 1,
            segment.y + 1,
            snakeGame.gridSize - 2,
            snakeGame.gridSize - 2,
            5
        );
        snakeCtx.fill();
        
        // Ojos en la cabeza
        if (index === 0) {
            snakeCtx.fillStyle = 'white';
            const eyeSize = 4;
            let eyeOffset = { x: 0, y: 0 };
            
            switch (snakeGame.direction) {
                case 'right': eyeOffset = { x: 10, y: 4 }; break;
                case 'left': eyeOffset = { x: 4, y: 4 }; break;
                case 'up': eyeOffset = { x: 4, y: 4 }; break;
                case 'down': eyeOffset = { x: 4, y: 10 }; break;
            }
            
            snakeCtx.beginPath();
            snakeCtx.arc(segment.x + eyeOffset.x, segment.y + eyeOffset.y, eyeSize, 0, Math.PI * 2);
            snakeCtx.arc(segment.x + eyeOffset.x + 6, segment.y + eyeOffset.y, eyeSize, 0, Math.PI * 2);
            snakeCtx.fill();
        }
    });
}




// === ACTUALIZAR HUD ===
function updateSnakeHUD() {
    if (snakeGame.isFullscreen) {
        document.getElementById('snakeLevelFS').textContent = snakeGame.level;
        document.getElementById('snakeScoreFS').textContent = snakeGame.score;
    } else {
        const levelEl = document.getElementById('snakeLevel');
        const scoreEl = document.getElementById('snakeScore');
        if (levelEl) levelEl.textContent = snakeGame.level;
        if (scoreEl) scoreEl.textContent = snakeGame.score;
    }
}

// === ACTUALIZAR DISPLAY DE VIDAS ===
function updateLivesDisplay() {
    const heartClass = snakeGame.isFullscreen ? '.snakeHeartFS' : '.snakeHeart';
    const hearts = document.querySelectorAll(heartClass);
    hearts.forEach((heart, index) => {
        heart.style.opacity = index < snakeGame.lives ? '1' : '0.3';
        heart.style.filter = index < snakeGame.lives ? 'none' : 'grayscale(100%)';
    });
}

// === CONTROLES DE TECLADO ===
function handleSnakeKeydown(e) {
    if (!snakeGame.isRunning) return;
    
    const key = e.key;
    
    if (key === 'ArrowUp' && snakeGame.direction !== 'down') {
        snakeGame.nextDirection = 'up';
        e.preventDefault();
    } else if (key === 'ArrowDown' && snakeGame.direction !== 'up') {
        snakeGame.nextDirection = 'down';
        e.preventDefault();
    } else if (key === 'ArrowLeft' && snakeGame.direction !== 'right') {
        snakeGame.nextDirection = 'left';
        e.preventDefault();
    } else if (key === 'ArrowRight' && snakeGame.direction !== 'left') {
        snakeGame.nextDirection = 'right';
        e.preventDefault();
    }
}

// === CONTROLES T√ÅCTILES ===
function changeSnakeDirection(dir) {
    if (!snakeGame.isRunning) return;
    
    if (dir === 'up' && snakeGame.direction !== 'down') {
        snakeGame.nextDirection = 'up';
    } else if (dir === 'down' && snakeGame.direction !== 'up') {
        snakeGame.nextDirection = 'down';
    } else if (dir === 'left' && snakeGame.direction !== 'right') {
        snakeGame.nextDirection = 'left';
    } else if (dir === 'right' && snakeGame.direction !== 'left') {
        snakeGame.nextDirection = 'right';
    }
}

// === RESETEAR JUEGO COMPLETO ===
function resetSnakeGame() {
    clearTimeout(snakeGameLoop);
    snakeGame.isRunning = false;
    // Resetear preguntas usadas
    usedQuestions = { easy: [], medium: [], hard: [], expert: [] };
    
    document.getElementById('snakeStartScreen').style.display = 'block';
    document.getElementById('snakeGameScreen').style.display = 'none';
    document.getElementById('snakeWinScreen').style.display = 'none';
    document.getElementById('snakeGameOverScreen').style.display = 'none';
}

// === SALIR DEL JUEGO ===
function exitSnakeGame() {
    clearTimeout(snakeGameLoop);
    snakeGame.isRunning = false;
    document.removeEventListener('keydown', handleSnakeKeydown);
    
    // Ocultar fullscreen
    const container = document.getElementById('snakeFullscreenContainer');
    if (container) container.style.display = 'none';
    snakeGame.isFullscreen = false;
    snakeGame.isMobile = false;
    
    // Resetear pantallas del juego
    document.getElementById('snakeStartScreen').style.display = 'block';
    document.getElementById('snakeGameScreen').style.display = 'none';
    document.getElementById('snakeWinScreen').style.display = 'none';
    document.getElementById('snakeGameOverScreen').style.display = 'none';
}
  </script>
</body>
</html>